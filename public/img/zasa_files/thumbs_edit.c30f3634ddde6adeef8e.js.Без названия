(()=>{"use strict";var t,e,i,a={313653:(t,e,i)=>{i.d(e,{processThumbs:()=>_,compute:()=>w,getSize:()=>b,move:()=>y,scale:()=>T,crop:()=>M,getRatio:()=>x,convert:()=>C,isValidThumbType:()=>E,THUMB_TYPE_ALBUM:()=>c,THUMB_TYPE_DOC:()=>l,THUMB_TYPE_MARKET_ALBUM:()=>u,THUMB_TYPE_PHOTO:()=>h,THUMB_TYPE_VIDEO:()=>d,THUMB_DRAG_ANIMATION_DURATION:()=>g,THUMBS_CONTAINER_DEFAULT_RATIO:()=>v,THUMBS_MESH_GAP:()=>p});i(530522),i(991181),i(579665),i(95767),i(66108),i(296253),i(175115),i(751876);var a=i(40906),r=i(683609);function n(){return n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},n.apply(this,arguments)}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],a=!0,r=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(t){r=!0,n=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw n}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var l="doc",h="photo",d="video",c="album",u="market_album",v=1.5,g=window.isMVK?200:120,p=5,m=window.isMVK?604:537,f=window.isMVK?360:343;function _(t,e,i,r){var n=function(t){var e=0;return(0,a.each)(t,((t,i)=>{e+=i})),e},o=function(t,e,i){return(e-(t.length-1)*i)/n(t)},s=(r=A(r)?r:{}).wide,l=[],h=0,c=[],u=[];(0,a.each)(i,((t,e)=>{E(e.type)&&(c[c.length]=e[e.type]),e.type===d&&l.push(h),h++}));var v="",g=[],_=c.length;(0,a.each)(c,((i,a)=>{var r=x(a,t,e);v+=r>1.2?"w":r<.8?"v":"q",g[g.length]=r}));var b,y,T=g.length>0?n(g)/g.length:1,M=p;window.isMVK&&(M=window.innerWidth>=480?6:3);var C=M;r.force?(b=t,y=e):(s?(b=m,y=f):t>=381?(b=381,y=1==_?361:237):(b=337,y=1==_?320:214),t<b&&(b=t,y=e),window.isMVK&&(b=Math.min(m,window.innerWidth),y=Math.min(f,b)));var I=b/y,B=0,U=0;if(1==_){var z={lastColumn:1,lastRow:1,single:1};c[0].thumb?(B=279,U=185):g[0]>=1*I?(B=b,U=Math.min(B/g[0],y)):(U=y,B=Math.min(U*g[0],b));var R=w(c[0],B,U,z);!R.unsized&&(R.image.width<B&&R.image.height<=y||R.image.height<U&&R.image.width<=b)&&(B=R.image.width,U=R.image.height,R=w(c[0],B,U,z)),u[0]=R}else if(2==_){var P,k;switch(v){case"ww":if(T>1.4*I&&g[1]-g[0]<.2){k=b,P=Math.min(k/g[0],k/g[1],(y-C)/2),u[0]=w(c[0],k,P,{lastColumn:1}),u[1]=w(c[1],k,P,{lastColumn:1,lastRow:1}),B=b,U=2*P+C;break}case"vv":case"qv":case"vq":case"qq":k=(b-M)/2,P=Math.min(k/g[0],k/g[1],y),u[0]=w(c[0],k,P,{lastRow:1}),u[1]=w(c[1],k,P,{lastRow:1,lastColumn:1}),B=b,U=P;break;default:var S=(0,a.intval)((b-M)/g[1]/(1/g[0]+1/g[1])),H=b-S-M;P=Math.min(y,S/g[0],H/g[1]),u[0]=w(c[0],S,P,{lastRow:1}),u[1]=w(c[1],H,P,{lastColumn:1,lastRow:1}),B=b,U=P}}else if(3==_)if((g[0]>1.2*I||T>1.5*I)&&"www"==v){var N,$=b,j=Math.min($/g[0],.66*(y-C));if(u[0]=w(c[0],$,j,{lastColumn:1}),"www"==v){var D=(0,a.intval)(b-M)/2;N=Math.min(y-j-C,D/g[1],D/g[2]),u[1]=w(c[1],D,N,{lastRow:1}),u[2]=w(c[2],b-D-M,N,{lastColumn:1,lastRow:1})}else{var Y=(0,a.intval)((b-M)/g[2]/(1/g[1]+1/g[2])),L=b-Y-M;N=Math.min(y-j-C,Y/g[2],L/g[1]),u[1]=w(c[1],Y,N,{lastRow:1}),u[2]=w(c[2],Y,N,{lastRow:1,lastColumn:1})}B=b,U=j+N+C}else{var G=y,V=(0,a.intval)(Math.min(G*g[0],.75*(b-M)));u[0]=w(c[0],V,G,{lastRow:1});var X=g[1]*(y-C)/(g[2]+g[1]),F=y-X-C,K=Math.min(b-V-M,(0,a.intval)(X*g[2]),(0,a.intval)(F*g[1]));u[1]=w(c[1],K,F,{lastColumn:1}),u[2]=w(c[2],K,X,{lastColumn:1,lastRow:1}),B=V+K+M,U=y}else if(4==_)if((g[0]>1.2*I||T>1.5*I)&&"wwww"==v){var q=b,W=Math.min(q/g[0],.66*(y-C));u[0]=w(c[0],q,W,{lastColumn:1});var J=(b-2*M)/(g[1]+g[2]+g[3]),Q=(0,a.intval)(J*g[1]),Z=(0,a.intval)(J*g[2]),tt=q-Q-Z-2*M;J=Math.min(y-W-C,J),u[1]=w(c[1],Q,J,{lastRow:1}),u[2]=w(c[2],Z,J,{lastRow:1}),u[3]=w(c[3],tt,J,{lastColumn:1,lastRow:1}),B=b,U=W+J+C}else{var et=y,it=Math.min(et*g[0],.66*(b-M)),at=(y-2*C)/(1/g[1]+1/g[2]+1/g[3]),rt=(0,a.intval)(at/g[1]),nt=(0,a.intval)(at/g[2]),ot=et-rt-nt-2*C;it+(at=Math.min(b-it-M,at))+M<b&&et*g[0]>it&&(it=Math.min(et*g[0],b-M-at)),u[0]=w(c[0],it,et,{lastRow:1}),u[1]=w(c[1],at,rt,{lastColumn:1}),u[2]=w(c[2],at,nt,{lastColumn:1}),u[3]=w(c[3],at,ot,{lastColumn:1,lastRow:1}),B=it+at+M,U=y}else{var st=[],lt=0;T>(l.length?1.3:1.1)?(0,a.each)(g,((t,e)=>{st[st.length]=Math.max(1,e)})):(0,a.each)(g,((t,e)=>{~l.indexOf(lt)?st[st.length]=e:st[st.length]=Math.min(1,e),lt++}));var ht,dt,ct={};for(ct[_+""]=[o(st,b,M)],ht=1;ht<=_-1;ht++)ct[ht+","+(dt=_-ht)]=[o(st.slice(0,ht),b,M),o(st.slice(ht),b,M)];for(ht=1;ht<=_-2;ht++)for(dt=1;dt<=_-ht-1;dt++)ct[ht+","+dt+","+(_-ht-dt)]=[o(st.slice(0,ht),b,M),o(st.slice(ht,ht+dt),b,M),o(st.slice(ht+dt),b,M)];var ut,vt=null,gt=0;for(var pt in ct)if(ct.hasOwnProperty(pt)){var mt=ct[pt],ft=n(mt)+C*(mt.length-1),_t=Math.abs(ft-y);if(~pt.indexOf(",")){for(var wt=pt.split(","),bt=0;bt<wt.length;bt++)wt[bt]=(0,a.intval)(wt[bt]);(wt[0]>wt[1]||wt[2]&&wt[1]>wt[2])&&(_t+=50,_t*=1.5)}(null===vt||_t<gt)&&(vt=pt,gt=_t,ut=ft)}for(var yt=O(c),Tt=O(st),Mt=vt.split(","),xt=ct[vt],Ct=Mt.length-1,Et=0;Et<Mt.length;Et++){var Ot=parseInt(Mt[Et]),At=yt.splice(0,Ot),It=xt.shift(),Bt=At.length-1,Ut={};Ct==Et&&(Ut.lastRow=!0);for(var zt=b,Rt=0;Rt<At.length;Rt++){var Pt=At[Rt],kt=Tt.shift(),St=Ut,Ht=void 0;Bt==Rt?(Ht=Math.ceil(zt),St.lastColumn=!0):zt-=(Ht=(0,a.intval)(kt*It))+M,u[u.length]=w(Pt,Ht,It,St)}}B=b,U=ut}return{width:(0,a.intval)(B),height:(0,a.intval)(U),thumbs:u}}function w(t,e,i,n){var o={id:t.id,width:(0,a.intval)(e),height:(0,a.intval)(i),lastColumn:n.lastColumn,lastRow:n.lastRow,single:n.single,image:b(t,e,i,n.single),unsized:t.unsized,type:t.type,orig:t};return t.title&&void 0!==t.size?Object.assign(o,{title:t.title,size:t.size}):t.title&&void 0!==t.msize?Object.assign(o,{title:t.title,msize:t.msize}):t.type===d&&t.name&&Object.assign(o,{name:t.name}),"number"==typeof t.duration&&(t.duration=(0,r.formatTime)(t.duration)),o.unsized?o.ratio=1:o.ratio=o.image.width/o.image.height,o}function b(t,e,i,r){if(!t)return{};e=(0,a.intval)(e),i=(0,a.intval)(i);var n,o=window.devicePixelRatio||1;if(t.type===d||t.type===l){(t.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach((a=>{t.sizes[a]&&(!n||e*o<=t.sizes[a][1]&&i*o<=t.sizes[a][2])&&(n=t.sizes[a])}))}else{var s=t.thumb?t.thumb.sizes:t.sizes,h=s.x||s[s.length-1],c=h?(h[1]||1)/(h[2]||1):1,u=0;c>e/i?(u=i,c>1&&(u*=c)):(u=e,c<1&&(u/=c)),i*=o,e*=o;var v=!r&&s.o,g="";g=s.temp?"temp":u<75?"s":u<130?"m":v&&s.o&&s.o[1]>=e&&s.o[2]>=i?"o":v&&s.p&&s.p[1]>=e&&s.p[2]>=i?"p":v&&s.q&&s.q[1]>=e&&s.q[2]>=i?"q":v&&s.r&&s.r[1]>=e&&s.r[2]>=i?"r":"x",n=s[g]||[]}return n[1]=(0,a.intval)(n[1]),n[2]=(0,a.intval)(n[2]),n[1]&&n[2]||(t.unsized=!0),{src:n[0],width:n[1],height:n[2]}}function y(t,e,i){if(i>=t.length)for(var a=i-t.length;1+a--;)t.push(void 0);return t.splice(i,0,t.splice(e,1)[0]),t}function T(t,e,i,r){i=(0,a.intval)(i),r=(0,a.intval)(r)||i;var n=t,o=e;return t>=e&&t>i?(n=(0,a.intval)(i),o=(0,a.intval)(e/(t/i))):t<e&&e>r&&(o=(0,a.intval)(r),n=(0,a.intval)(t/(e/r))),[n,o]}function M(t,e,i){var r=e,n=i,o=0,s=0;if(!t.vid&&t.image.width&&t.image.height){var l=t.image.width/t.image.height;l<e/i?(t.single&&t.image.width<e&&(e=t.image.width,i=Math.min(i,t.image.height)),(n=(r=e)/l)>i&&(s=-(0,a.intval)((n-i)/2))):(t.single&&t.image.height<i&&(i=t.image.height,e=Math.min(e,t.image.width)),(r=(n=i)*l)>e&&(o=-(0,a.intval)((r-e)/2)))}return{width:r,height:n,marginLeft:o,marginTop:t.orig&&(t.type===u||t.type===c)&&t.single?0:s}}function x(t,e,i){var a;switch(t.type){case l:a=t.ratio;break;case d:a=t.ratio||1.777;break;case c:case u:a=1.5;break;default:if(t.sizes&&t.sizes.x){var r=o(t.sizes.x,3),n=r[1],s=r[2];n&&s&&(a=n/s)}if(t.sizes&&t.sizes.temp){var h=o(t.sizes.temp,3),v=h[1],g=h[2];v&&g&&(a=v/g)}}return a||1}function C(t,e,i,a){var r=o(e.split("_"),2),s=r[0],v=r[1],g=n({owner_id:s,ownerId:s,itemId:v,type:t,remove:i.remove,click:i.click,temp:"temp"in i.sizes},a);switch(t){case l:g.data={sizes:i.sizes,ratio:i.ratio,label:i.label,href:i.href},g.doc=g.data;break;case h:g.data={pid:v,sizes:i.sizes,restrictionBlur:i.restrictionBlur,restrictionGeo:i.restrictionGeo,photoId:i.photoId},g.photo=g.data;break;case d:g.data={vid:v,duration:i.duration,platform:i.platform,play_icon:i.play_icon,preview:i.preview,active_live:i.active_live,restriction:i.restriction,ratio:i.ratio,sizes:i.sizes,name:i.name},g.video=g.data;break;case c:g.data={aid:v,title:i.title,size:i.size,thumb:{sizes:i.sizes},restrictionBlur:i.restrictionBlur,restrictionGeo:i.restrictionGeo,photoId:i.photoId},g.album=g.data;break;case u:g.data={type:u,aid:v,title:i.title,msize:i.msize,thumb:{sizes:i.sizes}},g.market_album=g.data}return g.data.type=t,g.data.id=g.temp?`${t}temp_${s}`:`${t}${g.ownerId}_${g.itemId}`,g}function E(t){return!!~[l,h,d,c,u].indexOf(t.toString())}function O(t,e){var i=A(t)||void 0===t.length?{}:[];for(var a in t)(!/webkit/i.test(_ua)||"layerX"!=a&&"layerY"!=a&&"webkitMovementX"!=a&&"webkitMovementY"!=a)&&(e&&"object"==typeof t[a]&&"prototype"!==a&&null!==t[a]?i[a]=O(t[a]):i[a]=t[a]);return i}var A=t=>"[object Object]"===Object.prototype.toString.call(t)},437380:(t,e,i)=>{i.d(e,{ThumbsEdit:()=>p});i(991181),i(579665),i(95767),i(530522),i(21466),i(66108),i(296253);var a=i(850167),r=i(726271),n=i(786067),o=i(635676),s=i(49535),l=i(695724),h=i(315544),d=i(40906),c=i(313653),u=i(376852);function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],a=!0,r=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(t){r=!0,n=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw n}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return g(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return g(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}var p={cache:function(){return cur._thEdCache||(cur._thEdCache={}),cur._thEdCache},loaded:function(){return cur._thEdLoaded||(cur._thEdLoaded={}),cur._thEdLoaded},cur:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){return cur._thEdCur||(cur._thEdCur={}),cur._thEdCur})),getMedias:function(t){var e=[];return(t=(0,h.ge)(t))?((this.cache()[t.id]?this.cache()[t.id].previews:[]).forEach((t=>{this.isValidThumbType(t.type)&&e.push([t.type,`${t.ownerId}_${t.itemId}`])})),e):e},init:function(t,e,i){if(t=(0,h.ge)(t)){(i="boolean"==typeof i?{wide:i}:(0,l.clone)(i)||{}).width&&i.height?i.force=!0:(i.width=t.parentNode.offsetWidth,i.height=Math.round(i.width/c.THUMBS_CONTAINER_DEFAULT_RATIO));var a=[];e.forEach((t=>{this.isValidThumbType(t.type)&&a.push(t)})),(0,h.domData)(t,"te-inited",1),this.cache()[t.id]={previews:a,opts:i,wide:i.wide,height:0,thumbs:[]};var r=this.cur().timer;r&&clearTimeout(r),a.length?this.cur().timer=setTimeout((()=>{var e=this.processThumbs(i.width,i.height,a,i);this.cache()[t.id].thumbs=e.thumbs,this.cache()[t.id].height=e.height;var r=(0,h.cf)();e.thumbs.forEach(((e,i)=>{r.appendChild(this.createThumbEl(t.id,e,i))})),(0,h.val)(t,""),(0,h.toggleClass)(t,"wide",i.wide),(0,h.setStyle)(t,{width:e.width,height:e.height}),t.appendChild(r),(0,h.show)(t),(0,d.isFunction)(i.onUpdate)&&i.onUpdate()}),0):((0,h.hide)(t),(0,h.val)(t,""))}},getParentTooltipCls:function(t){return(0,h.gpeByClass)("_im_text_input",t)?"_im_text_input":"thumb_wrap"},loadAndDisplayImage:function(t,e){if(t&&e&&e.oldImage){var i=new Image,a=e.image,r=e.oldImage;if(this.loaded()[a.src]&&t.src!==a.src)return t.src=a.src,void delete e.oldImage;var n=()=>{t.src===r.src&&(t.src=a.src,delete e.oldImage,this.loaded()[a.src]=!0),(0,s.removeEvent)(i,"load",n)};(0,s.addEvent)(i,"load",n),i.src=a.src}},createThumbEl:function(t,e,i){if(e&&this.isValidThumbType(e.type)){var r,o=e.oldImage||e.image,v=this.crop(e,e.width,e.height),g="draggable_thumb _draggable clear_fix"+(e.unsized?" unsized"+(e.single?" unsized_single":""):""),p=`thumb_wrap fl_l thumb_${e.type}_wrap`;switch(e.lastColumn&&(p+=" last_column"),e.lastRow&&(p+=" last_row"),e.height<50&&(p+=" thumb_no_controls"),e.type){case c.THUMB_TYPE_ALBUM:case c.THUMB_TYPE_MARKET_ALBUM:e.orig.restrictionGeo||e.image.src.match(/^\/images\//)&&(p+=" page_album_nocover"),(e.title||e.thumb)&&(r=`\n            <div class="page_album_title">\n              <div class="page_album_size">${e.msize||e.size}</div>\n              <div class="page_album_title_text">${e.title}</div>\n            </div>\n          `),e.orig.restrictionBlur&&(g+=" PostPhotoRestriction--blur"),e.orig.restrictionGeo&&(g+=" PostPhotoRestriction--geo");break;case c.THUMB_TYPE_PHOTO:e.orig.restrictionBlur&&(g+=" PostPhotoRestriction--blur"),e.orig.restrictionGeo&&(g+=" PostPhotoRestriction--geo");var m=(0,a.isPhotoeditor3Available)()&&!vk.widget&&!e.orig.restrictionGeo,f=this.cache()[t];r=!(f&&f.opts&&f.opts.nocl)?`\n          <div class="photo_thumb_btns_container">\n            <div class="photo_thumb_btns_overlay">\n              <div class="photo_thumb_btns">\n                <div class="photo_thumb_btn_show _photo_thumb_btn_show" id="ui_btn_show"></div>\n                ${m?'<div class="photo_thumb_btn_editor _photo_thumb_btn_editor" id="ui_btn_pe"></div>':""}\n              </div>\n            </div>\n          </div>\n        `:"";break;case c.THUMB_TYPE_DOC:r=`\n          ${e.orig.label}\n          <a href="${e.orig.href}" class="post_doc_thumb_link" target="_blank" rel="noopener"></a>\n        `;break;case c.THUMB_TYPE_VIDEO:r=e.orig.preview}var _="";e.orig.photoId&&(_=`data-photo-id="${(0,l.clean)(e.orig.photoId)}"`);var w=vk.widget?(0,l.clean)((0,d.unclean)(o.src)):(0,l.clean)(o.src),b=e.unsized||e.orig.preview?"":`\n      <img class="preview _preview" src="${w}" width="${Math.round(v.width)}" height="${Math.round(v.height)}" style="margin:${v.marginTop}px 0 0 ${v.marginLeft}px;"/>\n    `,y=`\n      <div index="${i}" attachment="${e.id}" ${_} class="${p}"${e.name?` aria-label="${(0,l.clean)(e.name)}"`:""} style="width: ${(0,l.intval)(e.width)}px;height: ${(0,l.intval)(e.height)}px;">\n        <div class="${g}" ${e.unsized?` style="background-image:url(${(0,l.clean)(o.src)})"`:""}>\n          ${b}\n          ${r}\n          ${e.type!==c.THUMB_TYPE_VIDEO?'<div class="overlay _overlay"></div>':""}\n          <div class="ui_thumb_x_button _close_btn" role="link" aria-label="${(0,l.clean)((0,n.getLang)("dont_attach"))}">\n            <div class="ui_thumb_x"></div>\n          </div>\n        </div>\n      </div>\n    `,T=(0,h.se)(y),M=(0,h.geByClass1)("_preview",T),x=(0,h.geByClass1)("_draggable",T),C=(0,h.geByClass1)("_close_btn",T);if(e.oldImage&&M&&this.loadAndDisplayImage(M,e),(0,s.addEvent)(x,"click",(t=>{if(this.cur().updating||(0,h.domClosest)("_close_btn",t.target))(0,s.cancelEvent)(t);else{var e=(0,h.gpeByClass)("thumb_wrap",t.target),i=this.cache()[e.parentNode.id].previews[e.getAttribute("index")].click;cur.openEditor=(0,h.hasClass)(t.target,"_photo_thumb_btn_editor"),(0,d.isFunction)(i)&&i(t)}})),(0,s.addEvent)(x,"mousedown touchstart",(t=>this.startDrag(t))),(0,s.addEvent)(C,"click",(t=>{var e=(0,h.gpeByClass)("thumb_wrap",t.target);(0,h.hide)((0,h.geByClass1)("_draggable",e)),this.removeMedia(e.parentNode.id,e.getAttribute("index"))})),(0,s.addEvent)(C,"mouseover",(()=>(0,u.showTooltip)(C,{text:(0,n.getLang)("dont_attach"),shift:[11,8],black:1}))),e.type===c.THUMB_TYPE_PHOTO){var E=(0,h.geByClass1)("_photo_thumb_btn_show",T);E&&(0,s.addEvent)(E,"mouseover",(()=>(0,u.showTooltip)(E,{text:(0,n.getLang)("global_photo_attach_show"),shift:[10,8],black:1,appendParentCls:this.getParentTooltipCls(x)})));var O=(0,h.geByClass1)("_photo_thumb_btn_editor",T);O&&(0,s.addEvent)(O,"mouseover",(()=>(0,u.showTooltip)(O,{text:(0,n.getLang)("global_pe_edit"),shift:[9,8],black:1,appendParentCls:this.getParentTooltipCls(x)})))}return T}},getCoords:function(t,e){var i=[];return e=e||(0,h.getXY)(t),Array.from(t.childNodes).forEach((t=>{if((0,h.hasClass)(t,"thumb_wrap")){var a=(0,h.getXY)(t);i[i.length]={id:t.getAttribute("attachment"),x:(0,l.intval)(a[0]-e[0]),y:(0,l.intval)(a[1]-e[1]),width:(0,l.intval)(t.offsetWidth),height:(0,l.intval)(t.offsetHeight),index:(0,l.intval)(t.getAttribute("index")),node:t}}})),i},startDrag:function(t){var e=t.touches&&1==t.touches.length,i=null==t.button||0!=t.button&&!(1==t.button&&r.browser.msie8);if((0,h.hasClass)(t.target,"_photo_thumb_btn_show")||(0,h.hasClass)(t.target,"_photo_thumb_btn_editor"))return(0,s.cancelEvent)(t);if(!(i&&!e||(0,h.domClosest)("_close_btn",t.target)||this.cur().updating)){var a=(0,h.hasClass)(t.target,"draggable_thumb")?t.target:(0,h.gpeByClass)("draggable_thumb",t.target),n=(0,h.gpeByClass)("editable_thumbs",a),o=this.cache()[n.id];if(o&&!((o.previews||[]).length<2))return this.cur().el=a,this.cur().dragHandler=t=>this.drag(t),this.cur().dropHandler=t=>this.drop(t),(0,s.addEvent)(window,"mousemove touchmove",this.cur().dragHandler),(0,s.addEvent)(window,"mouseup touchend touchcancel",this.cur().dropHandler),e||(0,s.cancelEvent)(t)}},drag:function(t){var e=this.cur().el;if(t.touches&&t.touches.length>1)return this.drop();var i=r.browser.android?t.touches[0].pageX+(t.pageX||0):t.pageX,a=r.browser.android?t.touches[0].pageY+(t.pageY||0):t.pageY,n=this.cur();if((0,h.hasClass)(e,"moving")){var d=i-(n.pos[0]+n.x),u=a-(n.pos[1]+n.y);(0,h.setStyle)(e,{left:d,top:u});var g=n.wpos,p={x:d=n.pos[0]+(0,l.intval)(e.style.marginLeft)+d-g[0],y:u=n.pos[1]+(0,l.intval)(e.style.marginTop)+u-g[1],offsetX:e.offsetWidth,offsetY:e.offsetHeight,index:n.i,node:e},m=!1,f=n.i,_=-1,w=c.THUMBS_MESH_GAP;(0,l.each)(n.coords,(function(t,e){if(t!=n.i&&t!=_){e.offsetX=e.node.offsetWidth+w,e.offsetY=e.node.offsetHeight+w;var i=n.coords[t-1],a=n.coords[t+1],r=p.x+p.offsetX/2,o=p.y+p.offsetY/2,s=e.x+e.offsetX/2,l=e.y+e.offsetY/2,d=e.x+e.offsetX,c=e.y+e.offsetY,u=(i&&i.x==e.x&&i.y!=e.y&&0!=e.y||a&&a.x==e.x&&a.y!=e.y)&&0!=e.x,v=r>=s&&(a&&(r<=a.x+a.offsetX/2&&(a.offsetY==e.offsetY||r<d)||a.y!=e.y)||!a&&p.x<=d)&&o>e.y&&o<c,g=r<s&&r>=e.x&&(!i||i.y!=e.y&&!(i.x==e.x&&!a))&&o>e.y&&o<c,b=u&&o>=l&&o<c&&r>e.x&&r<d,y=u&&o<l&&o>=e.y&&r>e.x&&r<d;v=v&&!u,g=g&&!u&&!v,(v||g||b||y)&&(m=!0,f=e.index<n.i&&(v||b)?e.index+1:p.index<e.index&&(y||g)?e.index-1:e.index),f!=n.i?(0,h.setStyle)(e.node,{left:v?-2:g?2:0,top:b?-2:y?2:0}):(0,h.setStyle)(e.node,{left:0,top:0}),v&&a&&a.y==e.y&&a.x>e.x&&p.index>e.index&&((0,h.setStyle)(e.node,{left:0,top:0}),(0,h.setStyle)(a.node,{left:2,top:0}),_=t+1),b&&a&&a.x==e.x&&a.y>e.y&&o<=l&&((0,h.setStyle)(a.node,{left:0,top:0}),_=t+1),y&&i&&i.x==e.x&&i.y<e.y&&o<=l&&((0,h.setStyle)(i.node,{left:0,top:-2}),(0,h.setStyle)(e.node,{left:0,top:0}))}})),n.to_i=m?f:n.i}else{var b=e.parentNode.parentNode,y=(0,h.geByClass1)("_overlay",e),T=(0,h.geByClass1)("_preview",e),M=(0,l.intval)(e.parentNode.getAttribute("index")),x=this.cache()[b.id].thumbs[M],C=(0,h.getXY)(b),E=(0,h.getXY)(e.parentNode),O=this.getCoords(b,C);n.id=b.id,n.i=M,n.to_i=M,n.x=i-E[0],n.y=a-E[1],n.t=x,n.w=x.width,n.h=x.height,n.pos=E,n.wpos=C,n.crop=this.crop(x,x.width,x.height),n.coords=O;var A=v(this.scale(x.width,x.height,75),2),I=A[0],B=A[1],U=(0,l.intval)((x.width-I)*(r.browser.mobile?.5:n.x/x.width)),z=(0,l.intval)((x.height-B)*(r.browser.mobile?.5:n.y/x.height));(0,h.addClass)(e,"moving"),(0,h.setStyle)(e,"zIndex",100);var R={duration:c.THUMB_DRAG_ANIMATION_DURATION,transition:o.Fx.Transitions.easeOutCubic},P=this.crop(x,I,B);(0,o.animate)(e,{opacity:.85,width:I,height:B,marginLeft:U,marginTop:z},R),(0,o.animate)(y,{opacity:1},R),T&&(0,o.animate)(T,P,R)}return(0,s.cancelEvent)(t)},drop:function(t){var e=this.cur();document.removeEventListener("touchmove",this.preventScroll),e.updating=!0;var i=e.el,a=(0,h.geByClass1)("_overlay",i),r=(0,h.geByClass1)("_preview",i);if((0,s.removeEvent)(window,"mousemove touchmove",e.dragHandler),(0,s.removeEvent)(window,"mouseup touchend touchcancel",e.dropHandler),!(0,h.hasClass)(i,"moving"))return e.updating=!1,(0,s.cancelEvent)(t);if(e.to_i==e.i){var n=e.crop,u={duration:c.THUMB_DRAG_ANIMATION_DURATION,transition:o.Fx.Transitions.easeOutCubic};(0,o.animate)(i,{marginTop:0,marginLeft:0,top:0,left:0,width:e.w,height:e.h,opacity:1},(0,l.extend)(u,{onComplete:()=>{(0,h.setStyle)(i,"zIndex",null),e.updating=!1}})),(0,o.animate)(a,{opacity:0},u),r&&(0,o.animate)(r,n,u)}else{var v=this.cache()[e.id].previews;v=this.move(v,e.i,e.to_i),this.update(e.id,v),(0,d.isFunction)((this.cache()[e.id].opts||{}).onMove)&&this.cache()[e.id].opts.onMove()}return(0,h.removeClass)(i,"moving"),(0,s.cancelEvent)(t)},update:function(t,e){if(t=(0,h.ge)(t)){var i=t.id,a=(0,h.ge)(i),r=this.cache()[a.id],n=r.thumbs,s=r.height,u=r.opts,v=!0===u||!1===u?{wide:u}:(0,l.clone)(u||{}),g=v.width,p=v.height;g&&p?v.force=!0:(g=t.parentNode.offsetWidth,p=Math.round(g/c.THUMBS_CONTAINER_DEFAULT_RATIO));var m=this.processThumbs(g,p,e,v),f=(0,h.se)(`\n      <div style="height: 0;overflow: hidden;">\n        <div class="_editable_thumbs editable_thumbs${r.wide?" wide":""}" style="width: ${m.width}px;height: ${m.height}px;"></div>\n      </div>\n    `),_=(0,h.geByClass1)("_editable_thumbs",f);m.thumbs.forEach(((t,e)=>{_.appendChild(this.createThumbEl(i,t,e))})),a.parentNode.appendChild(f);var w=this.getCoords(_);(0,l.each)(w,((t,e)=>{for(var i=null,a=this.cur().coords,r=0,s=a.length;r<s;++r)if(a[r].id==e.id){i=a[r];break}if(null!=i){var d=(0,h.geByClass1)("_draggable",i.node),u=(0,h.geByClass1)("_overlay",d),v=(0,h.geByClass1)("_preview",d),g=n[i.index],p=null;(0,l.each)(m.thumbs,((t,e)=>{e.id==g.id&&(this.loaded()[e.image.src]||(e.oldImage=g.image),p=e)})),(0,h.setStyle)(i.node,{left:0,top:0}),i.height==e.height&&i.width==i.width&&e.x==i.x&&e.y==i.y&&i.index!=this.cur().i||((0,h.hasClass)(d,"moving")&&(0,o.fadeOut)(u,c.THUMB_DRAG_ANIMATION_DURATION),setTimeout((()=>{(0,o.animate)(d,{top:e.y-i.y,left:e.x-i.x,marginLeft:0,marginTop:0,height:e.height,width:e.width,opacity:1},c.THUMB_DRAG_ANIMATION_DURATION);var t=this.crop(p,e.width,e.height);v&&(0,o.animate)(v,t,c.THUMB_DRAG_ANIMATION_DURATION),(0,h.toggleClass)(d,"unsized_single",p.unsized&&p.single)}),4))}})),s!=m.height&&setTimeout((()=>{(0,o.animate)(a,{height:m.height},c.THUMB_DRAG_ANIMATION_DURATION)}),4),setTimeout((()=>{(0,d.isFunction)(v.onUpdate)&&v.onUpdate(),(0,h.setStyle)(a,{height:m.height,width:m.width}),a.innerHTML="",this.cache()[i].thumbs=m.thumbs,this.cache()[i].previews=e,this.cache()[i].height=m.height,m.thumbs.forEach(((t,e)=>{a.appendChild(this.createThumbEl(i,t,e))})),(0,h.re)(f),this.cur().updating=!1}),c.THUMB_DRAG_ANIMATION_DURATION)}},setWide:function(t,e,i){if(t=(0,h.ge)(t)){var a=this.cache()[t.id],r=(0,l.clone)(i||{});void 0===e&&(e=!1),r.wide=e,a.wide!=e&&this.init(t,a.previews,r)}},hasMedia:function(t,e){if(t=(0,h.ge)(t)){var i=t.id,a=this.cache()[i];if(a){for(var r=0;r<a.previews.length;r++)if(a.previews[r][a.previews[r].type].id==e)return!0;return!1}}},addMedia:function(t,e){if((t=(0,h.ge)(t))&&e){var i=t.id,a=this.cache()[i];if(a){var r=(0,l.clone)(a.previews);10==r.length||this.hasMedia(t,e[e.type].id)||(r[r.length]=e,this.cache()[i]=null,this.init(i,r,(0,l.clone)(a.opts)))}}},updateMedia:function(t,e,i,a){if((t=(0,h.ge)(t))&&e&&i&&a){var r=t.id,n=this.cache()[r];if(n){for(var o=(0,l.clone)(n.previews),s=!1,d=e+i,c=0;c<o.length;c++)if(o[c][o[c].type].id==d){var u=this.convert(e,i,a.editable);o[c]=u,s=!0;break}s&&(this.cache()[r]=null,this.init(r,o,(0,l.clone)(n.opts)))}}},refresh:function(t){if(t=(0,h.ge)(t)){var e=t.id,i=this.cache()[e];i&&(this.cache()[e]=null,this.init(e,(0,l.clone)(i.previews),(0,l.clone)(i.opts)))}},removeAll:function(t){if(t=(0,h.ge)(t)){var e=t.id,i=this.cache()[e];i&&(this.cache()[e]=null,this.init(e,[],i.opts))}},removeMedia:function(t,e){if(!(t=(0,h.ge)(t)))return null;e=(0,l.intval)(e);var i=this.cache()[t.id];if(i){var a=i.previews.splice(e,1),r=a[0][a[0].type].id;return(0,l.each)(t.childNodes,((t,e)=>{if(e.getAttribute&&e.getAttribute("attachment")==r){var i=((0,h.geByClass1)("_close_btn",e)||{}).tt;return i&&i.destroy&&i.destroy(),!1}})),this.cur().coords=this.getCoords(t),0==i.previews.length?this.init(t,[],i.opts):this.update(t,i.previews),a[0]&&a[0].remove&&a[0].remove(),a}},removeById:function(t,e){if(!(t=(0,h.ge)(t)))return null;for(var i=(this.cache()[t.id]||{}).previews||[],a=0,r=i.length;a<r;++a)if(i[a].type==c.THUMB_TYPE_DOC&&i[a].doc.id==e||i[a].type==c.THUMB_TYPE_PHOTO&&i[a].photo.id==e||i[a].type==c.THUMB_TYPE_VIDEO&&i[a].video.id==e||i[a].type==c.THUMB_TYPE_ALBUM&&i[a].album.id==e||i[a].type==c.THUMB_TYPE_MARKET_ALBUM&&i[a].market_album.id==e)return this.removeMedia(t,a);return null},processThumbs:c.processThumbs,compute:c.compute,getSize:c.getSize,move:c.move,scale:c.scale,crop:c.crop,getRatio:c.getRatio,convert:c.convert,isValidThumbType:c.isValidThumbType}},683609:(t,e,i)=>{function a(t,e){var i;t=Math.max(t,0);var a=Math.floor(t%60);i=a<10?"0"+a:a;var r=(t=Math.floor(t/60))%60;return i=r+":"+i,((t=Math.floor(t/60))>0||e)&&(r<10&&(i="0"+i),i=t+":"+i),i}i.d(e,{formatTime:()=>a})},381621:(t,e,i)=>{var a=i(437380);window.ThumbsEdit=a.ThumbsEdit;try{window.stManager.done(window.jsc("web/thumbs_edit.js"))}catch(t){}}},r={};function n(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={id:t,loaded:!1,exports:{}};return a[t].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=a,t=[],n.O=(e,i,a,r)=>{if(!i){var o=1/0;for(d=0;d<t.length;d++){for(var[i,a,r]=t[d],s=!0,l=0;l<i.length;l++)(!1&r||o>=r)&&Object.keys(n.O).every((t=>n.O[t](i[l])))?i.splice(l--,1):(s=!1,r<o&&(o=r));if(s){t.splice(d--,1);var h=a();void 0!==h&&(e=h)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[i,a,r]},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},i=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,n.t=function(t,a){if(1&a&&(t=this(t)),8&a)return t;if("object"==typeof t&&t){if(4&a&&t.__esModule)return t;if(16&a&&"function"==typeof t.then)return t}var r=Object.create(null);n.r(r);var o={};e=e||[null,i({}),i([]),i(i)];for(var s=2&a&&t;"object"==typeof s&&!~e.indexOf(s);s=i(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>t[e]));return o.default=()=>t,n.d(r,o),r},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.e=()=>Promise.resolve(),n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={53081:0};n.O.j=e=>0===t[e];var e=(e,i)=>{var a,r,[o,s,l]=i,h=0;for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(l)var d=l(n);for(e&&e(i);h<o.length;h++)r=o[h],n.o(t,r)&&t[r]&&t[r][0](),t[o[h]]=0;return n.O(d)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var o=n.O(void 0,[11216,24509,40885,68592],(()=>n(381621)));o=n.O(o)})();
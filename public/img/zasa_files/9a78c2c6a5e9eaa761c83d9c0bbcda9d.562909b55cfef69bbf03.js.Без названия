(self.webpackChunkvk=self.webpackChunkvk||[]).push([[32335],{948588:(e,t,n)=>{"use strict";n.r(t),n.d(t,{NOSPAM_TEXT_FIELD:()=>c,CONTENT_STORY_THUMBNAIL:()=>p,noSpamPatterns:()=>o.noSpamPatterns,abortPatternMild:()=>o.abortPatternMild,noSpamSuspicious:()=>r.noSpamSuspicious,NoSpamTemplates:()=>i.NoSpamTemplates,dealSingleSpamer:()=>s.dealSingleSpamer,reportsTime:()=>s.reportsTime,onFiltersChange:()=>s.onFiltersChange,rollbackDocMailSpamer:()=>l.rollbackDocMailSpamer,rollbackDocWallSpamer:()=>l.rollbackDocWallSpamer,rollbackJpgMailSpamer:()=>l.rollbackJpgMailSpamer,rollbackJpgWallSpamer:()=>l.rollbackJpgWallSpamer,rollbackPngMailSpamer:()=>l.rollbackPngMailSpamer,rollbackPngWallSpamer:()=>l.rollbackPngWallSpamer,rollbackDocSpamer:()=>l.rollbackDocSpamer,rollbackPhotoSpamer:()=>l.rollbackPhotoSpamer,rollbackPhotoSpamerFromWall:()=>l.rollbackPhotoSpamerFromWall,rollbackPhotoSpamerFromMail:()=>l.rollbackPhotoSpamerFromMail,rollbackVideoSpamer:()=>l.rollbackVideoSpamer,rollbackVideoSpamerFromWall:()=>l.rollbackVideoSpamerFromWall,rollbackVideoSpamerFromMail:()=>l.rollbackVideoSpamerFromMail,entityDecode:()=>d,selectText:()=>u,removeSelectedText:()=>_,getSelectedText:()=>h,selectValue:()=>m,removeFidSearch:()=>g,banFidZero:()=>v,banFidForever:()=>f,isClaimContent:()=>b,getFieldName:()=>y});var a=n(315544),o=n(581164),r=n(915087),i=n(768099),s=n(25961),l=n(363983),c="_console_item_field_text",p="content_thumbnail_story";function d(e){return(0,a.se)("<textarea>"+e+"</textarea>").value}function u(e){var t=document,n=t.getElementById(e);if(t.body.createTextRange){var a=t.body.createTextRange();a.moveToElementText(n),a.select()}else if(window.getSelection){var o=window.getSelection(),r=t.createRange();r.selectNodeContents(n),o.removeAllRanges(),o.addRange(r)}}function _(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function h(){var e="";return window.getSelection?e=window.getSelection():document.getSelection?e=document.getSelection():document.selection&&(e=document.selection.createRange().text),e}function m(e){var t=(0,a.ge)(e);return t.options[t.selectedIndex].value}function g(e,t){ajax.post("noSpam.php",{act:"a_remove_fid_search",fid:e,hash:t},{onDone:function(t){(0,a.ge)("remove_fid_search_"+e).innerHTML=t}})}function v(e,t){ajax.post("noSpam.php",{act:"a_ban_fid_zero",fid:e,hash:t},{onDone:function(t){(0,a.ge)("ban_fid_zero_"+e).innerHTML=t}})}function f(e,t){ajax.post("noSpam.php",{act:"a_ban_fid_forever",fid:e,hash:t},{onDone:function(t){(0,a.ge)("ban_fid_forever_"+e).innerHTML=t}})}function b(){return window.nav&&window.nav.objLoc&&window.nav.objLoc.claim}function y(e){var t=(0,a.domClosest)(c,e);return!!t&&t.getAttribute("data-field")}},341585:(e,t,n)=>{"use strict";n.d(t,{CONSOLE_CUSTOM_NUM_FIELD:()=>$,getParams:()=>q,setIp:()=>Z,setUaHash:()=>ee,setConditions:()=>te,setThreshold:()=>ne,composeSearchLinkFromParams:()=>ae,getNumericField:()=>ie,getConditionsHint:()=>pe,switchParams:()=>ue,conditionsClear:()=>_e,clearAllExceptConditions:()=>he,optionClear:()=>me,addPatternPart:()=>ve,showUserStory:()=>ye,escapeRegexConditionsInput:()=>Ce,mount:()=>we});n(59357),n(820075),n(991181),n(296253),n(530522),n(21466);var a,o,r,i=n(667294),s=n(386409),l=n(159121),c=n(982452),p=n(973935),d=n(49535),u=n(113165),_=n(486125),h=n(376852),m=n(803834),g=n(695724),v=n(315544),f=n(610124),b=n(25961),y=n(198019),k=n(54),C=n(948588),w=n(19331),S=n(481117),T=n(564793),x=n(961540),L=n(320745),D=n(654612),E=n(786067),N=n(789466),B=1576215,I=163176673,R="console_locked",M="_apply_pattern",j="_search_reports",H="debug_pattern",F="_queries_toggle",A="console_show_message",P="nospam_console_custom_num_condition",O="highlighted",$="custom";function W(){return(0,v.hasClass)(y.consoleWrap,R)}function U(){W()||(0,v.addClass)(y.consoleWrap,R),(0,v.removeClass)(y.consoleWrap,A)}function V(){var e=(0,v.geByClass1)(M,y.patternWrap),t=(0,v.geByClass1)(j,y.patternWrap);W()&&(0,v.removeClass)(y.consoleWrap,R),(0,s.unlockButton)(e),(0,s.unlockButton)(t)}function G(e,t){var n=(0,v.geByClass1)("_console_error",y.consoleWrap),a=(0,v.geByClass)("console_item");n.innerHTML="",e||(e="");var o=(0,v.ce)("div");e&&(o.innerHTML=e),o.className=t?"error":"info_msg",e.match(/\/pattern[0-9]+/)&&a&&a.forEach((function(e){e.className="console_item red_item"})),(0,v.addClass)(y.consoleWrap,A),n.appendChild(o),V()}function K(e){a&&clearTimeout(a),a=setTimeout((()=>{(0,v.domData)(y.consoleWrap,"failed",0)}),3e3),(0,v.domData)(y.consoleWrap,"failed",1),console.error(e),G(e,!0)}function z(){var e=(0,v.ge)("queries",y.consoleWrap);return(0,v.geByClass1)(F,y.consoleWrap).innerHTML=(0,v.isVisible)(e)?"Показать запросы":"Скрыть запросы",(0,v.toggle)(e)}function q(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[],n=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={},a=function(e){var t="conditions_input"===e.id?(0,v.domPS)(e):(0,v.domNS)(e);return(0,v.hasClass)(t,"option_cleared")},o=function(t){return e&&a(t)};n[`type${t}`]=cur[`uiSpamtype${t}`].val();var r=(0,v.ge)(`pattern_input${t}`);n[`pattern${t}`]=o(r)?J(r):r.value,n[`threshold${t}`]=(0,v.ge)(`threshold_input${t}`).value;var i=(0,v.ge)(`uid_input${t}`);n[`uid${t}`]=o(i)?J(i):i.value;var s=(0,v.ge)(`ip_input${t}`);n[`ip${t}`]=o(s)?J(s):s.value;var l=(0,v.ge)(`uahash_input${t}`);n[`uahash${t}`]=o(l)?J(l):l.value;var c=(0,v.ge)(`time_start_input${t}`);n[`time_start${t}`]=o(c)?J(c):c.value;var p=(0,v.ge)(`time_finish_input${t}`);return n[`time_finish${t}`]=o(p)?J(p):p.value,n[`conditions${t}`]=window[`ConditionsEditor${t}`].getPlainText(),n},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=[];Array.from((0,v.geByClass)("option_cleared",e)).forEach((function(e){var t=(0,v.geByTag1)("input",(0,v.domPN)(e))||(0,v.geByTag1)("textarea",(0,v.domPN)(e));n.push(t.id)}));var a=[];return n.forEach((e=>{switch(e){case`pattern_input${t}`:a|=cur.hideFieldsBitMasks.substring;break;case`ip_input${t}`:a|=cur.hideFieldsBitMasks.ip;break;case`uahash_input${t}`:a|=cur.hideFieldsBitMasks.uaHash;break;case`uid_input${t}`:a|=cur.hideFieldsBitMasks.uid;break;case`time_finish_input${t}`:a|=cur.hideFieldsBitMasks.timeFinish;break;case`time_start_input${t}`:a|=cur.hideFieldsBitMasks.timeStart;break;case`conditions_input${t}`:a|=cur.hideFieldsBitMasks.conditions}})),a};t.simplify=cur.uiSimplify.val(),t.duration=cur.uiDuration.val(),t.bantype=cur.uiBan.val(),t.search_period=cur.uiSearchPeriod.val();var o=cur.uiSearchPeriod.selectedItems();return o&&o.length>0&&(t.period_in_seconds=3===o[0].length&&1===o[0][2]?1:0),t.comment=(0,v.ge)("comment_input").value,t.all_actions=(0,s.isChecked)("all_actions")||!1,t.notbannedonly=(0,s.isChecked)("not_banned_only")||!1,t.linksonly=(0,s.isChecked)("links_only")||!1,t.wrap_actions=null===(0,v.ge)("wrap_actions")?1:(0,s.isChecked)("wrap_actions"),t.encode_entities=null===(0,v.ge)("encode_entities")?1:(0,s.isChecked)("encode_entities"),t.hidden_fields=a((0,v.geByClass1)("pattern_part_root")),(0,g.extend)(t,n(e,"")),ge()&&(t.hidden_fields2=a((0,v.geByClass1)("pattern_part_child"),"2"),(0,g.extend)(t,n(e,"2"))),t}function J(e){return(0,v.domData)(e,"restore")}function X(e,t){return(0,v.domData)(e,"restore",t)}function Y(){var e=(0,v.ge)("pattern_input"),t=(0,v.geByClass1)(j,y.patternWrap),n=q();if(!e.value)return(0,m.scrollToTop)(0),void(0,s.notaBene)(e);if(!(0,s.isButtonLocked)(t)){U(),(0,s.lockButton)(t),o&&(tooltips.destroy(o.el),o=!1);var a=document.getElementById(S.rootId+"ConsoleLinks");a&&(p.unmountComponentAtNode(a),cur.sampleLinks=null),n.act="a_console_find_actions",ajax.post("noSpam.php",n,{onDone:(e,t)=>function(e,t){V(),(0,v.geByClass1)("_console",y.consoleWrap).innerHTML=e;var n=(0,v.geByClass1)("_console_numfield_ip1024",y.consoleWrap);n&&new InlineDropdown(n,{items:[[256,"/24 - 256"],[1024,"/22 - 1024"],[4096,"/20 - 4096"],[16384,"/18 - 16k"],[65536,"/16 - 65k"],[262144,"/14 - 262k"],[1048576,"/12 - 1kk"]],selected:256,withArrow:!0,keepTitle:!0,autoShow:!0,autoHide:300,onSelect:e=>ie("ip"+e)}),cur.linksBanComment="";var a=t.links;if(a){var o=JSON.parse(a),r=document.getElementById(S.rootId+"ConsoleLinks");o&&0!==o.domains&&r&&p.render(i.createElement(T.ConsoleLinks,{linksDataRaw:o,banHash:t.links_block_mass_hash,ref:e=>window.cur.sampleLinks=e}),r)}}(e,t),onFail:e=>K(e)})}}function Q(e,t){"string"==typeof t&&(t=(0,g.clean)(t)),(0,v.val)(e,t),me(!1,(0,v.ge)(e),"reset")}function Z(e){Q("ip_input",e)}function ee(e){Q("uahash_input",e)}function te(e){window.ConditionsEditor.update("append",e)}function ne(e){Q("threshold_input",e)}function ae(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(e=q(!0));var t=Object.keys(e);t.sort();for(var n=[],a=0;a<t.length;a++){var o=t[a],r=e[o];n.push(encodeURIComponent(o)+"="+encodeURIComponent(r))}return"/noSpam?"+n.join("&")}function oe(){var e=ae(),t=(0,v.geByClass1)("_get_pattern_link");t&&t.tt&&t.tt.destroy(),(0,v.addClass)(t,"progress");ajax.post("noSpam.php",{act:"get_search_link",link:e},{onDone:function(e){(0,v.removeClass)(t,"progress"),(0,h.showTooltip)(t,{text:e,slide:15,center:1,black:1,nohide:1,hidedt:400,shift:[0,2,0],onShowEnd:()=>{(0,window.selectText)("shorten_link"),setTimeout(t.tthide,3e3)}})},onFail:function(e){(0,v.removeClass)(t,"progress"),(0,l.topError)(e,{dt:5})}})}function re(){var e=(0,v.geByClass1)(H,y.patternWrap);if(!(0,s.isButtonLocked)(e)){var t=(0,g.extend)(q(),{act:"debug_pattern"});U(),ajax.post("noSpam.php",t,{onDone:e=>G(e),onFail:e=>K(e)})}}function ie(e,t){var n=(0,s.isChecked)("values_hist"),a=q();a.need_hist=n,a.act="numeric_field",a.field=e,a.custom_condition=t||"",cur.numFieldSel=e,ajax.post("noSpam.php",a,{onDone:function(o,r,s){var l=(0,g.clean)(t||e);(0,w.partConfigEnabled)("nospam_new_histogram")&&a.need_hist?function(e){var t=JSON.parse(e),n=t.width,a=t.header,o=t.value_rows;if(!o)return void(0,D.showFastBox)({width:n,title:a,dark:1},"Данные отсутствуют");var r=i.createElement(L.Histogram,{valueRows:o,columnHeaders:t.column_headers,header:a,valueType:t.value_type,fieldCondition:t.field_condition});window.cur.histogramSelectedCount=0;var s=(0,S.renderCommonBox)(a,r);(0,S.showComponentInBox)(s,{width:n,title:a,dark:1,onHideAttempt:se});var l=document.querySelectorAll(".box_body");l[l.length-1].classList.add("histogram_box")}(s):(0,D.showFastBox)({width:n?330:710,title:l,dark:1,containerClass:"nospam_hist_wrap",hideButtons:n},o).evalBox(r)},progress:"console_query_fields_progress"})}function se(e){if(e||0===window.cur.histogramSelectedCount)return!0;var t=(0,D.showFastBox)((0,E.getLang)("global_warning"),"Некоторые значения выделены. Действительно хотите закрыть гистограмму?",(0,E.getLang)("global_close"),(()=>{t.hide(),(0,_.curBox)().hide(!0)}),(0,E.getLang)("global_cancel"),(()=>{t.hide()}));return!1}function le(e){r=e,(0,v.geByClass1)("_nospam_console_custom_num_condition_patterns").innerHTML=e}function ce(e){var t=(0,v.domData)(e.target,"field"),n=q();n.act="link_field",n.field=t,ajax.post("noSpam.php",n,{onDone:(e,n)=>{!function(e,t,n){if(n.links){var a=JSON.parse(n.links),o=i.createElement("span",null,"В этом поле не найдено доменов или ссылок");!a||0===a.domains.length&&0===a.external_links.length||(o=i.createElement(T.ConsoleLinks,{linksDataRaw:a,banHash:n.links_block_mass_hash})),(0,S.showComponentInBox)((0,S.renderCommonBox)(e,o),{width:710,title:e,dark:1})}else(0,D.showFastBox)({width:710,title:e,dark:1},t)}(t,e,n)},progress:"console_query_fields_progress"})}function pe(e){var t=2===e?cur.uiSpamtype2.val():cur.uiSpamtype.val();return(0,D.showBox)("noSpam.php",{act:"conditions_hint",spamtype:t},{dark:1,containerClass:"nospam_hint_wrap"})}function de(){var e=q(),t=(0,v.geByClass1)(M,y.patternWrap);e.act="apply_pattern",(0,s.isButtonLocked)(t)||null===document.querySelector(".console_failed_queries")&&(U(),(0,s.lockButton)(t),ajax.post("noSpam.php",e,{onDone:e=>{var t;G(e.pattern_applied_text),t=e.pattern_id,cur.sampleLinks&&(cur.setLinksBanComment(`https://${(0,x.getHostName)()}/pattern${t}`),cur.sampleLinks.syncWithCurComment())},onFail:e=>K(e)}))}function ue(e){var t=["pattern_input","threshold_input","ip_input","uahash_input","time_finish_input","time_start_input","conditions_input"];t.pop();var n=window.ConditionsEditor.getEditorState(),a=window.ConditionsEditor2.getEditorState();window.ConditionsEditor.setEditorState(a),window.ConditionsEditor2.setEditorState(n),t.forEach((e=>{var t=(0,v.ge)(e).value;(0,v.ge)(e).value=(0,v.ge)(e+"2").value,(0,v.ge)(e+"2").value=t}));var o=cur.uiSpamtype.val();cur.uiSpamtype.selectItem(cur.uiSpamtype2.val()),cur.uiSpamtype2.selectItem(o),(0,v.toggleClass)(e,"switched")}function _e(){window.ConditionsEditor.handleClearRestore()}function he(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=["pattern_input","ip_input","uahash_input","uid_input","time_finish_input","time_start_input"];t.forEach((t=>{me(document.getElementById(t+e).nextElementSibling,t+e,"soft_clear")}))}function me(e,t,n){var a=(0,v.ge)(t),o=(0,v.hasClass)(e,"option_cleared");function r(n){var a=(0,v.val)(n);switch(X(n,a),t){case"pattern_input":case"pattern_input2":(0,v.val)(n,"/"),cur.uiSimplify.selectItem(32);break;case"threshold_input":case"threshold_input2":(0,v.val)(n,n.value&&"2"===n.value?"1":"2");break;default:(0,v.val)(n,"")}a&&(0,v.addClass)(e,"option_cleared")}switch(n){case"clear":o?function(){switch(t){case"threshold_input":case"threshold_input2":r(a);break;default:o&&(a.value=J(a))}(0,v.removeClass)(e,"option_cleared"),(0,v.removeClass)(e,O)}():r(a);break;case"reset":!function(){var e=(0,v.geByClass1)("option_clear",a.parentNode);X(a,""),(0,v.removeClass)(e,"option_cleared"),(0,v.removeClass)(e,O)}();break;case"reset_all":(0,v.geByClass)("option_clear").forEach((function(e){X((0,v.ge)(e.getAttribute("data-option")),""),(0,v.removeClass)(e,"option_cleared"),(0,v.removeClass)(e,O)}));break;case"soft_clear":o||r(a)}}function ge(){var e=(0,v.geByClass1)("_pattern_part_child");if(!(0,v.isVisible)(e))return!1;for(var t=(0,v.geByClass)("cloneable_input",e),n=0;n<t.length;n++)if((0,v.val)(t[n]))return!0;return!1}function ve(){var e=(0,v.geByClass1)("pattern_wrap"),t="pattern_composite";(0,v.hasClass)(e,t)?(0,v.removeClass)(e,t):(0,v.addClass)(e,t)}function fe(){}function be(e){var t=(0,v.ge)(document.activeElement);if(e.altKey)switch(-1!==[49,50,51,52,53,67,70,81,82,83,87].indexOf(e.keyCode)&&t&&t.blur(),e.keyCode){case 83:(0,y.activeTab)()===y.tabPattern?Y():(0,y.activeTab)()===y.tabReports&&(0,b.prepareReport)((0,b.activeReportsType)(),(0,b.activeSubReportsType)());break;case 70:if(-1!==[B,I].indexOf(vk.id))return de();break;case 81:ke("pattern_input");break;case 82:ke("conditions_regex");break;case 87:ke("conditions_simple");break;case 67:_e(),cur.conditions.deselectTemplate();break;case 49:cur.uiSearchPeriod.selectItem(1);break;case 50:cur.uiSearchPeriod.selectItem(24);break;case 51:cur.uiSearchPeriod.selectItem(72);break;case 52:cur.uiSearchPeriod.selectItem(240);break;case 53:cur.uiSearchPeriod.selectItem(2160)}}function ye(e){var t=(0,v.domData)(e,"owner_id"),n=(0,v.domData)(e,"story_id"),a=(0,v.domData)(e,"moderator_hash");cur.noStoriesBack=!0,(0,u.showStory)(`${t}/${t}_${n}/moderator_hash:${a}`)}function ke(e){if(e){var t=(0,c.getSelectionText)();switch(e){case"pattern_input":Q("pattern_input",t),cur.uiSimplify.selectItem("0");break;case"conditions_simple":case"conditions_regex":var n=document.getSelection().baseNode,a=(0,C.getFieldName)(n);if(!a)return;te("conditions_simple"===e?`'${t}' << ${a}`:`@check_regex('${Ce(t)}', ${a})`)}(0,C.removeSelectedText)()}}function Ce(e){return e.replace(/[.|+*(){}\[\]^$?]/g,"\\\\$&")}function we(){var e=window.pageNode,t=window.browser.msie6?e:window,n=(0,v.geByClass1)("_pattern_buttons",y.patternWrap),a=(0,f.createModule)({handlers:(e,a)=>{a(n,"click",j,Y),a(n,"click",M,de),a(n,"click","_get_pattern_link",oe),a(n,"click",H,re),a(y.consoleWrap,"click",F,z),a(y.consoleWrap,"click","_console_linkfield_action",(e=>ce(e))),a(y.consoleWrap,"click","_console_numfield_action",(e=>{var t=e.target,n=(0,v.domData)(t,"field");n!==$?ie(n):function(e){var t="nospam_console_custom_num_condition",n=()=>{var e=(0,v.ge)(P),t=(0,v.val)(e);if(t){var n={act:"a_numeric_field_add_condition",custom_condition:t};ajax.post("noSpam.php",n,{onDone:le.pbind()}),ie($,t)}else(0,s.notaBene)(e)},a={className:"nospam_console_custom_num_condition_wrap",text:(0,g.getTemplate)("nospam_console_custom_num_condition"),forcetodown:1,nohide:1,forceNoHide:1,shift:[10,8],showdt:0,onShowEnd:()=>{(0,v.elfocus)((0,v.ge)(P))},onShowStart:()=>{(0,v.val)(P,ls.get(t)||"")},init:a=>{o=a;var r=(0,v.ge)(P);(0,d.addEvent)(r,"keypress",(e=>(0,N.onEnter)(n,e))),(0,d.addEvent)(r,"keyup",(()=>ls.set(t,(0,v.val)(r))));var i=(0,v.geByClass1)("_nospam_console_custom_num_condition_close",(0,v.domPN)(r));(0,d.addEvent)(i,"click",(()=>e.tthide()))}};o?(o.show(),n()):(0,h.showTooltip)(e,a),r&&le(r)}(t)})),a(t,"click","_nospam_console_custom_num_condition_pattern",(e=>{var t=e.target,n=(0,g.unclean)((0,v.domData)(t,"pattern"));(0,v.val)(P,n)})),a(t,"click","_nospam_console_custom_num_condition_clear",(e=>{var t=e.target,n={act:"a_numeric_field_delete_condition",custom_condition:(0,g.unclean)((0,v.domData)(t,"pattern"))};ajax.post("noSpam.php",n,{onDone:le.pbind()})})),a(y.consoleWrap,"click","console_set_range",(e=>{var t=e.target,n=(0,v.domData)(t,"time");n<0?Q("time_finish_input",-n):n>0&&function(e){Q("time_start_input",e)}(n)})),a(y.consoleWrap,"click","console_uid",(e=>{e.altKey&&e.ctrlKey&&(Q("uid_input",e.target.dataset.uid),(0,d.cancelEvent)(e))})),e(t,"scroll",fe),e(document,"keydown",be),a(y.patternWrap,"click","_option_clear",(e=>{var t=e.target;me(t,(0,v.domData)(t,"option"),"clear")})),a(y.patternWrap,"click","_conditions_clear",(e=>{(0,v.domNS)(e.target).id.replace("conditions_input","");_e()})),a(document,"click","_console_conditions",(e=>{var t=e.target;te((0,v.domData)(t,"conditions"))})),a(y.consoleWrap,k.EVENT_MOUSEDOWN,C.CONTENT_STORY_THUMBNAIL,(e=>ye(e.target))),a(y.consoleWrap,k.EVENT_MOUSEDOWN,"_console_item_field_length",(e=>{var t=(0,C.getFieldName)(e.target);if(t){var n=e.target.dataset.length,a="=";switch(e.target.dataset.mode){case"less":a="<",n=Math.floor(1.3*n);break;case"greater":a=">",n=Math.round(.7*n)}te(`@length(${t}) ${a} ${n}`)}})),a(y.consoleWrap,"click","console_item_exclude_uid",(e=>{(0,v.addClass)(e.target.closest(".console_item"),"console_item_excluded"),te(`uid != ${e.target.dataset.uid}`)})),a(y.consoleWrap,"click","console_item_pattern_from_sample",(e=>{var t={pattern:"/",simplify:"simplify",uid:e.target.dataset.uid,ip:e.target.dataset.ip,ua_hash:e.target.dataset.ua,type:cur.uiSpamtype.val(),bantype:cur.uiBan.val(),duration:cur.uiDuration.val(),search_period:cur.uiSearchPeriod.val()};(0,k.openInNewTab)(ae(t))}))}});cur.destroy.push((()=>{(0,f.destroyModule)(a)}))}},168597:(e,t,n)=>{"use strict";n.d(t,{startDebugTimer:()=>r,debugLogTimer:()=>i});var a,o=n(787481);function r(){a=(new Date).getTime()}function i(){var e=(new Date).getTime(),t=(e-a)/1e3,n=Array.prototype.slice.call(arguments);n.push(t),o.debugLog.apply(null,n)}},581164:(e,t,n)=>{"use strict";n.d(t,{abortPatternMild:()=>u,noSpamPatterns:()=>_});var a,o,r,i=n(376852),s=n(40906),l=n(635676),c=n(315544),p=n(198019),d={};function u(e){ajax.post("noSpam.php",{act:"a_abort_pattern_mild",pid:e},{onDone:function(){(0,c.ge)("abort_pattern_mild"+e).innerHTML="<span style = 'color: green'>остановлен</span>"},onFail:function(){(0,c.ge)("abort_pattern_mild"+e).innerHTML="<span style = 'color: red'>ошибка</span>"}})}var _={patternTooltip:function(e,t){var n={content:d[t]?d[t].tooltip:"",className:"pattern_tt_wrap",nohideover:0,showsp:150,slide:15,hasover:0,shift:[5,0,0]};return(0,i.showTooltip)(e,n)},updateProcess:function(e){var t=(0,s.vkNow)();"patterns"===(0,p.activeTab)()&&-1!=window._wf&&((t-o>5e3||e)&&(ajax.post("noSpam.php",{act:"a_in_process"},{onDone:function(e){var t=(0,c.ge)("in_process");if(t)return e>0?(0,l.animateCount)(t,e):t.innerHTML=e},onFail:function(e){(0,c.ge)("in_process").innerHTML=e||"Неизвестная ошибка (banProcess)"}}),o=t),(t-a>1e4||e)&&(ajax.post("noSpam.php",{act:"a_last_patterns"},{onDone:function(e){var t=(0,c.geByClass1)("in_process_wrap");if(t){(0,c.show)(t);var n=e.table;delete e.table,d=e,(0,c.ge)("patterns").innerHTML=n}},onFail:function(e){var t=(0,c.geByClass1)("in_process_wrap");if(t)return t.innerHTML=e||"Неизвестная ошибка (pProcess)"}}),a=t))},clearTimer:function(){clearInterval(r)},initUpdate:function(){this.updateProcess(!0),r||(r=setInterval(this.updateProcess,1e3),cur.destroy.push(this.clearTimer))}}},25961:(e,t,n)=>{"use strict";n.d(t,{activeReportsType:()=>H,activeSubReportsType:()=>F,prepareReport:()=>A,dealSingleSpamer:()=>U,reportsTime:()=>G,onFiltersChange:()=>J,mount:()=>X,noSpamReports:()=>Y});n(175115),n(530522),n(66108),n(579665),n(95767),n(820075),n(751876),n(991181),n(296253);var a=n(376852),o=n(386409),r=n(787481),i=n(159121),s=n(786067),l=n(40906),c=n(982452),p=n(654612),d=n(803834),u=n(695724),_=n(315544),h=n(289988),m=n(341585),g=n(198019),v=n(168597),f=n(54),b=n(610124),y=n(363983),k=n(948588),C=n(961540);function w(){return w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},w.apply(this,arguments)}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,o=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var x="report_subfilter_active",L="active_filter",D="active_type",E=["botscore","hacked_score","secondary_score"],N="bish",B={},I={},R=new Date,M=setTimeout(null),j=0;function H(){var e=(0,_.geByClass1)(L,g.reportTabs);return(0,_.domData)(e,"type")}function F(){var e=(0,_.geByClass1)("_reports_subtabs",g.reportTabs),t=(0,_.geByClass1)(L,e);return(0,_.domData)(t,"subtype")}function A(e,t){var n=(0,_.geByClass1)("_report_btn_update",g.reportList),a=(0,_.geByClass1)("_reports_"+e+"_wrap",g.reportList);if(!(0,o.isButtonLocked)(n))if(a){(0,v.startDebugTimer)();var r={act:"a_get_reports",encode_entities:1,type:e,sub_type:t,shift:cur.options.shift};"mail"===e&&"mail_group"===t&&(r=(0,u.extend)(r,function(){if("mail"===e||"mail_group"===t){var n=(0,_.geByClass1)("filters");return{hide_groups_with_disabled_messages:(0,o.isChecked)((0,_.geByClass1)("hide_groups_with_disabled_messages_filter",n)),shift:(0,l.isObject)(cur.hoursShiftSlider)?23*cur.hoursShiftSlider._currValue:0,min_reporters_amount:(0,_.val)((0,_.geByClass1)("min_reports_amount_filter",n)),sorting:(0,o.radioval)("group_messages_reports_sorting")}}console.log("Unsupported filters used")}())),ajax.post("noSpam.php",r,{onDone:function(t){if((0,v.debugLogTimer)("actions fetch"),B={},0!==t.length){for(var n=0;n<t.length;n++){var o=t[n];o.ui_type=e;var r=P(o.ui_type,n);z(o.ua_hash,o.agent_name),delete o.agent_name,delete o.remix_seed,o.index=n,B[r]=o}a.innerHTML="",O(e,0),t=""}else a.innerHTML=(0,u.getTemplate)("nospam_reports_type_search_empty")},onFail:function(e){(0,v.debugLogTimer)("actions fetched fail"),(0,i.topError)(e),a.innerHTML=(0,u.getTemplate)("nospam_reports_type_search_error")},showProgress:o.lockButton.pbind(n),hideProgress:o.unlockButton.pbind(n)}),(0,d.scrollToTop)()}else(0,i.topError)("Can't find wrap for type: "+e)}function P(e,t){return"report_"+e+"_"+t}function O(e,t,n){(0,v.startDebugTimer)(),n||(n=20);var a=(0,_.geByClass1)("_reports_"+e+"_wrap",g.reportList),o=(0,_.domPN)(a),i=(0,_.geByClass1)("_reports_type_show_more",o),c=0,p=0,d=0,h=function(){p=d,d++;var n=P(e,p),o=B[n];if(p<t)return"continue";if("object"!=typeof o)return(0,r.debugLog)("empty reports after "+p,"need to shift "+t),"break";if(!o.uid)return"continue";if(!0===o.showed)return"continue";var i=(0,_.ce)("div",{id:"report_"+e+"_"+p});(0,_.addClass)(i,"clear_fix"),(0,_.addClass)(i,"report");var h=o.uid_base_info;if(o.mem_banned||h){if((0,g.getCustomOption)("reports_hide_processed")&&h)return"continue";var m=h&&!o.pattern_additional_info.is_auto_report?"processed":"banned_others";(0,_.addClass)(i,m)}o.ui_type=e;var v=function(e){var t,n=e.mem_banned,a=(0,l.isObject)(n),o=!1,r=(0,_.ce)("div");(0,_.addClass)(r,"report_info"),a&&((0,_.addClass)(r,"report_banned"),o=Number(n.ban_time)<0);var i,c=e.uid,p=Number(e.type),d=a?"red":"blue",h=o?"forever":"";t=c>0?(0,u.getTemplate)("nospam_reports_id_link",{type:"id",id:c,label:c,color:d}):(0,u.getTemplate)("nospam_reports_id_link",{type:"club",id:-c,label:c,color:d});var m=S(W(e),2);i=m[1],e.ui_type!==N||i||(i=e.type_name);return r.innerHTML=(0,u.getTemplate)("nospam_reports_report_info",{action_mention_link:t,ban_time_class:h,type:p,index:e.index,ip:e.ip,report_time:V(new Date(1e3*e.report_time)),action_time:V(new Date(1e3*e.time)),ua_hash:e.ua_hash,from_uid:e.from_uid,report_count:e.report_count>1?(0,s.langNumeric)(e.report_count,["","%s жалоба","%s жалобы","%s жалоб"]):"",report_type_link:i}),r}(o),f=void 0;f=S(W(o),1)[0];var b=function(e,t){var n="",a="report_"+e.ui_type+"_"+e.index,o=(0,_.ce)("div");(0,_.addClass)(o,"report_steps");var r=cur.isSearchOnlyMode;if(("photo"===e.ui_type||"video"===e.ui_type)&&!r){var i=e[e.ui_type+"_id"];n+="<a id = 'spamer_by_"+a+'\' class="flat_button button_small secondary" onclick = "'+`dealSingleSpamer('${e.ui_type}', ${e.index}, ${e.uid}, '${e.deal_single_spamer_hash}', ${e.type}, ${e.time}, ${e.owner_id}, ${i})`+'">Забанить и откатить</a>'}n+=(0,u.getTemplate)("nospam_reports_compose_button",{type:e.real_ui_type?e.real_ui_type:e.ui_type,ip:e.ip,ua_hash:e.ua_hash}),r||(n+=function(e){var t=e.first_attached_photo_kid,n=e.first_attached_doc_md5,a=e.first_attached_doc_size,o=e.first_attached_video_content_id;if(t)return(0,u.getTemplate)("nospam_reports_cp_fast_pattern_photo",{kid:t});if(o)return(0,u.getTemplate)("nospam_reports_cp_fast_pattern_video",{content_id:o});if(n&&a)return(0,u.getTemplate)("nospam_reports_cp_fast_pattern_doc",{md5:n,size:a});return""}(e));e.ui_type===N&&(n+=(0,u.getTemplate)("nospam_reports_spamfeed_tag",{tag_text:e.spamfeed_tag,report_link:e.spamfeed_report_link}));return n+="<span id='selected_text_span"+t+"' style='display:none;'></span>",o.innerHTML=n,o}(o,p);[v,f,b].forEach((function(e){i.appendChild(e)})),a.appendChild(i),c++};e:for(;c<n;){switch(h()){case"continue":continue;case"break":break e}}if(0!==c){i?(0,_.isVisible)(i)||(0,_.show)(i):(i=(0,_.ce)("div",{className:"reports_type_show_more _reports_type_show_more"}),o.appendChild(i));var m=parseInt(t)+20;i.innerHTML=(0,u.getTemplate)("nospam_reports_show_more",{need_shift:m}),(0,v.debugLogTimer)("actions to html")}else(0,_.hide)(i)}function $(){var e=(0,c.getSelectionText)();e?cur.uiSimplify.selectItem("0"):(e="/",cur.uiSimplify.selectItem("32")),(0,_.val)("pattern_input",e)}function W(e){var t,n="",a=e.type_name,o=parseInt(e.type),r=(0,_.ce)("div");(0,_.addClass)(r,"report_body report_body_regular"),e.api_id>0&&(n+=e.api_id>0?`<div class="report_api">Приложение ${e.app_name} (${e.api_id}):</div>`:""),e.message&&(n+=(0,u.getTemplate)("nospam_reports_field",{class:"report_message",value:e.message})),e.kludges&&(n+=(0,u.getTemplate)("nospam_reports_field",{class:"reports_kludges",value:e.kludges})),e.attaches&&(n+=(0,u.getTemplate)("nospam_reports_attaches",{attaches:e.attaches}));var i="";switch(o){case 500:case 510:case 545:t="<a href='/wall"+e.owner_id+"_"+e.msg_id+"' target='_blank'> "+a+"</a>";break;case 501:case 550:t="<a href='/wall"+e.owner_id+"_"+e.parent_id+"?reply="+e.msg_id+"' target='_blank'> "+a+"</a>",e.group_id&&e.group_link&&(n+=(0,u.getTemplate)("nospam_reports_group_id",{group_id:e.group_id,group_link:e.group_link}));break;case 100:e.score&&e.score.hasOwnProperty("phone_cheat")&&(i+=(0,u.getTemplate)("nospam_reports_score_block",{label:"phone_cheat",score:e.score.phone_cheat})),e.update_time&&(n+=(0,u.getTemplate)("nospam_reports_tag",{tag_label:e.update_time})),e.uid%2==1&&e.ui_type!==N&&(r.classList.remove("report_body_regular"),r.classList.add("report_body_odd"));break;case 200:n+=(0,u.getTemplate)("nospam_reports_labeled_value",{label:"receivers_num",value:e.receivers_num}),n+=(0,u.getTemplate)("nospam_reports_labeled_value",{label:"chat_msg_id",value:e.chat_msg_id}),n+=(0,u.getTemplate)("nospam_reports_labeled_value",{label:"chat_title",value:e.chat_title});break;case 300:if(e.group_id&&e.group_link&&(n+=(0,u.getTemplate)("nospam_reports_group_id",{group_id:e.group_id,group_link:e.group_link})),e.admin_id&&e.admin_link){var s=e.admin_id;n+=(0,u.getTemplate)("nospam_reports_admin_id",{admin_id:s,admin_link:e.admin_link})}break;case 160:n+=e.title;break;case 161:n+=e.new_title;break;case 200:-152029297==e.uid&&e.original_user_link&&(n+=(0,u.getTemplate)("nospam_reports_molodec_label",{original_user_link:e.original_user_link}));case 2602:case 2647:t="<a href='/video"+e.owner_id+"_"+e.video_id+"' target='_blank'> "+a+"</a>";break;case 2600:case 2610:case 2611:case 2645:case 2650:t="<a href='/video"+e.owner_id+"_"+e.video_id+"' target='_blank'> "+a+"</a>",n+=e.video_thumb,n+='<div class="report_custom_field"><b>duration:</b> <a class="_console_conditions" data-conditions="duration = '+e.duration+'">',n+=e.duration+"</a></div>",e.external&&(n+='<div class="report_custom_field"><b>external:</b> '+e.external+"</div>"),Number(e.folder_id)&&(n+=`<div class="report_custom_field"><b>folder_id:</b> ${e.video_folder_name} (${e.folder_id})</div>`);break;case 3504:case 3545:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+a+"</a>";break;case 13120:case 13121:t="<a href='/market"+e.owner_id+"?w=product"+e.owner_id+"_"+e.item_id+"' target='_blank'> "+a+"</a>";break;case 3500:case 3547:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+a+"</a>",n+='<table class="report_photo"><tr>',n+='<td><div class="report_photo_thumb">'+e.photo+"</div></td>",n+=e.description?'<td><div class="report_photo_description">'+e.description+"</div></td>":"",n+="</tr></table>",n+=e.album_id<0?'<div class="report_album_id"><b>album_id:</b> '+e.album_id+"</div>":"";break;case 3550:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+a+"</a>",n+=e.photo,n+=e.album_id<0?'<div class="report_album_id"><b>album_id:</b> '+e.album_id+"</div>":"";break;case 9258:n+=e.about;break;case 1800:n+=e.status;break;case 1531:case 1530:case 1534:n+=(0,u.getTemplate)("nospam_reports_field",{class:"report_message",value:e.text});break;case 5e3:t="<a href='/topic-"+e.group_id+"_"+e.topic_id+"' target='_blank'> "+a+"</a>",n+=e.title;break;case 5001:case 5046:t="<a href='/topic-"+e.group_id+"_"+e.topic_id+"?post="+Math.abs(e.comment_id)+"' target='_blank'> "+a+"</a>";break;case 2131:var l=e.group_id;t="Группа: "+(0,u.getTemplate)("nospam_reports_id_link",{type:"club",id:l,label:l,color:"black"}),n+="<b>Название:</b>"+e.group_name+"<br>",n+="<b>Описание:</b>"+e.group_description+"<br>";break;case 7530:t="<a href='/app"+e.app_id+"' target='_blank'> "+a+"</a>",n+=e.app_name+"<br>";break;case 3670:var c=e.like_ref,p=e.like_type,d=e.owner_id+"_"+e.item_id,h="",m=(0,C.getHostName)();switch(Number(p)){case 11:t="<a href='wall<a href='wall"+d+"' target='_blank'> "+a+"</a>",h+="(запись на стене), <a href='wall"+d+"' target='_blank'>"+m+"/wall"+d+"</a>";break;case 12:t="<a href='wall"+d+"' target='_blank'> "+a+"</a>",h+="(комментарий на стене), <a href='wall"+d+"' target='_blank'>"+m+"/wall"+d+"</a>";break;case 10:t="<a href='photo"+d+"' target='_blank'> "+a+"</a>",h+="(фотография), <a href='photo"+d+"' target='_blank'>"+m+"/photo"+d+"</a>";break;case 24:case 8:t="<a href='photo"+d+"' target='_blank'> "+a+"</a>",h+="(видеозапись), <a href='video"+d+"' target='_blank'>"+m+"/video"+d+"</a>";break;case 6:t="<a href='audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"' target='_blank'> "+a+"</a>",h+="(аудиозапись), <a href='audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"' target='_blank'>"+m,h+="/audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"</a>";break;case 22:t=a,h+="(комментарий к видео)";break;case 21:t=a,h+="(комментарий к фотографии)";break;case 20:t=a,h+="(комментарий на стене)";break;default:t=a,h+=" (незвестный тип) "+d}n+=(0,u.getTemplate)("nospam_reports_report_like",{like_ref:c,like_ref_id:e.ref,like_type:h,like_type_id:p});break;case 3522:var v=e.mini_app_link?(0,u.getTemplate)("nospam_reports_labeled_value",{label:"mini_app_id",value:`${e.mini_app_id} (${e.mini_app_link})`}):"",f=e.texts?(0,u.getTemplate)("nospam_reports_labeled_value",{label:"texts",value:e.texts}):"",b=e.attachment_link_url?(0,u.getTemplate)("nospam_reports_labeled_value",{label:"attachment_link_url",value:e.attachment_link_url}):"",y=e.owner_link?(0,u.getTemplate)("nospam_reports_labeled_value",{label:"owner_id",value:`${e.owner_id} (${e.owner_link})`}):"";n+=(0,u.getTemplate)("nospam_reports_report_story",{story_thumbnail:e.story,mini_app_row:v,texts_row:f,attachment_link_row:b,owner_row:y});break;default:console.log("No type specified")}if(e.post_tags){var k=e.post_tags;Object.keys(k).forEach((function(e){k[e]&&(n=(0,u.getTemplate)("nospam_reports_tag",{tag_label:k[e]})+n)}))}if(e.score){var w=function(e){if(0===e.length)return!1;var t=[];for(var n in e)E.includes(n)&&t.push([n,e[n]]);if(0===t.length)return!1;return t.sort(((e,t)=>t[1]-e[1])),t[0]}(e.score);w&&(i+=(0,u.getTemplate)("nospam_reports_score_block",{label:w[0],score:w[1]})),n+=(0,u.getTemplate)("nospam_reports_scores",{score_blocks:i})}return n+=function(e){var t,n,a=e.uid_base_info,o=e.mem_banned,r="",i="";if(a){var s=e.pattern_additional_info;t=Number(a[0].pattern_id),n=Number(a[0].state);var l=(c=s.admin_name,p=Number(a[1].admin_id),d=c.split(" ").reduce(((e,t)=>e+t[0]),""),(0,u.getTemplate)("nospam_reports_id_link",{type:"id",id:p,label:d,color:"black"}));r=`${0===n?"Обрабатывается: ":"Обработан: "} шаблон <a href='/pattern${t}' target='_blank'>${t}</a> (${s.pattern_type_name}; ${s.pattern_params}) от ${l}`}var c,p,d;o&&(i=`${V(new Date(1e3*o.time))}: ${o.comment}`);if(!(0,g.getCustomOption)("reports_hide_ban_info")&&(a||o))return`<div class="BannerInfo"><div class="report_processed_info">${r}</div><div>${i}</div></div>`;return""}(e),r.innerHTML=n,[r,t]}function U(e,t,n,a,o,r,i,s){var l="report_"+e+"_"+t,c=y.reportsRollbackSpamerDone,p=y.reportsRollbackSpamerFail;"photo"===e?(0,y.rollbackPhotoSpamer)(n,a,o,r,i,s,(()=>c(l)),(()=>p(l))):"video"===e&&(0,y.rollbackVideoSpamer)(n,a,o,r,i,s,(()=>c(l)),(()=>p(l)))}function V(e){var t=e.getDate(),n=e.getMonth()+1;return(t<10?"0":"")+t+"."+(n<10?"0":"")+n+" в "+e.toLocaleTimeString()}var G={_sel:[],day:R.getDate(),month:R.getMonth(),months:[[0,"Января"],[1,"Февраля"],[2,"Марта"],[3,"Апреля"],[4,"Мая"],[5,"Июня"],[6,"Июля"],[7,"Августа"],[8,"Сентября"],[9,"Октября"],[10,"Ноября"],[11,"Декабря"]],year:R.getFullYear(),generateHMS:function(e){var t,n=[];switch(e){case"hour":t=23;break;case"minute":case"second":t=59}for(var a=0;a<=t;++a)n.push([a,a<10?"0"+a:a+""]);return n},generateDays:function(e,t){for(var n=[],a=(0,h.getLastDay)(e,t),o=1;o<=a;++o)n.push([o,o+""]);return n},updateDays:function(){var e=this._sel[0],t=Number(this._sel[1].val())+1,n=this._sel[2].val();e.val()>(0,h.getLastDay)(n,t)&&e.clear(),e.setData(this.generateDays(n,t))},setControls:function(){var e=G,t=[["reports_day",55],["reports_month",95],["reports_year",60],["reports_hour",50],["reports_minute",50],["reports_second",50]],n=(0,_.ce)("div",{id:"reports_time_wrap",className:"reports_time_wrap"}),a=(0,_.geByClass1)("box_body");e.clear(),a.appendChild(n),t.forEach((function(n,o){var r=[],i=[],s=(0,_.ce)("div",{className:n[0]+" fl_l"}),l=(0,_.ce)("input",{type:"hidden",name:n[0],id:n[0]}),c=n[0].split("_")[1];switch((0,_.domLC)(a).appendChild(s),s.appendChild(l),c){case"year":i=(r=[[e.year-1,String(e.year-1)],[e.year,e.year+""]])[1];break;case"month":r=e.months,i=e.month;break;case"day":i=(r=e.generateDays(e.year,e.month+1))[e.day-1];break;case"hour":case"minute":case"second":r=e.generateHMS(c),i=0;break;default:i=r=e[c]}var p={width:t[o][1],multiselect:!1,autocomplete:!1,selectedItems:i};"month"!==c&&"year"!==c||(0,u.extend)(p,{onChange:function(e){G.updateDays()}}),G._sel.push(new Dropdown(l,r,p))}))},setTime:function(){boxQueue.hideLast();var e=G,t=e._sel,n={day:t[0].val(),month:t[1].val(),year:t[2].val(),hour:t[3].val(),minute:t[4].val(),second:t[5].val()},a=new Date(n.year,n.month,n.day,n.hour,n.minute,n.second),o=e.tt;(0,_.val)(o,a.getTime()/1e3)},set:function(e,t){var n=this.setControls,a=this.setTime,o=(0,_.domData)(t,"part");R=new Date;var r=o?"time_"+e+"_input2":"time_"+e+"_input";this.tt=(0,_.ge)(r,g.patternWrap),(0,p.showFastBox)({width:435,title:"Время действия ("+("start"==e?"позже":"раньше")+", чем)",dark:1,containerClass:"nospam_report_time_box",onShow:n},'<div class="reports_time_label">Укажите дату:</div>',"Применить",a)},clear:function(){return this._sel=[]}};function K(e){(0,f.isSpecialKeyPressed)(e)?function(e){var t=(0,m.getParams)();if(t.type=(0,_.domData)(e,"type"),null===t.type)return!1;"post"!==t.type&&"comment"!==t.type||(t.type="wall");t.ip=(0,_.domData)(e,"ip"),t.uahash=(0,_.domData)(e,"ua-hash"),t.pattern=t.pattern||(0,c.getSelectionText)(),t.threshold=1;var n=(0,m.composeSearchLinkFromParams)(t);(0,f.openInNewTab)(n)}(e.target):function(e){var t=(0,_.domData)(e,"type"),n=(0,_.domData)(e,"ip"),a=(0,_.domData)(e,"ua-hash");if(null===t)return;"post"!=t&&"comment"!=t||(t="wall");(0,m.setIp)(n),(0,m.setUaHash)(a),(0,m.setThreshold)(1),cur.uiSpamtype.selectItem(t),(0,g.switchTab)(g.tabPattern),(0,m.optionClear)(!1,"reset_all")}(e.target)}function z(e,t){var n=I[e];I[e]?n&&n!==t&&(0,r.debugLog)("collision for "+e,t,n):I[e]=t}function q(){if((0,g.getCurrentTab)()===g.tabReports){var e=H(),t=(0,_.geByClass1)("_reports_"+e+"_wrap",g.reportList),n=(0,_.geByClass1)("_report_show_more",(0,_.domPN)(t)),a=(0,_.domPN)(n),o=window.innerHeight||document.documentElement||bodyNode.clientHeight;j=(0,d.scrollGetY)(),(0,_.isVisible)(a)&&(0,g.activeTab)()===g.tabReports&&o+j>n.offsetTop&&n.click()}}function J(){clearTimeout(M),M=setTimeout(A.pbind(H(),F()),1e3)}function X(){var e=(0,b.createModule)({handlers:(e,t)=>{t(g.reportList,"mouseover","report_steps",$),t(g.reportList,"click","report_steps",(e=>K(e))),t(g.reportList,"click","fast_pattern",(e=>function(e){var t=e.target,n=t.getAttribute("data-fast-pattern-type"),a={act:"apply_pattern",pattern:"/",simplify:32,search_period:72,duration:8,bantype:0,comment:"#child_porn Боты или взломанные с ДП-контентом для увода в Телеграм (автошаблон из жалобы на комментарий)",pattern_added_short_output:!0},r={};switch(n){case"photo":r={conditions:`type = 3500 && album_id IN (-7, -8) && kid = '${t.getAttribute("data-kid")}'`};break;case"video":r={conditions:`type = 2600 && content_id = ${t.getAttribute("data-content_id")}`};break;case"docs":s=t.getAttribute("data-md5"),l=t.getAttribute("data-size"),r={conditions:`type = 5300 && md_five = '${s}' && size = ${l} && ext IN ('gif', 'png', 'jpg')`}}var s,l;if(0!==Object.keys(r).length){var c=w({},a,{},r,{type:n});ajax.post("noSpam.php",c,{onDone:e=>{t.outerHTML=`<span>${e.pattern_applied_text}</span>`},onFail:()=>{(0,i.topError)("Ошибка при установке шаблона"),t.outerHTML="<span>Ошибка</span>"},showProgress:o.lockButton.pbind(t),hideProgress:o.unlockButton.pbind(t)})}}(e))),t(g.reportList,"mouseover","report_info_ban_tooltip",(e=>function(e){var t=e.target,n=(0,_.domData)(t,"action-index"),o=B[n].ban_tt;o&&(0,a.showTooltip)(t,{text:o,dir:"down",hasover:1,shift:[22,5,0]})}(e))),t(g.reportList,"mouseover","report_info_ua_hash",(e=>function(e){var t=e.target,n=(0,_.domData)(t,"ua-hash"),o=I[n];(0,a.showTooltip)(t,{text:o||"[NULL]",dir:"down",hasover:1,shift:[22,5,0]})}(e))),e(document,"scroll",q),t(g.reportList,"click","_report_show_more",(e=>{var t=(0,_.domData)(e.target,"need-shift");O(H(),t)})),t(g.reportTabs,"click","report_filter",(e=>function(e){var t=e.target,n=(0,_.domData)(t,"type"),a=(0,_.domData)(t,"subtype"),o=(0,_.geByClass)("report_filter",g.reportTabs),r=(0,_.geByClass)("report_subfilter",g.reportTabs),i=(0,_.geByClass1)(D,g.reportList);if(!n)return!1;o.forEach((e=>{(0,_.hasClass)(e,L)&&(0,_.removeClass)(e,L),(0,_.domData)(e,"type")!==n||(0,_.domData)(e,"subtype")||(0,_.addClass)(e,L)}));var s=!1,l=!1;r.forEach((e=>{(0,_.removeClass)(e,x),(0,_.removeClass)(e,L),(0,_.domData)(e,"type")===n&&((0,_.addClass)(e,x),s=!0),(0,_.domData)(e,"subtype")===a&&((0,_.addClass)(e,L),l=!0)}));var c=(0,_.geByClass1)("hr",g.reportTabs);if(s?(0,_.show)(c):(0,_.hide)(c),s&&!l){var p=(0,_.geByClass1)(x,g.reportTabs);(0,_.addClass)(p,L)}(0,_.domData)(i,"type")!==n&&((0,_.removeClass)(i,D),(0,_.addClass)((0,_.ge)("reports_"+n),D)),A(n,a)}(e))),t(g.reportList,"click","_report_btn_update",(e=>{A(H(),F())})),t(g.reportList,"click",k.CONTENT_STORY_THUMBNAIL,(e=>{(0,m.showUserStory)(e.target)})),t(g.reportTabs,"mouseover","settings_dots_wrap",(e=>{var t=(0,_.geByClass1)("settings_dots_wrap");(0,a.showTooltip)(t,{black:!0,text:(0,u.getTemplate)("reports_group_message_tab_tooltip"),className:"group_messages_settings_tt",slideY:15,shift:[98,100,20],dir:"top",showdt:300,hidedt:100,hasover:!0,onCreate:function(){var e;e=(0,_.ge)("search_shift_filter"),cur.hoursShiftSlider=new window.Slider(e,{width:200,height:100,debounce:10,size:2,value:parseFloat(nav.objLoc.shift/23)||0,onChange:e=>{(0,f.updateUrl)({shift:parseInt(23*e)}),J()},formatHint:e=>(0,s.langNumeric)(parseInt(23*e),["","%s час назад","%s часа назад","%s часов назад"])}),(0,f.initRadioButtons)("group_messages_reports_sorting","sorting_radio_filter_wrap",1)}})}))}});cur.destroy.push((()=>{(0,b.destroyModule)(e)}))}var Y={initUpdate:function(){(0,d.scrollToY)(j)}}},363983:(e,t,n)=>{"use strict";n.d(t,{rollbackDocMailSpamer:()=>r,rollbackDocWallSpamer:()=>i,rollbackJpgMailSpamer:()=>s,rollbackJpgWallSpamer:()=>l,rollbackPngMailSpamer:()=>c,rollbackPngWallSpamer:()=>p,rollbackDocSpamer:()=>d,rollbackPhotoSpamer:()=>u,rollbackPhotoSpamerFromWall:()=>_,rollbackPhotoSpamerFromMail:()=>h,rollbackVideoSpamer:()=>m,rollbackVideoSpamerFromWall:()=>g,rollbackVideoSpamerFromMail:()=>v,reportsRollbackSpamerDone:()=>y,reportsRollbackSpamerFail:()=>k});var a=n(315544),o="green_item";function r(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_docmail_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_docmail_spamer",uid:e,hash:t,act_type:n,spam_date:a,to_id:o,to_msg_id:r},{onDone:i,onFail:s})}function i(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_docwall_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_docwall_spamer",uid:e,hash:t,act_type:n,spam_date:a,owner_id:o,msg_id:r},{onDone:i,onFail:s})}function s(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_jpgmail_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_jpgmail_spamer",uid:e,hash:t,act_type:n,spam_date:a,to_id:o,to_msg_id_id:r},{onDone:i,onFail:s})}function l(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_jpgwall_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_jpgwall_spamer",uid:e,hash:t,act_type:n,spam_date:a,owner_id:o,msg_id:r},{onDone:i,onFail:s})}function c(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_pngmail_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_pngmail_spamer",uid:e,hash:t,act_type:n,spam_date:a,to_id:o,to_msg_id:r},{onDone:i,onFail:s})}function p(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_pngwall_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_pngwall_spamer",uid:e,hash:t,act_type:n,spam_date:a,owner_id:o,msg_id:r},{onDone:i,onFail:s})}function d(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_doc_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_doc_spamer",uid:e,hash:t,act_type:n,spam_date:a,owner_id:o,doc_id:r},{onDone:i,onFail:s})}function u(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_photo_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_photo_spamer",uid:e,hash:t,act_type:n,spam_date:a,owner_id:o,photo_id:r},{onDone:i,onFail:s})}function _(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_photo_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_photo_spamer_from_wall",uid:e,hash:t,act_type:n,spam_date:a,owner_id:o,msg_id:r},{onDone:i,onFail:s})}function h(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_photo_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_photo_spamer_from_mail",uid:e,hash:t,act_type:n,spam_date:a,to_id:o,to_msg_id:r},{onDone:i,onFail:s})}function m(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_video_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_video_spamer",uid:e,hash:t,act_type:n,spam_date:a,owner_id:o,video_id:r},{onDone:i,onFail:s})}function g(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_video_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_video_spamer_from_wall",uid:e,hash:t,act_type:n,spam_date:a,owner_id:o,msg_id:r},{onDone:i,onFail:s})}function v(e,t,n,a,o,r){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>f(t,e,"rollback_video_spamer"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;ajax.post("noSpam.php",{act:"rollback_video_spamer_from_mail",uid:e,hash:t,act_type:n,spam_date:a,to_id:o,to_msg_id:r},{onDone:i,onFail:s})}function f(e,t,n){(0,a.ge)(n+t).innerHTML=e,function(e){var t=(0,a.ge)("console_item_"+e);(0,a.hasClass)(t,o)&&(0,a.removeClass)(t,o),(0,a.addClass)(t,"red_item")}(t)}function b(){return null}function y(e){(0,a.ge)("spamer_by_"+e).outerHTML="<span style = 'color: green'> Добавлен </span>",document.getElementById(e).classList.add("processed")}function k(e){(0,a.ge)("spamer_by_"+e).outerHTML="<span style = 'color: red'> Неудача </span>"}},915087:(e,t,n)=>{"use strict";n.d(t,{noSpamSuspicious:()=>l});var a=n(695724),o=n(786067),r=n(159121),i=n(40906),s=n(315544),l={selected:"ua_hash",updateOnSelect:function(){return l.getByType(l.selected)},getSpamType:function(){return(0,i.isObject)(this.spamtype)?this.spamtype._selected[0]:"wall"},getPeriod:function(){return(0,i.isObject)(this.period)?this.period._selected[0]:1},getByType:function(e){var t=(0,s.ge)("suspicious_table"),n=(0,s.geByClass1)("summary_tab_sel","suspicious_tabs"),i=(0,s.isVisible)("suspicious_tabs")?0:1,l=this;this.selected=e;var c=(0,s.ge)("suspicious_spamtype"),p=(0,s.ge)("suspicious_period"),d=(0,s.geByClass)("_suspicious_msg"),u=(0,s.geByClass1)("_suspicious_"+e+"_msg");(0,a.each)(d,(function(e,t){(0,s.hide)(t)})),(0,s.show)(u),"hashtags"==e?(0,s.hide)(c):(0,s.show)(c),"users"==e&&(0,s.hide)(c,p),i&&(t=(0,s.ge)("suspicious")),(0,s.removeClass)(n,"summary_tab_sel");var _={act:"a_get_suspicious",type:e,spamtype:this.getSpamType(),period:this.getPeriod(),need_tabs:i};(0,s.addClass)("suspicious_"+e,"summary_tab_sel"),ajax.post("noSpam.php",_,{onDone:function(e){if(!e)return(0,r.topError)((0,o.getLang)("nospam_suspicious_data_error"));t.innerHTML=e,l.initInlineDropdown()},progress:"suspicious_progress"})},initInlineDropdown:function(){var e={withArrow:!0,keepTitle:!0,autoShow:!0,autoHide:300,onSelect:l.updateOnSelect},t=(0,a.extend)({items:cur.options.spamtypes,selected:"wall"},e),n=(0,a.extend)({items:[[1,"Один час"],[2,"Два часа"],[5,"5 часов"],[10,"10 часов"],[24,"Сутки"]],selected:1},e);this.spamtype||(this.spamtype=new InlineDropdown("suspicious_spamtype",t)),this.spamtype._els.valueEl.innerHTML=this.spamtype._selected[1],this.period||(this.period=new InlineDropdown("suspicious_period",n)),this.period._els.valueEl.innerHTML=this.period._selected[1]}}},768099:(e,t,n)=>{"use strict";n.d(t,{NoSpamTemplates:()=>h});n(59357),n(820075);var a=n(635429),o=n(786067),r=n(386409),i=n(787481),s=n(40906),l=n(654612),c=n(486125),p=n(315544),d=n(695724),u=n(341585),_=n(948588),h=function(e){this.selected=0,(0,d.extend)(this,e),this.templates=JSON.parse(e.templates)};h.prototype={addTemplate:function(){(0,l.showBox)("noSpam.php",{act:this.acts.add},{params:{width:430,dark:1,progress:"add_template"}})},saveTemplate:function(e){var t=cur[e],n=t.selected||0;if((0,p.ge)("add_template_title")&&(0,p.ge)("add_template_text")){var a=(0,d.trim)((0,p.ge)("add_template_title").value),o=(0,d.trim)((0,p.ge)("add_template_text").value);if(!a)return(0,r.notaBene)("add_template_title");if(!o)return(0,r.notaBene)("add_template_text");var i={act:t.acts.save,title:a,text:o,hash:t.hash,template_id:n};ajax.post("noSpam.php",i,{onDone:function(e,n){var a=(0,p.ge)(t.links);a.innerHTML=e,(0,p.hasClass)(a,"template_links")||(0,p.addClass)(a,"template_links"),t.templates=JSON.parse(n),(0,c.curBox)().hide()},progress:n?"edit_template":"add_template"})}},editTemplate:function(){var e={act:this.acts.edit,template_id:this.selected,hash:this.hash};(0,l.showBox)("noSpam.php",e,{params:{width:430,dark:1,progress:"edit_template"}})},deleteTemplate:function(){var e=this;if(!this.selected)return!1;(0,l.showFastBox)({title:"Удаление шаблона",width:430,dark:1,progress:"delete_condition"},(0,o.getLang)("nospam_delete_template"),(0,o.getLang)("global_delete"),(function(){var t=e.selected,n={act:e.acts.remove,template_id:t,hash:e.hash};ajax.post("noSpam.php",n,{onDone:function(t,n){var a=(0,p.ge)(e.links);a.innerHTML=t,e.deselectTemplate(),e.templates=JSON.parse(n),(0,s.isObject)(e.templates)||(0,p.removeClass)(a,"template_links"),(0,c.curBox)().hide()},progress:"delete_condition"})}),(0,o.getLang)("global_cancel"))},selectTemplate:function(e){if(e){var t=this.templates[e];this.selected=e;var n=(0,_.entityDecode)(t.text);(0,u.setConditions)(n),this.label.innerHTML=t.title+": ",(0,p.addClass)(this.wrap,"template_selected")}},selectCommentTemplate:function(e){if(e){var t=this.templates[e];this.selected=e;var n=(0,_.entityDecode)(t.text);this.editComment(n),this.label.innerHTML=t.answer_name+": ",(0,p.addClass)(this.wrap,"template_selected")}},editComment:function(e){if((0,p.val)(this.input,e),this.input.autosize)return this.input.autosize.update();(0,a.autosizeSetup)("comment_input",{minHeight:32})},getFromLocal:function(e){var t=localStorage.comments_templates_storage;try{t=JSON.parse(t)}catch(e){}return t?t&&e?((0,d.each)(t,(function(e,t){var n=function(e,t){var n=(0,p.ge)("comment_template_links");(0,p.hasClass)(n,"template_links")||(0,p.addClass)(n,"template_links"),cur.comment.links.innerHTML=e,cur.comment.templates=JSON.parse(t)};setTimeout((function(){var e=t[1];ajax.post("noSpam.php",{act:"save_comment_template",title:e.name,text:e.comment,hash:opts.comment_hash,template_id:0},{onDone:n})}),1e3*e)})),(0,c.curBox)().hide()):void(0,l.showBox)("noSpam.php",{act:"apply_comments_export"},{params:{width:430,dark:1,progress:"export_progress"}}):(0,l.showFastBox)({title:"Перенос шаблонов",dark:1},"К сожалению, не удалось найти ни одного комментария.")},deselectTemplate:function(){var e=this.selected,t=this.templates[e];if(t){var n=(0,_.entityDecode)(this.templates[e].text);t&&this.input.value==n&&(0,p.val)(this.input,""),this.label.innerHTML=this.label_html,(0,p.removeClass)(this.wrap,"template_selected"),delete this.selected}},editSort:function(){var e={act:this.acts.sort,hash:this.hash};(0,l.showBox)("noSpam.php",e,{params:{width:430,dark:1,progress:"sort_template"}})},saveSort:function(e,t,n,a,o){var r=cur[e],s={hash:t,act:r.acts.sort_save,tid:n.id.replace("template",""),tpos:n.dataset.pos,after_id:a&&a.dataset?a.dataset.pos:"",before_id:o&&o.dataset?o.dataset.pos:""};ajax.post("noSpam.php",s,{onDone:function(e,t){var n=(0,c.curBox)();n.content(e[2]),n.evalBox(t),n.setOptions({onHide:function(){(0,i.debugLog)(e),r.links.innerHTML=e[0],r.templates=JSON.parse(e[1])}})},progress:"sort_template"})}}},198019:(e,t,n)=>{"use strict";n.d(t,{consoleWrap:()=>a,patternWrap:()=>o,reportList:()=>r,reportTabs:()=>i,tabReports:()=>b,tabPattern:()=>y,switchTab:()=>C,getCurrentTab:()=>w,activeTab:()=>S,getCustomOption:()=>x,init:()=>E});var a,o,r,i,s,l=n(635429),c=n(100416),p=n(695724),d=n(803834),u=n(315544),_=n(386409),h=n(341585),m=n(25961),g=n(581164),v=n(54),f=n(610124),b="reports",y="pattern",k="_nospam_option_action";function C(e,t){var n=(0,u.geByClass1)("_nospam_tab_switch_"+e);uiTabs.switchTab((0,u.domFC)(n)),t&&(n=(0,u.domChildren)(n));var a=(0,u.geByClass)("nospam_tab"),o=(0,u.domData)(n,"tab-id");return a.forEach((function(e){(0,u.domData)(e,"id")!=o?(0,u.hide)(e):(0,u.show)(e)})),(0,v.updateUrl)({tab:e}),"patterns"===e?g.noSpamPatterns.initUpdate():e===b?m.noSpamReports.initUpdate():e===y&&(0,d.scrollToTop)(),!1}function w(){return(0,v.getUrlParam)("tab")}function S(){var e=(0,u.domPN)((0,u.geByClass1)("ui_tab_sel"));return(0,u.domData)(e,"tab-id")}function T(e){(0,u.geByClass)(k,s).forEach((t=>{var n=(0,u.domData)(t,"option"),a=+e[n],o=window.cur.lang["nospam_options_"+n];o&&(t.innerHTML=o[a]),(0,u.domData)(t,"option-state",a)})),cur.options.custom_options=e}function x(e){var t=window.cur;return!!t.options.custom_options&&t.options.custom_options[e]}function L(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o={width:185,height:500,multiselect:!1};return e.includes("spamtype")&&(0,p.extend)(o,{onChange:e=>{window["ConditionsEditor"+a].setSection(e)}}),new Dropdown(document.getElementById(e),t,(0,p.extend)(o,{selectedItems:n}))}function D(e){(0,p.extend)(cur,{uiSpamtype:L("spamtype",e.spamtypes,cur.options.spamtype),uiSpamtype2:L("spamtype2",e.spamtypes,cur.options.spamtype2,2),uiSimplify:L("simplify_select",e.simplifies,cur.options.simplify),uiBan:L("ban_select",e.bans,cur.options.ban),uiDuration:L("duration_select",e.durations,cur.options.duration),uiSearchPeriod:L("search_period_select",e.searchperiods,cur.options.searchperiod)}),(0,c.placeholderSetup)("comment_input"),(0,u.val)("comment_input")&&(0,l.autosizeSetup)("comment_input",{minHeight:30}),(0,u.geByClass)("conditions_input").forEach((function(e){(0,c.placeholderSetup)("comment_input"),(0,u.val)(e)&&(0,l.autosizeSetup)("comment_input",{minHeight:30})}));var t=(0,u.ge)("page_body");o=(0,u.geByClass1)("pattern_wrap",t),a=(0,u.geByClass1)("console_wrap",t),i=(0,u.geByClass1)("reports_tabs",t),r=(0,u.geByClass1)("_reports_list",t),s=(0,u.geByClass1)("_nospam_options",t);var n=(0,u.geByClass1)("nospam_patterns_wrap",t),d=(0,f.createModule)({handlers:(e,t)=>{t(n,"click","_abort_pattern_mild",(e=>(0,g.abortPatternMild)((0,u.domData)(e.target,"id")))),t(s,"click",k,(e=>{return t=e.target,n={act:"a_set_custom_option",name:(0,u.domData)(t,"option"),state:1^(0,u.domData)(t,"option-state")},void ajax.post("noSpam.php",n,{onDone:T,showProgress:_.lockActionsMenuItem.pbind(t),hideProgress:_.unlockActionsMenuItem.pbind(t)});var t,n}))}});cur.destroy.push((()=>{(0,f.destroyModule)(d)})),(0,h.mount)(),(0,m.mount)()}function E(e){(0,(0,f.createMutations)(D).bindMutations)(e)}},54:(e,t,n)=>{"use strict";n.d(t,{PHP_DAY:()=>l,MILLISECONDS_MULTIPLIER:()=>c,TARGET_BLANK:()=>p,EVENT_MOUSEDOWN:()=>d,EVENT_KEYDOWN:()=>u,EVENT_SCROLL:()=>_,getCurrentUrl:()=>h,updateUrl:()=>m,getUrlParam:()=>g,getAct:()=>v,openInNewTab:()=>f,getTime:()=>b,getCurrentDayBoundaries:()=>y,getDayBoundaries:()=>k,timestampToSeconds:()=>C,showLoading:()=>w,hideLoading:()=>S,hideCurrentBox:()=>T,initRadioButtons:()=>x,isSpecialKeyPressed:()=>L,isIntegerString:()=>D});var a=n(486125),o=n(726271),r=n(315544),i=n(695724),s=n(654612),l=86400,c=1e3,p="_blank",d="mousedown",u="keydown",_="scroll";function h(){return nav.strLoc}function m(e){var t={0:nav.objLoc[0],act:nav.objLoc.act};nav.setLoc((0,i.extend)(t,e))}function g(e){return nav.objLoc[e]}function v(){return g("act")}function f(e){window.open(e,"_blank").focus()}function b(){return C(Date.now())}function y(){return k((new Date).getTime())}function k(e){var t=new Date(e),n=new Date(e);return t.setHours(0,0,0,0),n.setHours(23,59,59,999),[t.getTime(),n.getTime()]}function C(e){return Math.floor(e/c)}function w(){var e=new s.MessageBox;e.setOptions({title:!1,hideButtons:!0}).show(),(0,r.hide)(boxLayerBG),(0,r.hide)(e.bodyNode),(0,r.show)(boxLoader),(0,a.boxRefreshCoords)(boxLoader)}function S(){a.curBox&&(0,a.curBox)()&&(0,a.curBox)().hide()}function T(){(0,a.curBox)().hide()}function x(e,t,n){window.radioBtns[e]={val:n,els:Array.prototype.slice.apply((0,r.geByClass)("radiobtn",(0,r.geByClass1)(t)))}}function L(e){return e.ctrlKey||e.metaKey&&o.browser.mac}function D(e){return/^-?(0|[1-9]\d*)$/.test(e)}},667784:(e,t,n)=>{"use strict";n.d(t,{addDelegateEvent:()=>c,removeDelegateEvent:()=>p});n(530522),n(66108),n(579665),n(95767),n(991181),n(296253),n(751876);var a=n(315544),o=n(49535);function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,o=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s=new window.Map;function l(e){var t=s.get(e.currentTarget);if(t){var n=t[e.type];if(n)for(var o,i=0;i<n.length;i++){var l=r(n[i],2),c=l[0],p=l[1],d=void 0;if((0,a.hasClass)(e.target,c)?d=p(e,e.target):(o=(0,a.gpeByClass)(c,e.target,e.currentTarget))&&(d=p(e,o)),!1===d)break}}}function c(e,t,n,a,r){var i=s.get(e);i||(s.set(e,{}),i=s.get(e));for(var c=t.split(" "),p=0;p<c.length;p++){var d=c[p];i[d]||(i[d]=[],r?(0,o.addEvent)(e,d,l,!1,!1,r):(0,o.addEvent)(e,d,l)),i[d].push([n,a])}}function p(e,t,n,a){var r=s.get(e);r&&(t.split(" ").forEach((t=>{r[t]&&(r[t]=r[t].filter((e=>e[0]!==n||e[1]!==a)),0===r[t].length&&(0,o.removeEvent)(e,t,l))})),0===Object.keys(r).map((e=>r[e].length)).reduce(((e,t)=>e+t))&&s.delete(e))}},965055:(e,t,n)=>{"use strict";n.d(t,{FilterType:()=>a,FIRST_N_VALUES:()=>i,INCLUDES_TEXT:()=>s,FREQUENCY_GREATER_THAN:()=>l,FREQUENCY_LESS_THAN:()=>c,FREQUENCY_INTERVAL:()=>p});var a,o=n(570655);!function(e){e.firstNValues="first_n_values",e.includesText="includes_text",e.frequencyGreaterThan="frequency_greater_than",e.frequencyLessThan="frequency_less_than",e.frequencyInterval="frequency_interval"}(a||(a={}));var r=["actions_count","users_count","value_html"],i={defaultValue:"10",option:{value:a.firstNValues,label:"Первые N "},filter:function(e){return function(t,n){return Number(e)>n}}},s={defaultValue:"",option:{value:a.includesText,label:"Содержит текст"},filter:function(e){return function(t){for(var n in t){if(!r.includes(n))if(String(t[n]).toLowerCase().includes(e.toLowerCase()))return!0}return!1}}},l={defaultValue:"3",option:{value:a.frequencyGreaterThan,label:"Частота ≥"},filter:function(e){return function(t){return Number(e)<=t.actions_count}}},c={defaultValue:"10",option:{value:a.frequencyLessThan,label:"Частота ≤"},filter:function(e){return function(t){return Number(e)>=t.actions_count}}},p={defaultValue:"3:10",option:{value:a.frequencyInterval,label:"Частота min:max"},filter:function(e){var t=(0,o.__read)(e.split(":",2),2),n=t[0],a=t[1];return function(e){return Number(n)<=e.actions_count&&Number(a)>=e.actions_count}}}},320745:(e,t,n)=>{"use strict";n.d(t,{ValueType:()=>a,Histogram:()=>c});var a,o=n(570655),r=n(785893),i=n(667294),s=n(596025),l=n(876164);!function(e){e.USER_ID="user_id",e.GROUP_ID="group_id",e.OWNER_ID="owner_id",e.APP_ID="app_id",e.HELPDESK_ID="helpdesk_id",e.NUMERIC="default_numeric",e.STRING="string",e.TEXT="text",e.UA_HASH="ua_hash",e.IP="ip"}(a||(a={}));var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.__extends)(t,e),t.prototype.render=function(){return(0,r.jsx)(s.TableSelectionManager,(0,o.__assign)({rowsCount:this.props.valueRows.length},{children:(0,r.jsx)(l.HistogramTable,{valueRows:this.props.valueRows,columnHeaders:this.props.columnHeaders,header:this.props.header,valueType:this.props.valueType,fieldCondition:this.props.fieldCondition},void 0)}),void 0)},t}(i.Component)},564594:(e,t,n)=>{"use strict";n.d(t,{HistogramControls:()=>u});var a=n(570655),o=n(785893),r=n(667294),i=n(466809),s=n(739519),l=n(288420),c=n(156589),p=n(889366),d=n(965055),u=function(e){function t(t){var n,a=e.call(this,t)||this;return a.filters=((n={})[d.FilterType.includesText]=d.INCLUDES_TEXT,n[d.FilterType.firstNValues]=d.FIRST_N_VALUES,n[d.FilterType.frequencyLessThan]=d.FREQUENCY_LESS_THAN,n[d.FilterType.frequencyGreaterThan]=d.FREQUENCY_GREATER_THAN,n[d.FilterType.frequencyInterval]=d.FREQUENCY_INTERVAL,n),a.state={inputValue:a.getCurrentFilter().defaultValue},a.filterInput=(0,r.createRef)(),a}return(0,a.__extends)(t,e),t.prototype.renderTotalAndSelectedCountRow=function(){return(0,o.jsxs)(i.ControlsRow,{children:[(0,o.jsx)(i.ControlsLabel,{children:"Всего значений:"},void 0),(0,o.jsx)("span",(0,a.__assign)({className:"HistogramControls__totalCount"},{children:this.props.totalCount}),void 0),(0,o.jsx)("div",{className:"divider"},void 0),(0,o.jsx)(i.ControlsLabel,{children:"Выделено:"},void 0),(0,o.jsx)(s.default,(0,a.__assign)({className:"HistogramControls__selectedCount",isMuted:0===this.props.selectedCount},{children:this.props.selectedCount}),void 0)]},void 0)},t.prototype.renderFilterRow=function(){var e=this.getFiltersOptions();return(0,o.jsxs)(i.ControlsRow,(0,a.__assign)({style:{paddingBottom:"10px"}},{children:[(0,o.jsx)(p.default,{className:"HistogramControls__filterInput",value:this.state.inputValue,onChange:this.handleFilterInputChange.bind(this),ref:this.filterInput,onKeyPress:this.handleKeyPress.bind(this)},void 0),(0,o.jsx)(c.default,{className:"HistogramControls__filterSelector",appearance:"fancy",options:e,value:this.props.selectFilter,onChange:this.handleFilterChange.bind(this)},void 0)]}),void 0)},t.prototype.getFiltersOptions=function(){var e=[];for(var t in this.filters)if(this.filters.hasOwnProperty(t)){var n=t;e.push(this.filters[n].option)}return e},t.prototype.handleFilterChange=function(e){var t=e.selected.value;this.props.setFilterType(t),this.setState({inputValue:this.filters[t].defaultValue})},t.prototype.handleSelectByFilterClick=function(){var e=this.getCurrentFilter(),t=this.state.inputValue;this.props.selectByFilter(e.filter(t))},t.prototype.getCurrentFilter=function(){return this.filters[this.props.selectFilter]},t.prototype.handleFilterInputChange=function(e){var t=e.target;this.setState({inputValue:t.value})},t.prototype.handleKeyPress=function(e){"Enter"===e.key&&this.handleSelectByFilterClick()},t.prototype.componentDidMount=function(){var e,t,n;null===(n=null===(t=null===(e=this.filterInput)||void 0===e?void 0:e.current)||void 0===t?void 0:t.element)||void 0===n||n.select()},t.prototype.componentDidUpdate=function(e){var t=this;this.props.selectFilter!==e.selectFilter&&setTimeout((function(){var e,n,a;null===(a=null===(n=null===(e=t.filterInput)||void 0===e?void 0:e.current)||void 0===n?void 0:n.element)||void 0===a||a.select()}),50)},t.prototype.render=function(){return(0,o.jsx)("div",(0,a.__assign)({className:"HistogramControls__panel"},{children:(0,o.jsxs)("div",(0,a.__assign)({className:"HistogramControls__wrap"},{children:[this.renderTotalAndSelectedCountRow(),this.renderFilterRow(),(0,o.jsxs)(i.ControlsRow,{children:[(0,o.jsx)(l.default,(0,a.__assign)({size:"s",appearance:"secondary",onClick:this.handleSelectByFilterClick.bind(this)},{children:"Выделить"}),void 0),(0,o.jsx)(l.default,(0,a.__assign)({size:"s",appearance:"primary",onClick:this.props.createNewPattern.bind(this)},{children:"Шаблон"}),void 0),(0,o.jsx)(l.default,(0,a.__assign)({size:"s",appearance:"primary",onClick:this.props.addToCondition.bind(this),style:{width:"97px"}},{children:"В условие"}),void 0)]},void 0)]}),void 0)}),void 0)},t}(r.Component)},876164:(e,t,n)=>{"use strict";n.d(t,{HistogramTable:()=>_});var a=n(570655),o=n(785893),r=n(667294),i=n(938899),s=n(564594),l=n(965055),c=n(320745),p=n(341585),d=n(481117),u=n(961540),_=function(e){function t(t){var n=e.call(this,t)||this;return n.state={currentFilter:l.FilterType.includesText},n}return(0,a.__extends)(t,e),t.prototype.setFilterType=function(e){this.setState({currentFilter:e})},t.prototype.selectByFilter=function(e){this.props.selectByFilter(this.props.valueRows,e)},t.prototype.composeCondition=function(){var e=this.props.getSelectedRows(this.props.valueRows);if(0===e.length)return"";var t=e.map((function(e){return e.value})),n=this.props.valueType;n!==c.ValueType.STRING&&n!==c.ValueType.TEXT||(t=t.map((function(e){return"'"+e+"'"})));var a=t.join(", "),o=this.props.fieldCondition;return o||(o=this.props.header),1===e.length?o+" = "+a:o+" IN ("+a+")"},t.prototype.addToCondition=function(){var e=this.composeCondition();e&&((0,p.setConditions)(e),(0,d.destroyComponentInBox)(!0))},t.prototype.createNewPattern=function(){var e=this.composeCondition();if(e){var t=window.cur.numFieldGetPatternLink(e);window.open("https://"+(0,u.getHostName)()+t,"_blank")}},t.prototype.getColumns=function(){return this.props.columnHeaders.map((function(e){var t={Header:e.header,accessor:e.accessor},n=null,a=e.accessor;return e.has_alternative_display&&(a+="_display",n=function(e){return e.original[a]}),e.is_html&&(n=function(e){return(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:e.original[a]}},void 0)}),n&&(t.Cell=n),e.max_width&&(t.maxWidth=e.max_width),e.min_width&&(t.minWidth=e.min_width),t}))},t.prototype.render=function(){var e=this.props.getSelectedRows(this.props.valueRows).length;return window.cur.histogramSelectedCount=e,(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.HistogramControls,{selectedCount:e,totalCount:this.props.valueRows.length,selectFilter:this.state.currentFilter,setFilterType:this.setFilterType.bind(this),selectByFilter:this.selectByFilter.bind(this),addToCondition:this.addToCondition.bind(this),createNewPattern:this.createNewPattern.bind(this)},void 0),(0,o.jsx)(i.SelectTable,{data:this.props.valueRows,columns:this.getColumns(),selection:this.props.selection,onSelection:this.props.handleRowSelection,isHeaderSticky:!0,headerTopPosition:"105px",isPaginationEnabled:!0,pageSize:500},void 0)]},void 0)},t}(r.Component)},938899:(e,t,n)=>{"use strict";n.d(t,{SelectTable:()=>v});var a,o=n(570655),r=n(785893),i=n(667294),s=n(985903),l=n(973714),c=n(611658),p=n(877199),d=n(250519),u=n(600242),_=n(832199),h=n(674041),m=n(611745),g=n(497309);!function(e){e.TOGGLE="toggle",e.SELECT="select",e.DESELECT="deselect"}(a||(a={}));var v=function(e){function t(t){var n=e.call(this,t)||this;return n.state={lastSelectedIndex:0,lastSelectedMode:a.SELECT},n.handleCheckBoxHeaderClick=n.handleCheckBoxHeaderClick.bind(n),n}return(0,o.__extends)(t,e),t.prototype.selectionChange=function(e,t){var n=this,o=t.map((function(t,o){switch(e){case a.TOGGLE:return t?!n.props.selection[o]:n.props.selection[o];case a.SELECT:return!!t||n.props.selection[o];case a.DESELECT:return!t&&n.props.selection[o]}}));this.props.onSelection(o)},t.prototype.selectSingleRow=function(e){var t=this.props.selection.map((function(t,n){return n===e}));this.selectionChange(a.TOGGLE,t)},t.prototype.handleCheckBoxHeaderClick=function(e){var t=this.props.selection.map((function(){return!0}));e.altKey?this.selectionChange(a.TOGGLE,t):this.props.selection.reduce((function(e,t){return e&&t}))?this.selectionChange(a.DESELECT,t):this.selectionChange(a.SELECT,t)},t.prototype.handleRowClick=function(e,t){var n;null===(n=document.getSelection())||void 0===n||n.removeAllRanges();var o=e.target;if(o.className.includes("CheckBox__")&&e.preventDefault(),"A"!==o.nodeName&&!o.classList.contains("select_table_unselectable")){var r=this.props.selection[t.index]?a.DESELECT:a.SELECT;this.setState({lastSelectedIndex:t.index,lastSelectedMode:r}),e.shiftKey?this.handleShiftSelect(t.index):this.selectSingleRow(t.index)}},t.prototype.handleShiftSelect=function(e){var t=e-this.state.lastSelectedIndex,n=this.state.lastSelectedIndex,a=e+1;t<0&&(n=e,a=this.state.lastSelectedIndex);var o=this.props.selection.map((function(e,t){return t>=n&&t<a}));this.selectionChange(this.state.lastSelectedMode,o)},t.prototype.handleMouseEnter=function(e,t){var n;window.cur.mousedown&&(null===(n=document.getSelection())||void 0===n||n.removeAllRanges(),this.selectSingleRow(t.index))},t.prototype.getRowClassName=function(e){var t=this.props,n=t.selection[e],a=t.data[e].isFirstInGroup,o=[];return n&&o.push("SelectTable__row--selected"),t.muted&&t.muted[e]&&o.push("SelectTable__row--muted"),a&&o.push("SelectTable__row--firstInGroup"),o.join(" ")},t.prototype.render=function(){var e=this,t=this.props,n=t.data.map((function(e,n){var a=t.selection[n];return e.checkbox=(0,r.jsx)(h.default,{checked:a,className:"SelectTable__checkBox"},void 0),e})),a=!t.selection.some((function(e){return!1===e})),i=(0,o.__spreadArray)([{Header:function(){return(0,r.jsx)(h.default,{className:"SelectTable__checkBox",checked:a,onClick:e.handleCheckBoxHeaderClick},void 0)},accessor:"checkbox",width:40}],(0,o.__read)(t.columns),!1);return(0,r.jsx)(s.default,{className:"SelectTable",data:n,columns:i,TableComponent:l.SelectTableContainerComponent,TheadComponent:c.SelectTableHeadComponent,TbodyComponent:m.SelectTableBodyComponent,TrComponent:p.SelectTableRowComponent,TdComponent:d.SelectTableCellComponent,ThComponent:u.SelectTableHeaderCellComponent,TrGroupComponent:_.SelectTableRowGroupComponent,PaginationComponent:g.SelectTablePaginationComponent,resizable:!1,sortable:!1,pageSize:this.props.pageSize,showPageSizeOptions:!1,showPagination:this.props.isPaginationEnabled,minRows:0,getTdProps:function(t,n){return{onMouseDown:function(t){return e.handleRowClick(t,n)}}},getTrProps:function(t,n){return{className:e.getRowClassName(n.index),onMouseEnter:function(t){return e.handleMouseEnter(t,n)}}},getTheadProps:function(){return e.props.isHeaderSticky?{style:{position:"sticky",top:e.props.headerTopPosition,zIndex:1}}:{}}},void 0)},t.defaultProps={isHeaderSticky:!1,headerTopPosition:"0",muted:[],selection:[],isPaginationEnabled:!1,pageSize:100},t}(i.Component)},611745:(e,t,n)=>{"use strict";n.d(t,{SelectTableBodyComponent:()=>r});var a=n(570655),o=n(785893),r=function(e){return(0,o.jsx)("div",(0,a.__assign)({className:"SelectTable__body"},{children:e.children}),void 0)}},250519:(e,t,n)=>{"use strict";n.d(t,{SelectTableCellComponent:()=>r});var a=n(570655),o=n(785893),r=function(e){return(0,o.jsx)("div",(0,a.__assign)({className:"SelectTable__cell",role:"gridcell",style:e.style,onMouseDown:e.onMouseDown},{children:e.children}),void 0)}},973714:(e,t,n)=>{"use strict";n.d(t,{SelectTableContainerComponent:()=>r});var a=n(570655),o=n(785893),r=function(e){return(0,o.jsx)("div",(0,a.__assign)({className:"SelectTable__container"},{children:e.children}),void 0)}},466809:(e,t,n)=>{"use strict";n.d(t,{ControlsRow:()=>i,ControlsLabel:()=>s,ControlsLinkButton:()=>l});var a=n(570655),o=n(785893),r=n(931897);function i(e){return(0,o.jsx)("div",(0,a.__assign)({className:"SelectTableControls__row",style:e.style},{children:e.children}),void 0)}function s(e){return(0,o.jsx)("span",(0,a.__assign)({className:"SelectTableControls__label",style:e.style},{children:e.children}),void 0)}function l(e){return(0,o.jsx)(r.default,(0,a.__assign)({onClick:e.onClick,className:"SelectTableControls__linkButton"},{children:e.children}),void 0)}},611658:(e,t,n)=>{"use strict";n.d(t,{SelectTableHeadComponent:()=>r});var a=n(570655),o=n(785893),r=function(e){return(0,o.jsx)("div",(0,a.__assign)({className:"SelectTable__header",role:"row",style:e.style},{children:e.children}),void 0)}},600242:(e,t,n)=>{"use strict";n.d(t,{SelectTableHeaderCellComponent:()=>r});var a=n(570655),o=n(785893),r=function(e){return(0,o.jsx)("div",(0,a.__assign)({className:"SelectTable__headerCell "+e.className,role:"columnheader",style:e.style},{children:e.children}),void 0)}},497309:(e,t,n)=>{"use strict";n.d(t,{SelectTablePaginationComponent:()=>r});var a=n(785893),o=n(102690),r=function(e){var t,n,r=null!==(t=e.page)&&void 0!==t?t:0,i=null!==(n=e.pages)&&void 0!==n?n:0;return i<2?(0,a.jsx)(a.Fragment,{},void 0):(0,a.jsx)(o.default,{count:i,current:r,onSelect:function(t){e.onPageChange(t)}},void 0)}},877199:(e,t,n)=>{"use strict";n.d(t,{SelectTableRowComponent:()=>r});var a=n(570655),o=n(785893),r=function(e){return(0,o.jsx)("div",(0,a.__assign)({className:"SelectTable__row "+e.className,role:"row",onMouseEnter:e.onMouseEnter},{children:e.children}),void 0)}},832199:(e,t,n)=>{"use strict";n.d(t,{SelectTableRowGroupComponent:()=>r});var a=n(570655),o=n(785893),r=function(e){return(0,o.jsx)("div",(0,a.__assign)({className:"SelectTable__rowGroup",role:"rowgroup"},{children:e.children}),void 0)}},596025:(e,t,n)=>{"use strict";n.d(t,{TableSelectionManager:()=>r});var a=n(570655),o=n(667294),r=function(e){function t(t){var n=e.call(this,t)||this;return n.state={selection:new Array(n.props.rowsCount).fill(!1)},n}return(0,a.__extends)(t,e),t.prototype.getSelectedRows=function(e){var t=this;return e.filter((function(e,n){return t.state.selection[n]}))},t.prototype.selectByFilter=function(e,t){var n=this,a=this.getFilteredRows(e,t).map((function(e,t){return e||n.state.selection[t]}));this.handleRowSelection(a)},t.prototype.handleRowSelection=function(e){this.setState({selection:e})},t.prototype.getFilteredRows=function(e,t){return e.map((function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.apply(void 0,(0,a.__spreadArray)([],(0,a.__read)(e),!1))}))},t.prototype.componentWillReceiveProps=function(e){e.rowsCount!==this.state.selection.length&&this.setState({selection:new Array(e.rowsCount).fill(!1)})},t.prototype.render=function(){return(0,o.cloneElement)(this.props.children,{getSelectedRows:this.getSelectedRows.bind(this),selectByFilter:this.selectByFilter.bind(this),handleRowSelection:this.handleRowSelection.bind(this),selection:this.state.selection})},t}(o.Component)},564793:(e,t,n)=>{"use strict";n.d(t,{LinksType:()=>o,ConsoleLinks:()=>_});var a,o,r=n(570655),i=n(785893),s=n(667294),l=n(377381),c=n(889366),p=n(641388),d=n(596025);!function(e){e.DOMAINS="domains",e.DOMAINS_HIGHER="higher_level_domains",e.EXTERNAL_LINKS="external_links"}(o||(o={}));var u=((a={})[o.DOMAINS]="Домены",a[o.DOMAINS_HIGHER]="Домены верхних уровней",a[o.EXTERNAL_LINKS]="Ссылки",a),_=function(e){function t(t){var n=e.call(this,t)||this,a=n.getEnabledTabs();return n.state={comment:window.cur.getLinksBanComment(),selectedTab:0!==t.linksDataRaw[o.DOMAINS].length?o.DOMAINS:o.EXTERNAL_LINKS,enabledTabs:a,higherDomainsLevel:0,linksData:n.initLinksData(a)},n.handleCommentInput=n.handleCommentInput.bind(n),n.changeDomainLevel=n.changeDomainLevel.bind(n),n.handleBanResults=n.handleBanResults.bind(n),n}return(0,r.__extends)(t,e),t.prototype.getEnabledTabs=function(){var e=this.props,t=[];return e.linksDataRaw[o.DOMAINS].length>0&&t.push(o.DOMAINS),e.linksDataRaw[o.DOMAINS_HIGHER].length>0&&e.linksDataRaw[o.DOMAINS_HIGHER][0].length>0&&t.push(o.DOMAINS_HIGHER),e.linksDataRaw[o.EXTERNAL_LINKS].length>0&&t.push(o.EXTERNAL_LINKS),t},t.prototype.initLinksData=function(e){var t,n=this,a=((t={})[o.DOMAINS]=[],t[o.DOMAINS_HIGHER]=[],t[o.EXTERNAL_LINKS]=[],t);return e.forEach((function(e){var t=n.props.linksDataRaw[e];switch(e){case o.DOMAINS:case o.EXTERNAL_LINKS:a[e]=t.map((function(e,t){return(0,r.__assign)((0,r.__assign)({},e),{index:t})}));break;case o.DOMAINS_HIGHER:a[e]=t.map((function(e){return e.map((function(e,t){return(0,r.__assign)((0,r.__assign)({},e),{index:t})}))}))}})),a},t.prototype.handleCommentInput=function(e){var t=e.target;window.cur.setLinksBanComment(t.value),this.setComment(t.value)},t.prototype.setComment=function(e){this.setState({comment:e})},t.prototype.syncWithCurComment=function(){var e=window.cur.getLinksBanComment();e!==this.state.comment&&this.setComment(e)},t.prototype.changeDomainLevel=function(e){var t=this.state.higherDomainsLevel+e;t<0||t>=this.props.linksDataRaw[o.DOMAINS_HIGHER].length||(this.setState({higherDomainsLevel:t}),this.forceUpdate())},t.prototype.handleBanResults=function(e,t,n){var a=(0,r.__assign)({},this.state.linksData),i=t===o.DOMAINS_HIGHER?a[t][n]:a[t];e.forEach((function(e){e.success&&(i[e.index].is_banned=!0)})),this.setState({linksData:a})},t.prototype.renderTabsContent=function(){var e=this.state.selectedTab,t=this.state.linksData[e],n=e;return e===o.DOMAINS_HIGHER&&(t=this.state.linksData[e][this.state.higherDomainsLevel],n+=this.state.higherDomainsLevel),(0,i.jsx)(d.TableSelectionManager,(0,r.__assign)({rowsCount:t.length},{children:(0,i.jsx)(l.LinksTab,{type:e,rowsData:t,banHash:this.props.banHash,comment:this.state.comment,higherDomainsLevel:this.state.higherDomainsLevel,hasDomainLevelsAbove:this.state.higherDomainsLevel+1<this.props.linksDataRaw[o.DOMAINS_HIGHER].length,hasDomainLevelsBelow:this.state.higherDomainsLevel>0,changeDomainLevel:this.changeDomainLevel,updateBanStatus:this.handleBanResults},n)}),void 0)},t.prototype.renderTabs=function(){return this.state.enabledTabs.map((function(e){return(0,i.jsx)("span",{children:u[e]},e)}))},t.prototype.selectTab=function(e){this.setState({selectedTab:e})},t.prototype.render=function(){var e=this;if(0===this.state.enabledTabs.length)return null;var t=this.renderTabsContent();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.default,{placeholder:"Комментарий к блокировке ссылок и доменов",onChange:this.handleCommentInput,value:this.state.comment},void 0),(0,i.jsx)(p.default,(0,r.__assign)({active:this.state.selectedTab,onTabClick:function(t,n){e.selectTab(n)}},{children:this.renderTabs()}),void 0),t]},void 0)},t}(s.Component)},377381:(e,t,n)=>{"use strict";n.d(t,{LinksTab:()=>h});var a=n(570655),o=n(785893),r=n(667294),i=n(938899),s=n(181395),l=n(293680),c=n(341585),p=n(564793),d=[{Header:"Домен",accessor:"domain",style:{whiteSpace:"nowrap"}},{Header:"Путь",accessor:"path",style:{whiteSpace:"nowrap"}},{Header:"К-во",accessor:"count",maxWidth:50},{Header:"Поле",accessor:"field_name",maxWidth:100}],u=[{Header:"Ссылка",accessor:"link",style:{whiteSpace:"nowrap"}},{Header:"К-во",accessor:"count",maxWidth:50},{Header:"Поле",accessor:"field_name",maxWidth:100}],_=[{Header:"Домен",accessor:"domain",style:{whiteSpace:"nowrap"}},{Header:"Поддомен",accessor:"subdomain",style:{whiteSpace:"nowrap"}},{Header:"К-во",accessor:"count",maxWidth:50},{Header:"Поле",accessor:"field_name",maxWidth:100}],h=function(e){function t(t){var n=e.call(this,t)||this;return n.state={banInProgress:{status:!1,reason:null}},n}return(0,a.__extends)(t,e),t.prototype.blockSelected=function(e){var t=this,n=this.props,a=this.getLinksForBan();if(0!==a.length){this.setState({banInProgress:{status:!0,reason:e}});var o={links:"",reason:e,comment:n.comment,hash:n.banHash,act:"block_links_mass",is_domains_ban:0};if(this.isDomainsTab())o.is_domains_ban=1;else if(!this.isExternalLinksTab())return;var r=function(e){t.setState({banInProgress:{status:!1,reason:null}}),t.props.updateBanStatus(e,t.props.type,t.props.higherDomainsLevel)};a.forEach((function(e){o.links=JSON.stringify([e]),l.ajax.post("noSpam.php",o,{onDone:r})}))}},t.prototype.isDomainsTab=function(){return this.props.type===p.LinksType.DOMAINS||this.props.type===p.LinksType.DOMAINS_HIGHER},t.prototype.isExternalLinksTab=function(){return this.props.type===p.LinksType.EXTERNAL_LINKS},t.prototype.getLinksForBan=function(){var e=this;return this.getSelectedRows().filter((function(e){return!e.is_banned})).map((function(t){return e.isDomainsTab()?{domain:t.name,link_example:t.link,index:t.index}:e.isExternalLinksTab()?{url:t.url,index:t.index}:void 0}))},t.prototype.getSelectedRows=function(){return this.props.getSelectedRows(this.props.rowsData)},t.prototype.selectByFilter=function(e){this.props.selectByFilter(this.props.rowsData,e)},t.prototype.addSelectedToCondition=function(e){var t=this.getSelectedRows();if(0!==t.length){var n=[];switch(e){case s.ConditionAddOption.DOMAIN_NAME:n=t.map((function(e){return e.name}));break;case s.ConditionAddOption.LINK_URL:n=t.map((function(e){return e.url}));break;case s.ConditionAddOption.TOP_LEVEL_DOMAIN:t.forEach((function(e){var t=e.name.slice(e.name.lastIndexOf("."));n.includes(t)||n.push(t)}))}var a="@check_regex('("+(n=n.map((function(e){return(0,c.escapeRegexConditionsInput)(e)}))).join("|")+")', message)";(0,c.setConditions)(a)}},t.prototype.getDomainsForTable=function(){return this.props.rowsData.map((function(e,n){return{domain:t.getMainLinkElement(e.name,e.is_banned,!0),path:e.path,field_name:t.getFieldLinkElement(e.field_name,e.sample_index),sampleIndex:e.sample_index,count:e.count,isFirstInGroup:0!==n&&""!==e.top_domain}}))},t.prototype.getExternalLinksForTable=function(){return this.props.rowsData.map((function(e){return{link:t.getMainLinkElement(e.url,e.is_banned,!1),field_name:t.getFieldLinkElement(e.field_name,e.sample_index),sampleIndex:e.sample_index,count:e.count}}))},t.prototype.getHigherLevelDomainsForTable=function(){return this.props.rowsData.map((function(e){return{domain:t.getMainLinkElement(e.name,e.is_banned,!0),subdomain:e.subdomain_name,field_name:t.getFieldLinkElement(e.field_name,e.sample_index),sampleIndex:e.sample_index,count:e.count}}))},t.scrollToSample=function(e){var t,n=null===(t=document.querySelector(".console_items_list"))||void 0===t?void 0:t.children[e];n&&n.scrollIntoView()},t.getFieldLinkElement=function(e,n){return(0,o.jsx)("a",(0,a.__assign)({onClick:function(){t.scrollToSample(n)}},{children:e}),void 0)},t.getMainLinkElement=function(e,t,n){var r=t?"LinksTab__linkBanned":"",i=n?"http://":"";return(0,o.jsx)("a",(0,a.__assign)({href:"/away.php?to="+i+e,target:"_blank",className:r},{children:e}),void 0)},t.prototype.render=function(){var e,t=this.state,n=[];switch(this.props.type){case p.LinksType.DOMAINS:e=d,n=this.getDomainsForTable();break;case p.LinksType.EXTERNAL_LINKS:e=u,n=this.getExternalLinksForTable();break;case p.LinksType.DOMAINS_HIGHER:e=_,n=this.getHigherLevelDomainsForTable()}var a=this.getSelectedRows().length,r=this.props.rowsData.filter((function(e){return!0===e.is_banned})).length;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.LinksTabControls,{selectedCount:a,totalCount:n.length,bannedCount:r,blockSelected:this.blockSelected.bind(this),banInProgress:t.banInProgress,selectByFilter:this.selectByFilter.bind(this),addToCondition:this.addSelectedToCondition.bind(this),type:this.props.type,hasDomainLevelsAbove:this.props.hasDomainLevelsAbove,hasDomainLevelsBelow:this.props.hasDomainLevelsBelow,changeDomainLevel:this.props.changeDomainLevel},void 0),(0,o.jsx)(i.SelectTable,{data:n,columns:e,selection:this.props.selection,onSelection:this.props.handleRowSelection,muted:this.props.rowsData.map((function(e){return e.is_banned}))},void 0)]},void 0)},t}(r.Component)},181395:(e,t,n)=>{"use strict";n.d(t,{LinksBlockReason:()=>a,ConditionAddOption:()=>o,LinksTabControls:()=>u});var a,o,r=n(570655),i=n(785893),s=n(667294),l=n(564793),c=n(46092),p=n(739519),d=n(466809);!function(e){e[e.PHISHING=1]="PHISHING",e[e.FRAUD=3]="FRAUD"}(a||(a={})),function(e){e.DOMAIN_NAME="domain_name",e.TOP_LEVEL_DOMAIN="top_level_domain",e.LINK_URL="link_url"}(o||(o={}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n.handleBlockClick=n.handleBlockClick.bind(n),n.handleAddToCondition=n.handleAddToCondition.bind(n),n.handleDomainLevelChange=n.handleDomainLevelChange.bind(n),n}return(0,r.__extends)(t,e),t.prototype.handleBlockClick=function(e){this.props.blockSelected(e)},t.prototype.handleFilterClick=function(e){this.props.selectByFilter(e)},t.prototype.handleAddToCondition=function(e){this.props.addToCondition(e)},t.prototype.handleDomainLevelChange=function(e){this.props.changeDomainLevel(e)},t.prototype.getTotalLabel=function(){var e="";switch(this.props.type){case l.LinksType.DOMAINS:case l.LinksType.DOMAINS_HIGHER:e="доменов";break;case l.LinksType.EXTERNAL_LINKS:e="внешних ссылок"}return"Всего "+e+":"},t.prototype.renderDomainsControls=function(){var e=this;return(0,i.jsxs)(i.Fragment,{children:[this.renderTotalWithBlockedRow(),this.renderBanButtonsRow(),(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:"Выделить:"},void 0),(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleFilterClick((function(e){return!e.is_banned}))}},{children:"незабаненные"}),void 0),(0,i.jsx)("div",{className:"divider"},void 0),(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleFilterClick((function(e){return!e.path||"/"===e.path}))}},{children:"без пути"}),void 0)]},void 0),(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:"Добавить в условие:"},void 0),(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleAddToCondition(o.DOMAIN_NAME)}},{children:"домены целиком"}),void 0),(0,i.jsx)("div",{className:"divider"},void 0),(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleAddToCondition(o.TOP_LEVEL_DOMAIN)}},{children:"верхний уровень"}),void 0)]},void 0)]},void 0)},t.prototype.renderExternalLinksControls=function(){var e=this;return(0,i.jsxs)(i.Fragment,{children:[this.renderTotalWithBlockedRow(),this.renderBanButtonsRow(),(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:"Выделить:"},void 0),(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleFilterClick((function(e){return!e.is_banned}))}},{children:"незабаненные"}),void 0)]},void 0),(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:"Добавить в условие:"},void 0),(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleAddToCondition(o.LINK_URL)}},{children:"ссылки целиком"}),void 0)]},void 0)]},void 0)},t.prototype.renderHigherLevelDomainsControls=function(){var e=this;return(0,i.jsxs)(i.Fragment,{children:[this.renderTotalWithBlockedRow(),this.renderDomainLevelNavigation(),this.renderBanButtonsRow(),(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:"Выделить:"},void 0),(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleFilterClick((function(e){return!e.is_banned}))}},{children:"незабаненные"}),void 0)]},void 0),(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:"Добавить в условие:"},void 0),(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleAddToCondition(o.DOMAIN_NAME)}},{children:"домены целиком"}),void 0)]},void 0)]},void 0)},t.prototype.renderDomainLevelNavigation=function(){var e=this,t=this.props.hasDomainLevelsAbove,n=this.props.hasDomainLevelsBelow;return t||n?(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:"Показать домены уровнем:"},void 0),t&&(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleDomainLevelChange(1)}},{children:"выше"}),void 0),t&&n&&(0,i.jsx)("div",{className:"divider"},void 0),n&&(0,i.jsx)(d.ControlsLinkButton,(0,r.__assign)({onClick:function(){return e.handleDomainLevelChange(-1)}},{children:"ниже"}),void 0)]},void 0):null},t.prototype.renderTotalWithBlockedRow=function(){return(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:this.getTotalLabel()},void 0),(0,i.jsx)("b",{children:this.props.totalCount},void 0),(0,i.jsx)("div",{className:"divider"},void 0),(0,i.jsx)(d.ControlsLabel,{children:"Заблокировано:"},void 0),(0,i.jsx)("b",{children:this.props.bannedCount},void 0)]},void 0)},t.prototype.renderBanButtonsRow=function(){return(0,i.jsxs)(d.ControlsRow,{children:[(0,i.jsx)(d.ControlsLabel,{children:"Выделено"},void 0),(0,i.jsx)(p.default,(0,r.__assign)({className:"LinksTabControls__selectedCount",isMuted:0===this.props.selectedCount},{children:this.props.selectedCount}),void 0),(0,i.jsx)("div",{className:"divider"},void 0),(0,i.jsx)(c.BanLinksButtons,{banInProgress:this.props.banInProgress,handleBlockClick:this.handleBlockClick,rowsNotSelected:0===this.props.selectedCount},void 0)]},void 0)},t.prototype.render=function(){var e=null;switch(this.props.type){case l.LinksType.DOMAINS:e=this.renderDomainsControls();break;case l.LinksType.DOMAINS_HIGHER:e=this.renderHigherLevelDomainsControls();break;case l.LinksType.EXTERNAL_LINKS:e=this.renderExternalLinksControls()}return(0,i.jsx)("div",(0,r.__assign)({className:"SelectTableControls__container"},{children:e}),void 0)},t}(s.Component)},46092:(e,t,n)=>{"use strict";n.d(t,{BanLinksButtons:()=>l});var a=n(570655),o=n(785893),r=n(118690),i=n(181395),s=n(466809);function l(e){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.ControlsLabel,{children:"Блокировать выделенные c причиной:"},void 0),(0,o.jsx)(r.default,(0,a.__assign)({size:"s",appearance:"secondary",onClick:function(){return e.handleBlockClick(i.LinksBlockReason.FRAUD)},loading:e.banInProgress.reason===i.LinksBlockReason.FRAUD,disabled:e.banInProgress.status||e.rowsNotSelected},{children:"Мошенники"}),void 0),(0,o.jsx)(r.default,(0,a.__assign)({size:"s",appearance:"primary",onClick:function(){return e.handleBlockClick(i.LinksBlockReason.PHISHING)},loading:e.banInProgress.reason===i.LinksBlockReason.PHISHING,disabled:e.banInProgress.status||e.rowsNotSelected},{children:"Фишинг"}),void 0)]},void 0)}},610124:(e,t,n)=>{"use strict";n.d(t,{createMutations:()=>i,createModule:()=>c,destroyModule:()=>p});var a=n(570655),o=n(667784),r=n(49535);function i(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,(0,a.__spreadArray)([],(0,a.__read)(t),!1))}}}function s(e,t,n,a){(0,r.addEvent)(t,n,a),e._registeredHandlers.push({handlerType:"bind",elem:t,types:n,handler:a})}function l(e,t,n,a,r,i){(0,o.addDelegateEvent)(t,n,a,r,i),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:n,selector:a,handler:r})}function c(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return s.apply(void 0,(0,a.__spreadArray)([t],(0,a.__read)(e),!1))}),(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return l.apply(void 0,(0,a.__spreadArray)([t],(0,a.__read)(e),!1))})),t}function p(e){e._registeredHandlers.forEach((function(e){var t=e.handlerType,n=e.elem,a=e.types,i=e.handler;"delegate"===t?(0,o.removeDelegateEvent)(n,a,e.selector,i):(0,r.removeEvent)(n,a,i)})),e._registeredHandlers=[]}}}]);try{stManager.done("dist/9a78c2c6a5e9eaa761c83d9c0bbcda9d.562909b55cfef69bbf03.js")}catch(e){}
(self.webpackChunkvk=self.webpackChunkvk||[]).push([[5360],{891047:(e,t,r)=>{"use strict";function n(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function i(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const i=n(r);return(e,r)=>i.then((n=>r(n.transaction(t,e).objectStore(t))))}let s;function o(){return s||(s=i("keyval-store","keyval")),s}function a(e,t=o()){return t("readonly",(t=>n(t.get(e))))}function c(e,t,r=o()){return r("readwrite",(r=>(r.put(t,e),n(r.transaction))))}function u(e,t=o()){return t("readwrite",(t=>(t.delete(e),n(t.transaction))))}r.d(t,{createStore:()=>i,del:()=>u,get:()=>a,set:()=>c})},95642:(e,t,r)=>{"use strict";r.d(t,{settingsChangesStatCollector:()=>i});var n=r(214547),i=new(function(){function e(){this.productStatCollector=new n.ProductionStatCollector,this.actionStatCollector=new n.ActionStatCollector(this.productStatCollector)}return e.prototype.logEvent=function(e){var t={type:"type_settings_changes_item",type_settings_changes_item:e};this.actionStatCollector.logEvent(t)},e}())},218233:(e,t,r)=>{"use strict";r.d(t,{Api:()=>l});var n=r(570655),i=r(816405),s=r(190831),o=r(891047),a=r(189798),c=r(726271),u=["messages.getLongPollServer","messages.getLongPollHistory","queue.subscribe"],l=function(){function e(e){var t=this;this.abortTrackers=new Map,this.fetch=function(e,r,i){return void 0===i&&(i={}),(0,n.__awaiter)(t,void 0,Promise,(function(){var t,s,o,a,l,f,h,v,p,g;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if("queue.subscribe"===e)return[2,Promise.resolve({base_url:"mock",queues:[]})];r=this.enrichParams(e,r),t=u.includes(e),s=e+" "+JSON.stringify(r),o=i.retries||0,a=500,n.label=1;case 1:0,n.label=2;case 2:return n.trys.push([2,7,,9]),!t||!window.curNotifier||window.curNotifier.is_server||c.browser.safari?[3,5]:[4,d((_=500,m=1500,Math.random()*(m-_+1)+_))];case 3:return n.sent(),[4,this.cache.get(s)];case 4:if(l=n.sent())return[2,l];n.label=5;case 5:return f=this.request(e,r),h=f.response,v=f.abort,i.trackId&&this.abortTrackers.set(i.trackId,v),[4,h];case 6:if(p=n.sent(),i.trackId&&this.abortTrackers.delete(i.trackId),p.execute_errors)throw new Error("execute failed");return t&&this.cache.set(s,p).catch((function(){})),[2,p];case 7:if((g=n.sent())instanceof Error&&"AbortError"===g.name)throw g;if(0===o)throw g;return o--,[4,d(a)];case 8:return n.sent(),a=Math.min(2*a,2e4),[3,9];case 9:return[3,1];case 10:return[2]}var _,m}))}))},this.request=function(e,t){var r,s,o=new AbortController,c={};try{for(var u=(0,n.__values)(Object.keys(t)),l=u.next();!l.done;l=u.next()){var f=l.value;void 0!==t[f]&&(c[f]=t[f])}}catch(e){r={error:e}}finally{try{l&&!l.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}return{response:(0,a.api)(e,c,{version:i.API_VERSION},{signal:o.signal}),abort:function(){o.abort()}}},this.enrichParams=function(e,t){var r=e.slice(0,e.indexOf(".")),i={messages:Array.from(new Set((0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(s.API_USER_FIELDS),!1),(0,n.__read)(s.API_GROUP_FIELDS),!1))).join(","),users:s.API_USER_FIELDS.join(","),groups:s.API_GROUP_FIELDS.join(",")}[r];return(0,n.__assign)((0,n.__assign)({},t),{extended:1,fields:i})},this.cache=new f(3e3,e)}return e.dropCache=function(){indexedDB.deleteDatabase(f.CACHE_DB_NAME)},e.prototype.dangerouslyAbort=function(e){var t;e&&(null===(t=this.abortTrackers.get(e))||void 0===t||t(),this.abortTrackers.delete(e))},e.prototype.fetchMany=function(e,t){var r,i;void 0===t&&(t={});var s=[],o=[],a=Object.keys(e);try{for(var c=(0,n.__values)(a),u=c.next();!u.done;u=c.next()){var l=u.value,f=l.replace(".","_");s.push("var "+f+" = fork(API."+l+"("+JSON.stringify(this.enrichParams(l,e[l]))+"));"),o.push("'"+l+"': wait("+f+")")}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}var d=s.join("\n")+"\nreturn { "+o.join(",")+" };";return this.fetch("execute",{code:d},t)},e}(),f=function(){function e(t,r){this.invalidateTimeout=t,this.cache=o.createStore(e.CACHE_DB_NAME,"api-cache-"+r)}return e.prototype.get=function(e){var t=this;return o.get(e,this.cache).then((function(r){if(void 0!==r){if(!(r.expiresAt<Date.now()))return setTimeout((function(){o.del(e,t.cache).catch((function(){}))}),Date.now()-r.expiresAt),r.response;o.del(e,t.cache).catch((function(){}))}})).catch((function(){}))},e.prototype.set=function(e,t){var r=this,n={response:t,expiresAt:Date.now()+this.invalidateTimeout};return o.set(e,n,this.cache).then((function(){setTimeout((function(){o.del(e,r.cache).catch((function(){}))}),r.invalidateTimeout)})).catch((function(){}))},e.CACHE_DB_NAME="reforged-db-v1",e}();function d(e){return new Promise((function(t){return setTimeout(t,e)}))}},891747:(e,t,r)=>{"use strict";r.d(t,{BrowserNotifications:()=>i});var n=r(612202),i=function(){var e=this;this.getState=function(){var t;return(null===(t=window.pushNotifier)||void 0===t?void 0:t.loadEndpoint())||window.ls.get("im_ui_notify_off")?"external":e.isBrowserNotificationsEnabled()},this.onChange=function(t){return t&&!e.isBrowserNotificationsEnabled()?new Promise((function(t){window.DesktopNotifications.requestPermission((function(){e.statlogsBrowserNotificationsOn(),t("external")}))})):!t&&e.isBrowserNotificationsEnabled()?(window.ls.set("im_ui_notify_off",1),e.statlogsBrowserNotificationsOff(),Promise.resolve(!1)):Promise.resolve(t)},this.onExternal=function(){return window.nav.go("/settings?act=notify")},this.isBrowserNotificationsEnabled=function(){return window.DesktopNotifications.supported()&&!window.DesktopNotifications.checkPermissionNeeded()&&!window.ls.get("im_ui_notify_off")},this.statlogsBrowserNotificationsOn=function(){(0,n.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)},this.statlogsBrowserNotificationsOff=function(){(0,n.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}}},497138:(e,t,r)=>{"use strict";r.d(t,{GeoLocation:()=>s});var n=r(570655),i=r(266372),s=function(){function e(){}return e.prototype.get=function(){return new Promise((function(e){(0,i.sendLocationFromKeyboard)((function(t){var r=(0,n.__read)(t,2)[1],i=(0,n.__read)(r.split("_"),2),s=i[0],o=i[1];e([s,o])}))}))},e}()},402508:(e,t,r)=>{"use strict";r.d(t,{Logger:()=>s});var n=r(570655),i=r(721422),s=function(){var e=this;this.visible=!1,this.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.visible&&console.log.apply(console,(0,n.__spreadArray)([],(0,n.__read)(t),!1))},this.error=function(e,t){t?console.error(e,t):console.error(e);var r=function(e){(0,i.logError)(e,{environment:"messenger"})};if(t instanceof Error){var n=new Error(e+" "+t.message);return n.name=t.name,n.stack=t.stack,r(n)}if("string"==typeof t)return r(new Error(e+" "+t));if(t&&"api_error"===t.type){var s=JSON.stringify(t.error);return r(new Error(e+" "+s))}return r(new Error(e))},this.show=function(){e.visible=!0},this.hide=function(){e.visible=!1}}},886204:(e,t,r)=>{"use strict";r.d(t,{Navigate:()=>c});var n=r(325489),i=r(654612),s=r(850167),o=r(113165),a=r(826338),c=function(){function e(){}return e.prototype.openApp=function(e){(0,s.showWiki)({w:e})},e.prototype.getProfileLink=function(e){return(0,a.isUserPeer)(e)?"/id"+e:(0,a.isCommunityPeer)(e)?"/club"+Math.abs(e):(0,a.isContactPeer)(e)?"/im?sel=mr"+(e-1e9):"/im?sel="+e},e.prototype.openLink=function(e,t,r){if(!(r.ctrlKey||r.metaKey||r.altKey||r.shiftKey)){if(r.preventDefault(),t)switch(t.kind){case"peer":break;case"attach":var a=t.attach;switch(a.kind){case"Photo":return void(0,s.showPhoto)(a.ownerId+"_"+a.id,a.messageAccessKey||a.accessKey||"",{queue:1},r.nativeEvent);case"Video":return void(0,n.showVideo)(a.ownerId+"_"+a.id,a.accessKey||"",{autoplay:1,minimized:0,module:"",queue:1},r.nativeEvent);case"Poll":return void(0,s.showWiki)({w:"poll"+a.ownerId+"_"+a.id},!1,r.nativeEvent,{queue:1});case"Story":return void(0,o.showStory)("story"+a.ownerId+"_"+a.id);case"Gift":return a.isStickerStyle&&a.id?window.Emoji.clickSticker(Math.abs(a.id)):void(0,i.showBox)("al_gifts.php",{act:"box",tab:"sent",mid:window.vk.id},{cache:1,stat:["gifts.css",window.jsc("web/gifts.js")]});case"MoneyTransfer":return void(0,i.showBox)("al_payments.php?act=money_transfer_history_box",{});case"Geo":return void(0,i.showBox)("al_places.php",{act:"show_photo_place",lat:a.coordinates.latitude,long:a.coordinates.longitude,provider:4});case"MiniApp":var c=a.appLink.replace("/","");return void(0,s.showWiki)({w:c,app_ref:"snippet_im"},!1,r.nativeEvent)}}window.nav.go(e)}},e}()},189754:(e,t,r)=>{"use strict";r.d(t,{Player:()=>l});var n=r(570655),i=r(452715),s=r(659397),o=r(189158),a=r(200134),c=r(850167),u=r(67766),l=function(){function e(t){var r=this;this.logger=t,this.player=(0,c.getAudioPlayer)(),this.listeners=[],this.state=e.initial(),this.play=function(t,n){return void 0===n&&(n=0),Promise.resolve().then((function(){if("Audio"===t.kind){r.reforgedPlayer.stop();var i=e.toAudio(t),s=new o.WebPlayerAdapter(r.player).getPlaylistId()?r.player.getCurrentPlaylist():r.player.getPlaylist(u.AudioPlaylist.TYPE_TEMP,window.vk.id,"im"+(t.peerId||""));s.mergeWith({list:[i]}),r.player.play(i,s,"im"),n>0&&r.player.seek(n)}else if("Voice"===t.kind)return r.player.stop(),window.Notifier.pauseGlobalMedia(),r.reforgedPlayer.play(t,n)}))},this.pause=function(){"playing"===r.state.status&&("Audio"===r.state.currentTrack.kind?r.player.pause():"Voice"===r.state.currentTrack.kind&&r.reforgedPlayer.pause())},this.resume=function(){"paused"===r.state.status&&("Audio"===r.state.currentTrack.kind?r.player.play():"Voice"===r.state.currentTrack.kind&&r.reforgedPlayer.resume())},this.stop=function(){r.player.stop()},this.subscribe=function(e){return r.listeners.push(e),function(){r.listeners=r.listeners.filter((function(t){return t!==e}))}},this.timeLeft=function(e){var t=e?r.state.voiceDuration:r.state.duration,n=e?r.state.voiceTime:r.state.time,i=Math.floor(t-n);return"-"+(0,s.formatDuration)(i)};var n=Symbol();this.reforgedPlayer=new i.Player(t),this.player.on(this,a.events.PLAY_REQUESTED,(function(t){r.setState({status:"loading",currentVoice:r.state.currentVoice||null,currentTrack:e.toTrack(t),progress:0,duration:t[5],time:0,voiceProgress:r.state.voiceProgress||0,voiceDuration:r.state.voiceDuration||0,voiceTime:r.state.voiceTime||0})})),this.player.on(n,a.events.PLAY,(function(t){r.setState({status:"playing",currentVoice:r.state.currentVoice||null,currentTrack:e.toTrack(t),progress:0,duration:t[5],time:0,voiceProgress:r.state.voiceProgress||0,voiceDuration:r.state.voiceDuration||0,voiceTime:r.state.voiceTime||0})})),this.player.on(this,a.events.PAUSE,(function(){"stopped"!==r.state.status&&r.setState({status:"paused",currentVoice:r.state.currentVoice||null,currentTrack:r.state.currentTrack,progress:r.state.progress||0,duration:r.state.duration||0,time:r.state.time||0,voiceProgress:r.state.voiceProgress||0,voiceDuration:r.state.voiceDuration||0,voiceTime:r.state.voiceTime||0})})),this.player.on(this,[a.events.STOP,a.events.ENDED],(function(){r.setState(e.initial())})),this.player.on(this,a.events.PROGRESS,(function(t,n){var i=t[5];r.setState({status:"playing",currentVoice:r.state.currentVoice||null,currentTrack:e.toTrack(t),progress:n,duration:i,time:n*i,voiceProgress:r.state.voiceProgress||0,voiceDuration:r.state.voiceDuration||0,voiceTime:r.state.voiceTime||0})})),this.reforgedPlayer.subscribe((function(e){r.setState(e),"stopped"!==e.status&&"ended"!==e.status||window.Notifier.resumeGlobalMedia()})),window.Notifier.addRecvClbk("video_start","fastchats",this.pause),window.Notifier.addRecvClbk("audio_start","fastchats",this.pause),window.Notifier.addRecvClbk("stories_video_start","fastchats",this.pause),window.Notifier.addRecvClbk("logged_off","fastchats",(function(){r.player.stop(),r.reforgedPlayer.stop()}))}return e.prototype.setState=function(e){var t=this;this.state=e,this.listeners.forEach((function(e){return e(t.state)}))},e.initial=function(){return{status:"stopped",currentVoice:null,currentTrack:null,progress:0,duration:0,time:0,voiceProgress:0,voiceDuration:0,voiceTime:0}},e.toTrack=function(e){var t=(0,n.__read)(e,25);return{kind:"Audio",id:t[0],ownerId:t[1],url:t[2],title:t[3],artist:t[4],duration:t[5],albumId:t[6],subtitle:t[16],trackCode:t[20],contentRestricted:t[21],albumPartNumber:t[22],accessKey:t[24],peerId:null}},e.toAudio=function(e){var t=e.id,r=e.ownerId,n=e.url,i=e.title,s=e.artist,o=e.duration,a=e.albumId,c=e.subtitle,u=e.trackCode,l=e.contentRestricted,f=e.albumPartNumber,d=e.accessKey;return[t,r,n,i,s,o,a||0,0,"",0,0,"im","[]","/////"+d+"/","",{},c||"","","",!1,u||"",l||0,f||0,0,d||"",!1]},e}()},607660:(e,t,r)=>{"use strict";r.d(t,{ProxyStorage:()=>i});var n=r(617254),i=function(e){var t=this;this.identify=function(e){t.storage.identify(e)},this.get=function(e){return"settings-sound-notifications-on"===e?!window.ls.get("sound_notify_off"):t.storage.get(e)},this.set=function(e,r){"settings-sound-notifications-on"!==e?t.storage.set(e,r):window.ls.set("sound_notify_off",Number(!r))},this.del=function(e){"settings-sound-notifications-on"!==e?t.storage.del(e):window.ls.remove("sound_notify_off")},this.storage=new n.Storage(e),this.dbName=e}},334943:(e,t,r)=>{"use strict";r.d(t,{SharedEngine:()=>i});var n=r(211719),i=function(e,t){var r=this;if(this.logger=e,this.isMaster=t,this.queued={kind:"Buffer",buffer:[]},this.ts=0,this.pts=0,this.connect=function(e){return r.ts=e.ts,r.pts=e.pts,r.engine.connect(e)},this.poll=function(){return r.engine.poll()},this.isConnected=function(){return r.engine.isConnected()},this.skipWaiting=function(){if(r.isMaster)return r.engine.skipWaiting();r.broadcast&&r.broadcast({type:"skip-waiting"})},this.switch=function(e){if(r.broadcast)switch(r.logger.info("[SHARED ENGINE] switch to",e),e){case"master":switch(r.queued.kind){case"Callback":r.queued.cancel();break;case"Buffer":r.queued.buffer=[]}return void(r.isMaster=!0);case"slave":return void(r.isMaster=!1)}},this.fetch=function(e,t){return Promise.resolve().then((function(){if(!r.isMaster)return r.fetchSlave();var n=+(new URL(e).searchParams.get("ts")||1/0);return r.logger.info("[SHARED ENIGNE]",r.ts,n),n>r.ts?Promise.resolve({failed:1}):r.fetchMaster(e,t)})).then((function(e){return"ts"in e&&(r.ts=e.ts,r.pts=e.pts),e}))},this.fetchMaster=function(e,t){r.logger.info("[SHARED ENGINE] fetch master",e);var n,i=window.AbortController?new AbortController:void 0;return t&&i&&(n=window.setTimeout((function(){return i.abort()}),t)),fetch(e,{method:"POST",signal:null==i?void 0:i.signal,headers:{Connection:"keep-alive"}}).then((function(e){return e.json()})).then((function(e){var t=r.ts;return setTimeout((function(){r.broadcast&&r.broadcast({type:"updates",payload:{tsOld:t,data:e}})})),e})).finally((function(){n&&clearTimeout(n)}))},this.fetchSlave=function(){if("Callback"===r.queued.kind)return Promise.reject(new Error("vkcom engine slave double fetch error"));r.logger.info("[SHARED ENGINE] fetch slave");var e=r.queued.buffer.shift(),t=e?Promise.resolve(e):new Promise((function(e){r.queued={kind:"Callback",push:function(t){r.queued={kind:"Buffer",buffer:[]},e(t)},cancel:function(){r.queued={kind:"Buffer",buffer:[]},e({tsOld:r.ts,data:{ts:r.ts,pts:r.pts,updates:[]}})}}}));return t.then((function(e){return e.tsOld>r.ts?(r.queued={kind:"Buffer",buffer:[]},Promise.resolve({failed:1})):e.data}))},this.engine=new n.Engine(this.logger,this.fetch),this.version=this.engine.version,void 0!==window.BroadcastChannel){var i=new BroadcastChannel("messenger-shared-engine");this.broadcast=function(e){return i.postMessage(e)},i.onmessage=function(e){switch(e.data.type){case"updates":var t=e.data.payload;if(r.isMaster)return;if(r.logger.info("[SHARED ENGINE] broadcast received",t),!r.isConnected())return;return"Callback"===r.queued.kind?void r.queued.push(t):void r.queued.buffer.push(t);case"skip-waiting":return void r.engine.skipWaiting();default:r.logger.error("[SHARED ENGINE] Неизвестный бродкаст")}}}}},246767:(e,t,r)=>{"use strict";r.d(t,{SharedQueue:()=>n});var n=function(){function e(){var e=this;this.MAX_BUFFER_SIZE=50,this.unsubscribe=null,this.empty=function(){return{kind:"Buffer",buffer:[]}},this.poll=function(){if("Callback"===e.queued.kind)return e.queued.reject("Queue.poll вызван дважды!"),new Promise((function(t,r){e.queued={kind:"Callback",resolve:t,reject:r}}));var t=e.queued.buffer.shift();if(t)return Promise.resolve(t);if(!e.isConnected())throw new Error("Queue.connect еще не был вызван!");return new Promise((function(t,r){e.queued={kind:"Callback",resolve:t,reject:r}}))},this.disconnect=function(){switch(e.unsubscribe&&e.unsubscribe(),e.unsubscribe=null,e.queued.kind){case"Callback":e.queued.resolve({kind:"Disconnected",reason:"manual"}),e.queued=e.empty();break;case"Buffer":e.queued.buffer.push({kind:"Disconnected",reason:"manual"});break;default:e.queued}},this.isConnected=function(){return!!e.unsubscribe},this.queued=this.empty()}return e.prototype.connect=function(){var e=this;if(!this.isConnected()){this.queued=this.empty();var t=window.Notifier.getEventQueueInstance();this.unsubscribe=t.subscribe((function(t){var r={kind:"Batch",ts:"1",events:[t]};if("Callback"===e.queued.kind){var n=e.queued.resolve;return e.queued=e.empty(),void n(r)}if(e.queued.buffer.length>=e.MAX_BUFFER_SIZE)return e.unsubscribe&&e.unsubscribe(),e.unsubscribe=null,void e.queued.buffer.push({kind:"Disconnected",reason:"backpressure"});e.queued.buffer.push(r)}))}},e}()},927866:(e,t,r)=>{"use strict";r.d(t,{Stats:()=>a});var n=r(940441),i=r(724702),s=r(746133),o=r(95642),a=function(){this.logEvent=function(e,t){!function(e,t){if("type_action"===e){var r=t;switch(r.type){case"type_ab_custom_metrics_item":n.customMetricsCollector.logEvent(r.type_ab_custom_metrics_item);break;case"type_messaging_action_item":i.messagingActionItemStatCollector.logEvent(r.type_messaging_action_item);break;case"type_messaging_audio_message_item":s.audioMessageStatCollector.logEvent(r.type_messaging_audio_message_item);break;case"type_settings_changes_item":o.settingsChangesStatCollector.logEvent(r.type_settings_changes_item)}}}(e,t)}}},471996:(e,t,r)=>{"use strict";r.d(t,{createFeatureFlags:()=>u,createLang:()=>l,vkcom_textInputStub:()=>f,vkcom_mediaSelectorStub:()=>d,fastchatRouter:()=>h,isMasterTab:()=>v});var n=r(570655),i=r(553890),s=r(427144),o=r(19331),a=r(726271),c=r(786067);function u(){var e,t,r={helloStickersPack:[21,12467,53098,50456,50459,18164,134,51117,16263,4275,6329,12296,21560,13312,20952,56896,20465,11607,53320,53647],helloKeywordPack:(null===(t=null===(e=window.stickersKeywords)||void 0===e?void 0:e["привет"])||void 0===t?void 0:t.filter((function(e){return e>0})))||[]};return{me_fc_pinned_message:(0,o.partConfigEnabled)("me_fc_pinned_message"),me_fc_blue_unread_counters:(0,o.partConfigEnabled)("fc_blue_unread_counters"),me_re_disable_merge_convos:(0,o.partConfigEnabled)("me_re_disable_merge_convos"),me_community_messages_enabled:!1,me_sticker_packs:r,me_fc_multiple_windows:!0,me_fc_tooltips:!0,me_fc_simple_composer:!1,me_fc_message_actions:(0,o.partConfigEnabled)("me_fc_message_actions"),me_message_selecting:(0,o.partConfigEnabled)("me_message_selecting"),me_channels:!1}}function l(e){var t=Object.values((0,c.getLang)("months_of","raw")),r=Object.values((0,c.getLang)("months_sm_of","raw"));return new i.Lang(e,"ru",{keys:(0,n.__assign)((0,n.__assign)({},window.lang),{global_months_of:t,global_months_short_of:r}),config:window.langConfig})}function f(){return{init:function(){return 1},destroy:function(){},show:function(){},hide:function(){},val:function(){return""},focus:function(){},swapCallbacks:function(){}}}function d(){return{create:function(){return function(){}},isUploading:function(){return!1},removeMedia:function(){}}}var h=new s.Router;function v(){return!window.curNotifier||window.curNotifier.is_server||a.browser.safari}}}]);try{stManager.done("dist/3f009728a63528384f06cb38ea4ede79.37ecba4d068816792ffb.js")}catch(e){}
(self.webpackChunkvk=self.webpackChunkvk||[]).push([[17592],{104022:(e,t,o)=>{"use strict";o.d(t,{default:()=>r});const r=(0,o(379333).makeIcon)("Icon16Videocam","videocam_16","0 0 16 16",'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="videocam_16"><path fill-rule="evenodd" clip-rule="evenodd" d="M4 3.75a2 2 0 0 0-2 2v4.5a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2v-4.5a2 2 0 0 0-2-2H4zm11 2.2a.454.454 0 0 0-.103-.286c-.171-.21-.53-.19-.723-.095-.193.095-1.571.788-1.571.788a.233.233 0 0 0-.103.191v2.88c0 .075.038.145.103.19 0 0 1.097.548 1.571.789.434.22.826.033.826-.382V5.951z" fill="currentColor" /></symbol>',16,16)},410902:(e,t,o)=>{"use strict";o.d(t,{default:()=>r});const r=(0,o(379333).makeIcon)("Icon24ErrorCircleOutline","error_circle_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="error_circle_outline_24"><path fill-rule="evenodd" d="M4.929 4.929A9.971 9.971 0 0 1 12 2a9.972 9.972 0 0 1 7.071 2.929A9.972 9.972 0 0 1 22 12a9.972 9.972 0 0 1-2.929 7.071A9.972 9.972 0 0 1 12 22a9.972 9.972 0 0 1-7.071-2.929A9.972 9.972 0 0 1 2 12a9.972 9.972 0 0 1 2.929-7.071ZM12 3.8a8.172 8.172 0 0 0-5.798 2.402A8.172 8.172 0 0 0 3.8 12a8.17 8.17 0 0 0 2.402 5.798A8.171 8.171 0 0 0 12 20.2a8.172 8.172 0 0 0 5.798-2.402A8.172 8.172 0 0 0 20.2 12a8.171 8.171 0 0 0-2.402-5.798A8.172 8.172 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd" /></symbol>',24,24)},815653:(e,t,o)=>{"use strict";o.d(t,{default:()=>r});const r=(0,o(379333).makeIcon)("Icon24MenuOutline","menu_outline_24","0 0 24 24",'<symbol fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="menu_outline_24"><path d="M21 11H3a1 1 0 1 0 0 2h18a1 1 0 1 0 0-2zm0-7H3a1 1 0 0 0 0 2h18a1 1 0 1 0 0-2zM3 20h18a1 1 0 1 0 0-2H3a1 1 0 1 0 0 2z" fill="currentColor" /></symbol>',24,24)},281536:(e,t,o)=>{"use strict";o.d(t,{default:()=>r});const r=(0,o(379333).makeIcon)("Icon24MoreHorizontal","more_horizontal_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="more_horizontal_24"><g fill="none" fill-rule="evenodd"><path d="M24 0H0v24h24z" /><path d="M18 10c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2Zm-6 4c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Zm-6 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Z" fill="currentColor" /></g></symbol>',24,24)},521114:(e,t,o)=>{"use strict";o.d(t,{default:()=>r});const r=(0,o(379333).makeIcon)("Icon24NarrativeActiveOutline","narrative_active_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="narrative_active_outline_24"><path d="M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 1 1-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.726 1.726 0 0 0-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119c-.26.243-.43.539-.512.886-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302.244.26.54.43.887.512.401.093.745.076 1.607-.14a1 1 0 1 1 .487 1.94c-1.148.288-1.805.32-2.549.147a3.726 3.726 0 0 1-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.722 3.722 0 0 1 .93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22zM18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.174 4.174 0 0 1 2.036-.653z" fill="currentColor" /></symbol>',24,24)},662199:(e,t,o)=>{"use strict";o.d(t,{default:()=>r});const r=(0,o(379333).makeIcon)("Icon24Write","write_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="write_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="m14.188 6.273 3.54 3.54-8.624 8.622a6.674 6.674 0 0 1-2.77 1.664l-2.903.886a.334.334 0 0 1-.416-.416l.886-2.902a6.674 6.674 0 0 1 1.664-2.771l8.623-8.623Zm1.061-1.06 1.769-1.77a1.5 1.5 0 0 1 2.121 0l1.418 1.419a1.5 1.5 0 0 1 0 2.121L18.79 8.752l-3.54-3.54Z" fill="currentColor" /></g></symbol>',24,24)},587083:(e,t,o)=>{"use strict";o.d(t,{default:()=>r});const r=(0,o(379333).makeIcon)("Icon28AddOutline","add_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="add_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M14 4a1 1 0 0 1 1 1v8h8a1 1 0 0 1 0 2h-8v8a1 1 0 0 1-2 0v-8H5a1 1 0 0 1 0-2h8V5a1 1 0 0 1 1-1Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28)},488124:(e,t,o)=>{"use strict";o.d(t,{default:()=>r});const r=(0,o(379333).makeIcon)("Icon36Add","add_36","0 0 36 36",'<symbol viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" id="add_36"><g fill="none" fill-rule="evenodd"><path d="M0 0h36v36H0z" /><path d="M19.5 19.5v9a1.5 1.5 0 0 1-3 0v-9h-9a1.5 1.5 0 0 1 0-3h9v-9a1.5 1.5 0 0 1 3 0v9h9a1.5 1.5 0 0 1 0 3h-9Z" fill="currentColor" /></g></symbol>',36,36)},387142:(e,t,o)=>{"use strict";o.d(t,{default:()=>d});var r=o(803834),i=o(982452),n=o(315544),a=o(695724),s=o(49535);function l(e,t,o){if((0,a.isObject)(t)?o=t:this._dragElClass=t,this.options=(0,a.extend)({dragThreshold:l.DRAG_THRESHOLD_DIST},o),this._contEl=(0,n.ge)(e),this._contEl){this._excludedCount=0;for(var r=0;r<this._contEl.children.length;r++)this._contEl.children[r].getAttribute("nodrag")&&this._excludedCount++;(0,s.addEvent)(this._contEl,"mousedown",this._ev_mousedown_handler=this._onMouseDown.bind(this)),(0,n.setStyle)(this._contEl,"position","relative"),this._inited=!0,this._updateScrollbar=this._initUpdaterScrollbar()}}l.AUTO_SCROLL_DY=10,l.DRAG_THRESHOLD_DIST=0,l.AUTO_SCROLL_DISTANCE_THRESHOLD=300,l.AUTO_SCROLL_GAP=300,l.prototype.destroy=function(){this._inited&&(this._inited=!1,this._deinitEvents(!0))},l.prototype._getParentDragItemEl=function(e){for(var t,o=e;o&&(t=(0,n.domPN)(o))!==this._contEl;)o=t;return o===this._curPlaceholderEl&&(o=null),o},l.prototype._onKey=function(e){e.keyCode===s.KEY.ESC&&this.isCurrentlyDragging()&&this._onMouseUp()},l.prototype._onMouseDown=function(e){if(!(this._disabled||0!=e.button||this._curDragEl||(0,n.attr)(e.target,"nodrag")||this._dragElClass&&!(0,n.domClosest)(this._dragElClass,e.target))){for(var t=e.target;t&&t!==window.document;){if((0,a.intval)((0,n.domData)(t,"nodrag")))return;t=(0,n.domPN)(t)}var o=this._getParentDragItemEl(e.target);if(o&&!(0,n.attr)(o,"nodrag")&&((0,n.re)((0,n.geByClass1)("ui_gridsorter_placeholder"),this._contEl),this._contInfo=this._contInfo||{prevSize:(0,n.getSize)(this._contEl)},this._ensureGridIsActual(),!(this._grid.length<=1))){var r=window.getComputedStyle(o),i=(0,n.getXY)(o);this._initial={candidateEl:o,x:e.clientX,y:e.clientY,itemMargin:{x:parseInt(r.marginLeft),y:parseInt(r.marginTop)},shift:{x:e.pageX-i[0],y:e.pageY-i[1]}},(0,s.addEvent)(document,"mousemove",this._ev_mousemove_handler=this._onMouseMove.bind(this)),(0,s.addEvent)(document,"mouseup",this._ev_mouseup_handler=this._onMouseUp.bind(this)),(0,s.addEvent)(document,"keydown",this._ev_keydown_handler=this._onKey.bind(this)),cur.cancelClick=!1,(0,s.cancelEvent)(e)}}},l.prototype._dist=function(e){return Math.abs(e.clientX-this._initial.x)+Math.abs(e.clientY-this._initial.y)},l.prototype._onMouseUp=function(e){var t=this._curDragEl,o=!e;if(this._curDragEl){this._curDragEl=null,(0,n.removeClass)(t,"ui_gridsorter_moveable_notrans"),this._curOverCell||(this._curOverCell={el:this._curPlaceholderEl,pos:(0,n.getXY)(this._curPlaceholderEl),size:(0,n.getSize)(this._curPlaceholderEl)});var r=this._curOverCell.pos,i=this._curOverCell.el,a=this._grid[this._curDragCellIndex],l=a&&a.size;(0,n.gpeByClass)("_ape_item_list",t)&&(r[0]+=20,r[1]+=20),l&&this._isShiftToLeft&&(r[1]-=l[1]-this._curOverCell.size[1]),setTimeout((()=>{if(o){for(var e=0,i=this._grid.length;e<i;e++){var n=this._grid[e];n.dirty&&this._setPos(n.el,{left:0,top:0})}this._setPos(t,this._initialCurDragPos)}else this._setPos(t,{left:r[0],top:r[1]})})),setTimeout((()=>{if((0,n.re)(this._curPlaceholderEl),(0,n.removeClass)(this._contEl,"ui_gridsorter_cont"),this.options.dragCls&&(0,n.removeClass)(t,this.options.dragCls),this._inited){var e;if(o){for(var r=this._grid.length,a=0;a<r;a++){var s=this._grid[a];s.dirty&&this._setPos(s.el,{left:null,top:null})}this._setPos(t,{left:null,top:null,width:null,height:null})}else{var l;e=this._isShiftToLeft?(0,n.domNS)(i):i,this._contEl.insertBefore(t,e);var d=-1,c=this._initial.hasInlineSize;this._setPos(t,{left:null,top:null}),c||(0,n.setStyle)(t,{width:null,height:null});for(var u=this._grid.length,v=0;v<u;v++){var h=this._grid[v];(h.dirty||h.el===t)&&(this._setPos(h.el,{left:null,top:null}),c||(0,n.setStyle)(h.el,{width:null,height:null}),h.pos=this._calcElementPos(h.el),h.dirty=!1),h.el===t?l=v:h.el===i&&(d=v)}if(d>=0){var _=this._grid.splice(l,1);this._grid.splice(d,0,_[0])}}(0,n.removeClass)(t,"ui_gridsorter_moveable"),this._curOverCell=this._curPlaceholderEl=null,o&&this.update(),this.options.onDragFinish&&this.options.onDragFinish(t),i!==t&&!o&&this.options.onReorder&&this.options.onReorder(t,e,(0,n.domPS)(t))}}),210),e&&this._dist(e)>5&&((0,s.cancelEvent)(e),cur.cancelClick=!0)}this._updateScrollbar(),this._deinitEvents(),t&&this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,t),o||t&&this._overEl&&this.options.onDragDrop&&(o=this.options.onDragDrop(this._overEl,t)),this._overEl=null},l.prototype._deinitEvents=function(e){e&&(this._onMouseUp(),(0,s.removeEvent)(this._contEl,"mousedown",this._ev_mousedown_handler)),clearTimeout(this._autoScrollTO),this._autoScrollTO=!1,this._ev_mousemove_handler&&(0,s.removeEvent)(document,"mousemove",this._ev_mousemove_handler),this._ev_mouseup_handler&&(0,s.removeEvent)(document,"mouseup",this._ev_mouseup_handler),this._ev_keydown_handler&&(0,s.removeEvent)(document,"keydown",this._ev_keydown_handler)},l.prototype._setPos=function(e,t){this.options.noPosTransform||!this._hasTranslateFeauture&&!(this._hasTranslateFeauture=window.getComputedStyle(e).getPropertyValue("transform"))?(0,n.setStyle)(e,(0,a.extend)({transform:null},t)):null===t.left||null===t.top?(0,n.setStyle)(e,{transform:null,top:null,left:null}):(0,n.setStyle)(e,{transform:"translate("+t.left+"px, "+t.top+"px)",top:null,pos:null})},l.prototype._recalc=function(){var e=this._curDragEl,t=this._curOverCell.el;if(this._initGrid(),t!==e){for(var o=0,r=!1,i=!1,n=this._grid.length,a=0;a<n;a++){var s=this._grid[a];if(s.el===e){r=!0;break}if(s.el===t){r=!1;break}}this._isShiftToLeft=r;for(var l=r?0:this._grid.length-1,d=r?this._grid.length:-1,c=r?1:-1,u=[0,0];l!==d;l+=c){var v=this._grid[l];if(2!==o)if(v.el!==e){if(v.el===t&&o++,1===o||2===o){var h=0,_=0;r?(h=i.pos[0]+u[0],_=i.pos[1]+u[1],u[0]+=v.size[0]-i.size[0],u[1]+=v.size[1]-i.size[1]):(u[0]+=i.size[0]-v.size[0],u[1]+=i.size[1]-v.size[1],h=i.pos[0]+u[0],_=i.pos[1]+u[1]),this._setPos(v.el,{left:h-v.pos[0],top:_-v.pos[1]}),v.dirty=!0}else v.dirty&&(this._setPos(v.el,{left:null,top:null}),v.dirty=!1);i=v}else o++,i=v;else v.dirty&&(this._setPos(v.el,{left:null,top:null}),v.dirty=!1),i=v}}else for(var p=this._grid.length,g=0;g<p;g++){var f=this._grid[g];f.el!==e&&f.dirty&&(f.dirty=!1,this._setPos(f.el,{left:null,top:null}))}},l.prototype.disable=function(){this._disabled=!0},l.prototype.enable=function(){this._disabled=!1,this._initGrid(!0)},l.prototype.update=function(){this._disabled||this._initGrid(!0)},l.prototype._ensureGridIsActual=function(){this._initGrid()},l.prototype._needGridUpdate=function(){if(!this._grid)return 1;this._contInfo.prevSize=this._contInfo.prevSize||(0,n.getSize)(this._contEl);var e=0,t=this._contEl.children.length-this._excludedCount-(0,a.intval)(!!this._curPlaceholderEl);if(t!==this._grid.length)e=t>this._grid.length?2:1,this._contInfo.prevSize=(0,n.getSize)(this._contEl);else{var o=(0,n.getSize)(this._contEl),r=this._contInfo.prevSize;(Math.abs(r[0]-o[0])>5||Math.abs(r[1]-o[1])>5)&&(e=1),this._contInfo.prevSize=o}return e},l.prototype._initGrid=function(e){var t=e?1:this._needGridUpdate();if(t){1===t&&(this._grid=[],this._contInfo&&(delete this._contInfo.pos,delete this._contInfo.size));var o=this._grid?this._grid[this._grid.length-1]:null;this._grid=this._grid||[];var r,i=!!o,a=this._contEl.children;if(a.length)for(var s=this._getItemMargins(),l=this._curDragEl?this._grid.length:0,d=a.length;l<d;l++){var c=a[l];o&&c===o.el?i=!1:i||c===this._curPlaceholderEl||c.getAttribute("nodrag")||((r=(0,n.getSize)(c))[0]+=s[0],r[1]+=s[1],this._grid.push({el:c,size:r,pos:this._calcElementPos(c)}))}}},l.prototype._getRelativeMousePos=function(e){var t=this._getContPos(),o=this._getContShift();return{left:e.clientX-t[0]-o[0],top:e.clientY-t[1]-o[1]}},l.prototype._updateDraggablePosition=function(e){if(this._curDragEl){var t=this._getRelativeMousePos(e),o=this._getItemShift(),r=this._getContShift(),i=this._getContSize(),a=t.top-this._initial.shift.y-o[1]+r[1];this.options.limitBottomMove&&(a=Math.min(a,i[1]+30)),(0,n.hasClass)(this._contEl,"_ape_item_list")&&(a+=this._contEl.scrollTop),this._setPos(this._curDragEl,{left:t.left-this._initial.shift.x-o[0]+r[0],top:a}),window.AudioPage&&window.AudioPage.onUpdateDraggablePosition&&window.AudioPage.onUpdateDraggablePosition()}},l.prototype._getContShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.shift){var e=window.getComputedStyle(this._contEl);this._contInfo.shift=[parseFloat(e.paddingLeft),parseFloat(e.paddingTop)]}return this._contInfo.shift},l.prototype._getContSize=function(){return this._contInfo=this._contInfo||{},this._contInfo.size=(0,n.getSize)(this._contEl),this._contInfo.size},l.prototype._getContPos=function(){return this._contInfo=this._contInfo||{},this._contInfo.pos=(0,n.getXY)(this._contEl),this._contInfo.pos[1]-=(0,r.scrollGetY)(),this._contInfo.pos},l.prototype._getItemShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemShift){var e=window.getComputedStyle((0,n.domFC)(this._contEl));this._contInfo.itemShift=[parseFloat(e.marginLeft),parseFloat(e.marginTop)]}return this._contInfo.itemShift},l.prototype._getItemMargins=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemMargins){var e=window.getComputedStyle((0,n.domFC)(this._contEl));this._contInfo.itemMargins=[parseFloat(e.marginLeft)+parseFloat(e.marginRight),parseFloat(e.marginTop)+parseFloat(e.marginBottom)]}return this._contInfo.itemMargins},l.prototype._calcElementPos=function(e){var t=this._getContShift(),o=this._getItemShift();return[e.offsetLeft-t[0]-o[0],e.offsetTop-t[1]-o[1]]},l.prototype.isCurrentlyDragging=function(){return!!this._curDragEl},l.prototype._initUpdaterScrollbar=function(){return(0,i.throttle)((e=>{var t=this.options.wrapNode||e,o=(0,n.data)(t,"sb");o&&o.update(!1,!0)}),500)},l.prototype._onMouseMove=function(e){var t=()=>this.options.wrapNode?this.options.wrapNode.scrollTop:(0,r.scrollGetY)(),o=e=>{this.options.wrapNode?this.options.wrapNode.scrollTop=e:(0,r.scrollToY)(e,0,!1,!0)};if(this._curDragEl){this._ensureGridIsActual(),!e&&(e={clientX:this._lastMousePos.x,clientY:this._lastMousePos.y}),this._lastMousePos={x:e.clientX,y:e.clientY},this._updateDraggablePosition(e);var i=this._getContSize(),a=this._getRelativeMousePos(e),l=!1;if((0,n.hasClass)(this._contEl,"_ape_item_list")&&(a.top+=this._contEl.scrollTop),a.left>0&&a.left<i[0]&&a.top>0&&a.top<i[1])for(var d=0,c=this._grid.length-1,u=50;u;){var v=d+Math.floor((c-d)/2),h=this._grid[v];if(a.left>h.pos[0]&&a.top>h.pos[1]&&a.left<h.pos[0]+h.size[0]&&a.top<h.pos[1]+h.size[1]){l=h;break}if(d===c)break;a.top<h.pos[1]||a.left<h.pos[0]&&a.top<h.pos[1]+h.size[1]?c=c===v?c-1:v:d=d===v?d+1:v,u--}else{for(var _,p,g,f=this._grid.length,m=999999,w=0;w<f;w++){var y=this._grid[w],S=(p=a.left-(y.pos[0]+y.size[0]/2))*p+(g=a.top-(y.pos[1]+y.size[1]/2))*g;m>S&&(m=S,_=y)}l=_}!l||this._curOverCell&&this._curOverCell.el===l.el||(this._curOverCell=l,this._recalc());var C,N,x,b,E=0;if(this.options.wrapNode)C=b=this.options.wrapNode,N=(0,n.getSize)(C),(x=(0,n.getXY)(C))[1]-=(0,r.scrollGetY)(),E=e.clientY;else{var k=window,T=document.documentElement,I=document.getElementsByTagName("body")[0],L=k.innerWidth||T.clientWidth||I.clientWidth,B=k.innerHeight||T.clientHeight||I.clientHeight;b=k.bodyNode,N=[L,B],x=[0,0],E=e.clientY}var P=Math.max(20,N[1]/10),D=x[1]+P-E,A=P-(x[1]+N[1]-E);if(A>0||D>0){var R=Math.min(1,D/P),j=Math.min(1,A/P);this._autoScrollTO||(this._autoScrollTO=setTimeout((()=>{this._autoScrollTO=!1;var e=t();o(e+16*(R>0?-R:j)),e!==b.scrollTop&&(this._updateScrollbar(b),this._onMouseMove())}),20))}if(this.options.onDragOverElClass){var O=e.target;(0,n.hasClass)(O,this.options.onDragOverElClass)||(O=(0,n.gpeByClass)(this.options.onDragOverElClass,O))?this._overEl!==O&&(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this.options.onDragEnter&&this.options.onDragEnter(O,this._curDragEl),this._overEl=O):(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this._overEl=null)}}else if(this._dist(e)>this.options.dragThreshold){this._curDragEl=this._initial.candidateEl;for(var M=this._grid.length,U=0;U<M;U++)if(this._grid[U].el===this._curDragEl){this._curDragCellIndex=U;break}this.options.dragCls&&(0,n.addClass)(this._curDragEl,this.options.dragCls);var H=(0,n.getSize)(this._curDragEl),F=(0,n.getXY)(this._curDragEl),G=window.getComputedStyle(this._curDragEl),V=this._getContPos();this._initial.hasInlineSize=!(!this._curDragEl.style.width&&!this._curDragEl.style.height),(0,n.setStyle)(this._curDragEl,{width:H[0],height:H[1]}),this._initialCurDragPos={left:F[0]-V[0],top:F[1]-V[1]-bodyNode.scrollTop},this._curPlaceholderEl=(0,n.ce)("div",{className:"ui_gridsorter_placeholder"}),(0,n.setStyle)(this._curPlaceholderEl,{width:H[0]+parseFloat(G.marginLeft)+parseFloat(G.marginRight),height:H[1]+parseFloat(G.marginTop)+parseFloat(G.marginBottom)}),this._contEl.insertBefore(this._curPlaceholderEl,this._curDragEl),(0,n.addClass)(this._curDragEl,"ui_gridsorter_moveable"),(0,n.addClass)(this._curDragEl,"ui_gridsorter_moveable_notrans"),(0,n.addClass)(this._contEl,"ui_gridsorter_cont"),this._onMouseMove(e),this._updateDraggablePosition(e),this.options.onDragStart&&this.options.onDragStart(this._curDragEl)}(0,s.cancelEvent)(e)};const d=l},601261:(e,t,o)=>{"use strict";o.d(t,{ON_BOARDING_BG_RECT_ID:()=>c,default:()=>h});o(530522),o(66108),o(296253),o(991181),o(579665),o(95767);var r=o(315544),i=o(49535),n=o(803834),a=o(696547),s=o(99392);function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],r=!0,i=!1,n=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(o.push(a.value),!t||o.length!==t);r=!0);}catch(e){i=!0,n=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return d(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var c="onboarding_bg_rect",u="page_header_cont",v="onboarding";class h{constructor(e,t){var o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.el=e,this.text=t,this.hideDarkness=!0,this.oldColor=!1;var i,n,a={autoShow:!1,noAutoHideOnWindowClick:null===(o=r.noAutoHideOnWindowClick)||void 0===o||o,content:t instanceof HTMLElement?t:`${t}`,cls:`feature_intro_tt tutorial_tip_tt ${n=null!==(i=r.class)&&void 0!==i?i:"",r.tooltipWhite?n:n+" feature_intro_blue_tt"}`,appendToParent:!0,onHide:this.ttOnHide.bind(this),scrollOffset:r.scrollOffset||0,align:r.align||s.ElementTooltip.ALIGN_CENTER};r.side&&(a.forceSide=r.side),r.offset&&(a.offset=r.offset),r.width&&(a.width=r.width),r.shift&&(a.centerShift=r.shift),r.border?this.border=r.border:this.border=[10,10,10,10],r.ttOnHide&&(a.onHide=r.ttOnHide),r.withCloseButton&&(a.withCloseButton=r.withCloseButton,a.onCloseButtonClick=r.onCloseButtonClick),r.align&&(a.align=r.align),this.ttParams=a,this.opts=r,this.initOnboardingBG()}initOnboardingBG(){if(!window.onboardingBG){var e=(0,r.se)('\n<div id="onboarding_layout">\n  <svg id="onboarding_bg_header" width="100%" height="49px">\n    <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="0" width="100%" height="100%" fill-opacity="0.8" fill="#000"></rect>\n  </svg>\n  <svg id="onboarding_bg" width="100%" height="100%">\n  <defs>\n    <mask id="mask" x="0" y="0" width="100%" height="100%">\n      <rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect>\n      <rect id="onboarding_bg_clip" class="GroupOnboardingBgClip" x="0" y="0" width="0" height="0" fill="#000" rx="8" ry="8"></rect>\n    </mask>\n  </defs>\n  <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="42" width="100%" height="100%" mask="url(#mask)" fill-opacity="0.8"></rect>\n  </svg>\n</div>\n      ');(0,r.domInsertBefore)(e,window.layerBG),window.onboardingBGHeader=(0,r.ge)("onboarding_bg_header"),window.onboardingBG=(0,r.ge)("onboarding_bg"),window.onboardingBGRect=(0,r.ge)(c),window.onboardingBGClip=(0,r.ge)("onboarding_bg_clip"),window.cur.destroy.push((()=>{(0,r.hide)(window.onboardingBG),(0,r.hide)(window.onboardingBGHeader),(0,r.removeClass)((0,r.ge)(u),v),this.hideDarkness=!0,this.hideTT(),delete window.onboardingBG,delete window.onboardingBGHeader,delete window.onboardingBGRect,delete window.onboardingBGClip,this.opts.onBGClick&&(0,i.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick)}))}this.opts.onBGClick&&(0,i.addEvent)(window.onboardingBG,"click",this.opts.onBGClick)}showTT(){var e=l((0,r.getXY)(this.el),2)[1];this.tt=new s.ElementTooltip(this.el,this.ttParams),this.opts.highlight&&(this.addDarkness(),this.addHighlight()),this.tt.show();var t=this.tt.getContent();(0,a.isElementInViewport)(this.el)&&(0,a.isElementInViewport)(t)||(0,n.scrollToY)(e-42-this.ttParams.scrollOffset)}hideTT(){this.tt&&(this.tt.destroy(),this.removeDarkens(),this.hideDarkness&&((0,i.removeEvent)(window,"scroll"),(0,i.removeEvent)(window,"resize")),this.opts.onBGClick&&window.onboardingBG&&(0,i.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick),this.opts.onHide&&this.opts.onHide())}addHighlight(){window.onboardingBGClip&&(this.highlightElement(),(0,i.addEvent)(window,"scroll",this.onScrollTT.bind(this)),(0,i.addEvent)(window,"resize",this.onResizeTT.bind(this)))}highlightElement(){var e=this.el.offsetWidth,t=this.el.offsetHeight,o=(0,r.getXY)(this.el);(0,r.attr)(window.onboardingBGClip,"width",e+this.border[1]+this.border[3]),(0,r.attr)(window.onboardingBGClip,"height",t+this.border[0]+this.border[2]),(0,r.attr)(window.onboardingBGClip,"x",o[0]-this.border[1]),(0,r.attr)(window.onboardingBGClip,"y",o[1]-this.border[0])}onResizeTT(){this.setDartToFullWidth(),this.highlightElement()}onScrollTT(){var e=this.getPageHeight();window.onboardingBG.height!=e&&this.setDartToFullHeight()}setDartToFullHeight(){(0,r.attr)(window.onboardingBG,"height",this.getPageHeight())}setDartToFullWidth(){(0,r.attr)(window.onboardingBG,"width",this.getPageWidth()),(0,r.attr)(window.onboardingBGHeader,"width",this.getPageWidth())}addDarkness(){(0,r.isVisible)(window.onboardingBG)||(this.setDartToFullHeight(),this.setDartToFullWidth(),(0,r.show)(window.onboardingBG),(0,r.isVisible)(window.onboardingBGHeader)||((0,r.show)(window.onboardingBGHeader),(0,r.addClass)((0,r.ge)(u),v)))}removeDarkens(){this.hideDarkness&&((0,r.hide)(window.onboardingBG),(0,r.hide)(window.onboardingBGHeader),(0,r.removeClass)((0,r.ge)(u),v))}ttOnHide(){this.hideTT()}show(){setTimeout(this.showTT.bind(this),1e3)}getPageWidth(){var e=document.documentElement,t=document.body;return Math.max(t.scrollWidth,e.scrollWidth,t.offsetWidth,e.offsetWidth,t.clientWidth,e.clientWidth)}getPageHeight(){var e=document.documentElement,t=document.body;return Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,t.clientHeight,e.clientHeight)}}},696547:(e,t,o)=>{"use strict";function r(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}o.d(t,{isElementInViewport:()=>r})},980309:(e,t,o)=>{"use strict";o.d(t,{getNativeOption:()=>n,createScroll:()=>d});var r=o(610124),i=o(803834);function n(e,t){return bodyNode[e]||document.documentElement[e]}class a{constructor(e,t){this.el=e,this.opts=t,this.module=(0,r.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return n("scrollTop",this.el);!function(e,t,o){"scrollTop"===e&&window.scrollTo(0,t)}("scrollTop",e,this.el)}contHeight(){return n("scrollHeight")}smoothScroll(e){(0,i.scrollToY)(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=Date.now(),o=()=>{Date.now()-t<500&&this.scrollBottom(e),window.removeEventListener("scroll",o)};window.addEventListener("scroll",o),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),o=t-this.prevScroll,r=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-o,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&r-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){(0,r.destroyModule)(this.module)}}class s{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var o=this.scrollTop(),r=this.prevTop-o;this.prevTop=o,t.scrollChange&&t.scrollChange(o),t.onScroll&&t.onScroll(r,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",(()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)})),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class l{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function d(e,t){return t.noScroll?new l(e):t.nativeScroll?new a(e,t):new s(e,t)}},418793:(e,t,o)=>{"use strict";o.d(t,{Scroll:()=>s});o(95767),o(991181),o(296253);var r=o(667294),i=o(32821),n=o(980309);o(45697);function a(e,t){if(null==e)return{};var o,r,i=function(e,t){if(null==e)return{};var o,r,i={},n=Object.keys(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||(i[o]=e[o]);return i}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var s=e=>{var t=e.children,o=a(e,["children"]);return r.createElement(i.ScrollContext.Provider,{value:{createScroll:n.createScroll}},r.createElement(i.Scroll,o,t))};s.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},542041:(e,t,o)=>{"use strict";o.d(t,{Likes:()=>y});o(991181),o(296253),o(796409),o(59357),o(175115),o(21466);var r=o(315544),i=o(49535),n=o(376852),a=o(695724),s=o(635676),l=o(850167),d=o(40906),c=o(654612),u=o(786067),v=o(465864),h=o(325698),_=o(95146),p=o(908706),g=o(107337),f=o(576772),m=o(210277);function w(){return w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},w.apply(this,arguments)}var y={toggle(e,t,o,n){if((0,i.cancelEvent)(t),(0,d.isObject)(window.cur)&&(0,d.isFunction)(cur.viewAsBox))return cur.viewAsBox();if(vk.widget&&!vk.id)return window.Widgets.oauth();var a=(0,r.hasClass)(e,"active");(0,r.addClass)(e,"animate"),this.clientUpdate(o,h.LikeButtonTypes.like,a?-1:1,!a);var s=()=>{(0,r.toggleClass)(e,"active",a),this.clientUpdate(o,h.LikeButtonTypes.like,a?1:-1,a)};window.ajax.post("like.php",{act:a?"a_do_unlike":"a_do_like",object:o,hash:n,list:cur.pvListId,wall:2,from:this._getReference(o),from_widget:vk.widget?1:0},{onDone:t=>{if(t.unauth_action_box)return s(),void f.UnauthActionBox.show(t.unauth_action_box);this.update(o,t);var r=o.match(/^(wall|market)(.*)/);r&&cur.onLike&&cur.onLike(e,r[1],r[2],a)},onFail:()=>(s(),!1)}),(0,d.intval)((0,r.domData)(e,"count"))>0?y.showLikes(e,o,{fast:!0}):e.tt&&e.tt.destroy&&e.tt.destroy()},_getReference:e=>cur.pvShown?"photo_viewer":e===cur.wallLayer?"wkview":window.mvcur&&window.mvcur.mvShown?"videoview":cur.wallType?"feed"===cur.wallType?"news"===cur.section?`feed_${cur.subsection?cur.subsection:cur.section}`:"recommended"===cur.section?"feed_recommended"+("recent"!==cur.subsection?"_"+cur.subsection:""):(0,a.inArray)(cur.section,["friends","groups","videos","photos"])?"feed_"+(cur.subsection?"_"+cur.subsection:""):`feed_${cur.section}`:"top"===cur.wallType?"wall_top":"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full"):cur.module,share(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(vk.widget&&!vk.id)return window.Widgets.oauth();if((0,d.isObject)(window.cur)&&(0,d.isFunction)(cur.viewAsBox))return cur.viewAsBox();var o=(0,v.parseLikeObjectId)(e),r=o.objectType,i=o.objectId;(vk.widget?window.showBox:c.showBox)("like.php",w({act:"publish_box",object:e,from_widget:vk.widget?1:0},t),{onDone:(e,t)=>{t.unauth_action_box&&(e.hide(),f.UnauthActionBox.show(t.unauth_action_box))},stat:["page.js","page.css","wide_dd.js","wide_dd.css",window.jsc("web/sharebox.js")]}),"wall"===r&&window.Wall&&window.Wall.triggerAdPostStat(i,"share_post"),cur.RpcMethods&&(cur.RpcMethods.likeFullUpdate=t=>y.update(e,window.cleanObj(t)))},clientUpdate(e,t,o,i){var n=this._getButtonsByType(e,t);if(n.length){var a=(0,d.intval)((0,r.domData)(n[0],"count"))+o;this._updateDom(e,t,a,i),this.updateExternalIndex(e,{type:t,count:a,isActive:i})}},update(e,t){if(!isNaN(parseInt(t.like_num))){var o=(0,d.isUndefined)(t.like_my)?void 0:!!(0,d.intval)(t.like_my);this._updateDom(e,h.LikeButtonTypes.like,t.like_num,o,t.like_title),this.updateExternalIndex(e,{type:h.LikeButtonTypes.like,count:t.like_num,isActive:o})}if(!isNaN(parseInt(t.share_num))){var r=(0,d.isUndefined)(t.share_my)?void 0:!!(0,d.intval)(t.share_my);this._updateDom(e,h.LikeButtonTypes.share,t.share_num,r,t.share_title),this.updateExternalIndex(e,{type:h.LikeButtonTypes.share,count:t.share_num})}if((0,a.isNumeric)(t.views_num)&&this._updateDom(e,h.LikeButtonTypes.views,t.views_num,void 0,t.views_title),(0,a.isNumeric)(t.comment_num)&&this._updateDom(e,h.LikeButtonTypes.comment,t.comment_num),t[_.REACTIONS_COUNTS_RESPONSE_FIELD]){var i=!!t.isQueueUpdate;(0,g.triggerReactionsUpdate)(e,t[_.REACTIONS_COUNTS_RESPONSE_FIELD],void 0,{isQueueUpdate:i,isUserAction:!1,previewVisibility:p.previewVisibilityUseCurrent})}},updateComments(e,t){this.update(e,{comment_num:t})},_updateDom(e,t,o,i,n){var l=this._getButtonsByType(e,t),c=t===h.LikeButtonTypes.views;if(null==l?void 0:l.length){var _="";c?_=o:o>0&&(_=vk.widget?(0,a.formatCount)(o):(0,u.langNumeric)(o,"%s",!0)),c||(o=(0,d.intval)(o));for(var p=0;p<l.length;p++){var g=l[p];if(!(0,r.hasClass)(g,"no_counter")){var f,w,y=c?l[p]:(0,v.getElementLikeButtonCount)(l[p]);if((0,s.animateCount)(y,_,{str:"auto",noWrapWidth:!c,noSpaceIfEmpty:!0}),(0,r.toggleClass)(g,"empty",o<=0),"boolean"==typeof i&&(0,r.toggleClass)(g,"active",i),(0,r.attr)(l[p],"data-count",o),(0,m.updateAriaLabelCounter)(g,o,t),c)null==g||null===(f=g.closest)||void 0===f||null===(w=f.call(g,".like_views"))||void 0===w||w.setAttribute("title",n||"");var S=l[p].tt;if(S){var C=(0,r.domByClass)(S.container,"_content"),N=(0,r.domByClass)(S.container,"_value"),x=(0,r.domByClass)(S.container,"_title"),b=(0,d.intval)((0,r.val)(N));(0,r.val)(N,o),n&&(0,r.val)(x,n),(0,d.isObject)(S)&&(S.likeInvalidated=!0),(b!==o&&b<7||!1===n)&&(t===h.LikeButtonTypes.like?g.needReinitLikesTT=!0:t===h.LikeButtonTypes.share&&(g.needReinitShareTT=!0)),t===h.LikeButtonTypes.like&&(0,r.toggleClass)(C,"me_hidden",!i),!1===n&&S.destroy&&S.destroy()}}}}},_getButtonsByType:(e,t)=>(0,r.domQuery)(`._like_${e} ._${t}, ._like_${e} [data-like-button-type="${t}"]`),showLikes(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&e instanceof HTMLElement&&!e.postDontShowLikes&&(!vk.widget||!vk.show_external_auth_box)){var i=o.views?{views:1}:o.share?{published:1}:{};o.listId&&(i.list=o.listId),o.like_hash&&(i.like_hash=o.like_hash),o.like_stats_params&&Object.assign(i,o.like_stats_params);var s=!!(0,r.geByClass1)("share",(0,r.gpeByClass)("like_wrap",e)),l=document.body,c=!1,u=getComputedStyle(e),h=(0,d.intval)(u.getPropertyValue("padding-left").replace("px","")),_=(0,d.intval)(u.getPropertyValue("padding-top").replace("px","")),p=(0,v.getElementLikeButtonIcon)(e),g=40;"wpost"===o.from&&(g=24);var f,m,w=[g-(0,r.getSize)(p)[0]/2-h,10-_],S=o.cl||"";if(o.share)S+="likes_tt_share";else if(S+="likes_tt_like","widget_community"===o.from)w[0]=6;else if("wcomments"===o.from||"widget_comments"===cur.wallType){w[0]=(0,r.getSize)(e)[0]+16-(0,r.getSize)(p)[0]/2-10}else"photo_carousel"===o.from&&(w[1]=10);if(!!(null==o?void 0:o.isFromReactionsPreview)){var C=e.querySelector("._ReactionsPreview__itemsContainer");if(C){var N=C.querySelector(".ReactionsPreviewItem"),x=(0,r.getXYRect)(N,!1),b=(x.width||0)/2,E=b;l=C,x.left+x.width/2>window.innerWidth/2&&(c=!0,E=C.offsetWidth-b),w[0]=-E+g}}o.share?(f="needReinitLikesTT",m="resetLikesTTTimer"):(f="needReinitShareTT",m="resetShareTTTimer"),clearTimeout(e[m]),(0,n.showTooltip)(e,{url:"/like.php",params:(0,a.extend)({act:"a_get_stats",object:t,has_share:s?1:""},i),appendEl:l,slide:15,shift:w,ajaxdt:o.fast?0:100,showdt:o.fast?0:400,hidedt:200,dir:"auto",checkLeft:!0,needLeft:c,reverseOffset:80,noZIndex:!0,hasover:!0,tip:{over:()=>{y.showLikes(e,t,o)}},typeClass:"like_tt",className:S,onHide:()=>{clearTimeout(e[m]),e[f]&&(e[m]=setTimeout((()=>{delete e[f],e.tt&&e.tt.destroy&&e.tt.destroy()}),200))}})}},showShare:function(e,t,o){y.showLikes(e,t,(0,a.extend)(o,{share:1}))},updateViews:(e,t)=>{vk.widget&&vk.show_external_auth_box||window.ajax.post("like.php",{act:"a_get_stats",object:e,views:1},{cache:1,onDone(t,o){var i=(0,r.ce)("div",{innerHTML:o});y._updateDom(e,h.LikeButtonTypes.views,t,void 0,i.innerText||i.textContent)}})},makeTemplate(e,t){if(!e)return"";(t=(0,a.extend)({buttons_prepend:"",object_raw:"",likes_count:"",liked:!1,share_count:"",shared:"",views_count:"",share_opts:{},like_opts:{},class_name:"",like_cont_class:"",like_class_name:"",[_.REACTIONS_COUNTS_RESPONSE_FIELD]:"",reactions_class_name:""},t)).like_active=t.liked?"active":"",t.share_active=t.shared?"active":"",t.comment_active="",t.likes_formatted_count=t.likes_count>0?(0,u.langNumeric)(t.likes_count,"%s",!0):"",t.share_formatted_count=t.share_count>0?(0,u.langNumeric)(t.share_count,"%s",!0):"",t.share_opts=this._convertOptsToString(t.share_opts),t.like_opts=this._convertOptsToString(t.like_opts),t.like_class_name+=t.likes_count>0?"":" empty",t.share_class_name=t.share_count>0?"":"empty";var o=t[_.REACTIONS_COUNTS_RESPONSE_FIELD],i=!!o&&Object.values(o).some((e=>!!e));return t.reactions_class_name+=i?"":" PostBottomAction--empty",(0,r.rs)(e,t)},_convertOptsToString:e=>JSON.stringify(e).replace(/\"/g,"'"),updateExternalIndex(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(0,v.parseLikeObjectId)(e),r=o.objectType,i=o.objectId;switch(r){case"photo":if(!cur.pvShown||!cur.pvCurPhoto||cur.pvCurPhoto.id!==i)return;var n=cur.pvListId,a=cur.pvIndex,s=cur.pvData[n][a];t.type===h.LikeButtonTypes.like?(s.likes=t.count,s.liked=t.isActive,cur.pvCommsLikes[s.id][1]=t.count):t.type===h.LikeButtonTypes.share&&(s.shares=t.count);break;case"video":if(window.mvcur&&window.mvcur.mvShown&&window.mvcur.videoRaw===i&&t.type===h.LikeButtonTypes.like){var l=window.Videoview.getMvData();l.likes=t.count,void 0!==t.isActive&&(l.liked=t.isActive,window.Videoview.playerOnLiked(t.isActive),window.Videoview.recache())}}},showLikesList(e,t){cur.viewAsBox||(0,r.hasClass)((0,r.gpeByClass)("like_btn",e),"no_counter")||(0,l.showWiki)({w:"likes/"+(0,a.clean)(t)},!1,!1,{queue:1})},showSharesList(e,t){cur.viewAsBox||(0,r.hasClass)((0,r.gpeByClass)("like_btn",e),"no_counter")||(0,l.showWiki)({w:"shares/"+(0,a.clean)(t)},!1,!1,{queue:1})}}},620145:(e,t,o)=>{"use strict";o.d(t,{drawRoundedImage:()=>i,roundRect:()=>n,getCoverSize:()=>a,getCroppedImage:()=>s});o(570655);var r=o(961540),i=function(e,t,o,r,i,n,a,s,l,d,c){var u=s||r,v=l||i,h=d||n||t.naturalWidth,_=c||a||t.naturalHeight;e.beginPath(),e.arc(u+o,v+o,o,Math.PI,Math.PI+Math.PI/2),e.lineTo(u+h-o,v),e.arc(u+h-o,v+o,o,Math.PI+Math.PI/2,2*Math.PI),e.lineTo(u+h,v+_-o),e.arc(u+h-o,v+_-o,o,2*Math.PI,Math.PI/2),e.lineTo(u+o,v+_),e.arc(u+o,v+_-o,o,Math.PI/2,Math.PI),e.closePath(),e.save(),e.clip(),e.drawImage(t,r,i,n,a,s,l,d,c),e.restore()},n=function(e,t,o,r,i,n){var a={};if("number"==typeof n)a={tl:n,tr:n,br:n,bl:n};else{var s={tl:0,tr:0,br:0,bl:0};for(var l in s)a[l]=a[l]||s[l]}e.save(),e.beginPath(),e.moveTo(t+a.tl,o),e.lineTo(t+r-a.tr,o),e.quadraticCurveTo(t+r,o,t+r,o+a.tr),e.lineTo(t+r,o+i-a.br),e.quadraticCurveTo(t+r,o+i,t+r-a.br,o+i),e.lineTo(t+a.bl,o+i),e.quadraticCurveTo(t,o+i,t,o+i-a.bl),e.lineTo(t,o+a.tl),e.quadraticCurveTo(t,o,t+a.tl,o),e.closePath(),e.restore()},a=function(e,t,o,r,i,n){var a,s,l=e/t;return l>o/r?(a=r,s=r*l):(s=o,a=o/l),{width:s,height:a,offsetLeft:(o-s)*(i=void 0===i?.5:i),offsetTop:(r-a)*(n=void 0===n?.5:n)}};function s(e,t,o,i,n,a){return void 0===a&&(a=0),new Promise((function(s,l){("string"==typeof e?(0,r.loadImage)(e):Promise.resolve(e)).then((function(e){var d=document.createElement("canvas");d.width=90===a||270===a?e.naturalHeight:e.naturalWidth,d.height=90===a||270===a?e.naturalWidth:e.naturalHeight;var c=d.getContext("2d");if(c){c.fillStyle="#fff",c.fillRect(0,0,c.canvas.width,c.canvas.height),a?(c.translate(d.width/2,d.height/2),c.rotate(a*Math.PI/180),c.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2)):c.drawImage(e,0,0);var u=c.getImageData(t,o,i,n),v=document.createElement("canvas");v.width=i,v.height=n;var h=v.getContext("2d");if(h)return h.putImageData(u,0,0),(0,r.loadImage)(v.toDataURL("image/jpeg",1)).then(s).catch(l);s(e)}else s(e)})).catch(l)}))}},738046:(e,t,o)=>{"use strict";var r;o.d(t,{BatchOperationType:()=>r}),function(e){e.Add="add",e.Delete="delete"}(r||(r={}))},341319:(e,t,o)=>{"use strict";var r,i,n,a,s;o.d(t,{StoryType:()=>r,StoryEntryPoint:()=>i,StorySource:()=>n,StoryBlockType:()=>a,StoryListName:()=>s}),function(e){e.PHOTO="photo",e.VIDEO="video",e.LIVE="live"}(r||(r={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(i||(i={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar",e.MY_QUESTIONS="questions"}(n||(n={})),function(e){e.stories="stories",e.communityGroupedStories="community_grouped_stories",e.appGroupedStories="app_grouped_stories",e.discover="discover"}(a||(a={})),function(e){e.feed="feed",e.groups="groups",e.apps="apps",e.discover="discover"}(s||(s={}))},673023:(e,t,o)=>{"use strict";o.d(t,{UploadPhoto:()=>r.UploadPhoto});var r=o(647409)},569351:(e,t,o)=>{"use strict";var r,i,n;o.d(t,{UploadPhotoErrorCodes:()=>r,OwnerAvatarEditorPhotoTypes:()=>i,OwnerAvatarEditorMods:()=>n}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UPLOAD=1]="UPLOAD",e[e.NOT_ALLOWED_EXTENSION=2]="NOT_ALLOWED_EXTENSION",e[e.IMAGE_TOO_SMALL=3]="IMAGE_TOO_SMALL",e[e.IMAGE_TOO_BIG=4]="IMAGE_TOO_BIG",e[e.BAD_ASPECT_RATIO=5]="BAD_ASPECT_RATIO"}(r||(r={})),function(e){e.UPLOADED="uploaded",e.EXISTED="existed"}(i||(i={})),function(e){e[e.UPLOAD=1]="UPLOAD",e[e.SELECT=2]="SELECT",e[e.EDIT=3]="EDIT"}(n||(n={}))},647409:(e,t,o)=>{"use strict";o.d(t,{UploadPhoto:()=>a});var r=o(570655),i=o(569351),n=o(746512),a=function(){function e(e,t){this.config=(0,r.__assign)({allowedTypes:["*"]},e),this.progressCallback=t}return e.prototype.validate=function(e){var t=this.config,o=t.constraints,a=t.allowedTypes,s=t.lang,l=!1;return a&&(l=a.some((function(t){return"*"===t||t===e.type}))),l?o?(0,n.getImageSizeByBlob)(e).then((function(e){var t=o.maxWidth,n=o.minWidth,a=o.maxHeight,l=o.minHeight,d=o.maxAspectRatio,c=o.minAspectRatio,u=(0,r.__read)(e,2),v=u[0],h=u[1],_=v/h;if(v>t||h>a){var p=(s["error_"+i.UploadPhotoErrorCodes.IMAGE_TOO_BIG]||"").replace("{width}",String(t)).replace("{height}",String(a));return Promise.reject({code:i.UploadPhotoErrorCodes.IMAGE_TOO_BIG,text:p})}if(v<n||h<l){p=(s["error_"+i.UploadPhotoErrorCodes.IMAGE_TOO_SMALL]||"").replace("{width}",String(n)).replace("{height}",String(l));return Promise.reject({code:i.UploadPhotoErrorCodes.IMAGE_TOO_SMALL,text:p})}return c&&c>_||d&&_>d?Promise.reject({code:i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO,text:s["error_"+i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO]}):Promise.resolve(null)})).catch((function(e){return e&&e.text&&e.code?Promise.reject(e):Promise.reject({code:i.UploadPhotoErrorCodes.UNKNOWN,text:s["error_"+i.UploadPhotoErrorCodes.UNKNOWN]})})):Promise.resolve(null):Promise.reject({code:i.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION,text:s["error_"+i.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION]})},e.prototype.upload=function(e,t,o){var r=this;return void 0===o&&(o="file1"),this.validate(e).then((function(){return new Promise((function(n,a){var s=new XMLHttpRequest,l=new FormData;l.append(o,e),s.open("POST",t||r.config.url,!0),s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE&&200===s.status){var e=void 0;try{s.responseText&&(e=JSON.parse(s.responseText))}catch(e){a({code:i.UploadPhotoErrorCodes.UNKNOWN,text:r.config.lang["error_"+i.UploadPhotoErrorCodes.UNKNOWN]})}n(e)}},s.onerror=function(){a({code:i.UploadPhotoErrorCodes.UPLOAD,text:r.config.lang["error_"+i.UploadPhotoErrorCodes.UPLOAD]})},s.upload.onprogress=function(e){r.progressCallback&&r.progressCallback(e.loaded,e.total)},s.send(l)}))}))},e}()},746512:(e,t,o)=>{"use strict";function r(e){return t=URL.createObjectURL(e),new Promise((function(e,o){var r=new Image;r.onload=function(){var t=Number(r.height),o=Number(r.width);e([o,t])},r.onerror=function(){o()},r.onabort=function(){o()},r.src=t}));var t}o.d(t,{getImageSizeByBlob:()=>r})},41929:(e,t,o)=>{"use strict";o.d(t,{BoxModal:()=>l});var r=o(570655),i=o(785893),n=o(667294),a=o(483295),s=o(161650),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,o=e.appearance,n=e.title,l=e.actionButtons,d=e.onClose,c=e.children,u=e.hint,v=e.hasScroll;return(0,i.jsx)("div",(0,r.__assign)({className:"BoxModal"},{children:(0,i.jsxs)("div",(0,r.__assign)({className:(0,a.classNames)("Modal","Modal--"+o,t)},{children:[(0,i.jsx)(s.default.Header,{title:n,onClose:d},void 0),Boolean(c)&&(0,i.jsx)(s.default.Body,(0,r.__assign)({hasScroll:v},{children:c}),void 0),Boolean(l)&&(0,i.jsx)(s.default.Footer,{actionButtons:l,hint:u},void 0)]}),void 0)}),void 0)},t.defaultProps={appearance:"white",hasScroll:!0},t}(n.Component)},465864:(e,t,o)=>{"use strict";o.d(t,{parseLikeObjectId:()=>i,likePostObjectId:()=>n,likeReplyObjectId:()=>a,getElementLikeButtonCount:()=>s,getElementLikeButtonIcon:()=>l,getElementLikeButtonLabel:()=>d});var r=o(570655);function i(e){var t=e.match(/^([a-z_]+)([0-9\-_]+)$/);if(!t)return null;var o=(0,r.__read)(t,3);return{objectType:o[1],objectId:o[2]}}var n=function(e){return"wall"+e},a=function(e){return"wall_reply"+e},s=function(e){var t;return null!==(t=null==e?void 0:e.querySelector(".like_button_count, ._like_button_count"))&&void 0!==t?t:void 0},l=function(e){var t;return null!==(t=null==e?void 0:e.querySelector(".like_button_icon, ._like_button_icon"))&&void 0!==t?t:void 0},d=function(e){var t;return null!==(t=e.querySelector(".like_button_label, ._like_button_label"))&&void 0!==t?t:void 0}},325698:(e,t,o)=>{"use strict";o.d(t,{LikeButtonTypes:()=>r});var r={like:"like",share:"share",views:"views",comment:"comment"}},560717:(e,t,o)=>{"use strict";o.d(t,{highlightModule:()=>d});var r,i,n=o(601261),a=o(635429),s=o(803834),l=o(315544);function d(e){var t,o=document.getElementById(e.module);if(o&&o.classList.contains("module")){window.cur.__narrowBarForceNotFixed=!0;var d=e.speed?e.speed:300;(0,s.scrollToY)((0,l.getXY)(o)[1]-100,d);var c=function(){r&&(r.hideTT(),(0,s.enableBodyScroll)(),delete window.cur.__narrowBarForceNotFixed,(0,a.updateNarrow)(),e.onClose&&e.onClose())};(r=new n.default(o,e.text,{highlight:!0,width:250,offset:[0,-17],side:"bottom",withCloseButton:!0,onBGClick:c,onCloseButtonClick:c})).show(),(0,s.disableBodyScroll)(),e.autoCancelDelay&&(i=setTimeout((function(){c(),i=null}),e.autoCancelDelay),null===(t=window.cur.destroy)||void 0===t||t.push((function(){i&&clearTimeout(i)})))}}},856901:(e,t,o)=>{"use strict";o.d(t,{PROFILE_MEDIA_NARROW_BLOCK_ID:()=>r});var r="profile_media_narrow_block"},908706:(e,t,o)=>{"use strict";o.d(t,{isVariantInActionStatusBar:()=>i,isVariantHidden:()=>n,previewVisibilityUseCurrent:()=>a,isIntentPreviewInActionStatusBar:()=>s,isIntentPreviewHidden:()=>l,isIntentPreviewUseCurrent:()=>d,previewVisibilityIntentForVariant:()=>c,parsePreviewVariant:()=>u});var r=o(404608),i=function(e){return e===r.PreviewVariantActionStatusBar},n=function(e){return e===r.PreviewVariantHidden},a={kind:"useCurrent"},s=function(e){return e.kind===r.PreviewVariantActionStatusBar},l=function(e){return e.kind===r.PreviewVariantHidden},d=function(e){return"useCurrent"===e.kind},c=function(e){return e?{kind:e}:a},u=function(e){return r.PreviewVariants.includes(e)?e:void 0}},404608:(e,t,o)=>{"use strict";o.d(t,{PreviewVariantActionStatusBar:()=>r,PreviewVariantHidden:()=>i,PreviewVariants:()=>n});var r="action_status_bar",i="hidden",n=[r,i]},95146:(e,t,o)=>{"use strict";o.d(t,{SUPPORTED_OBJECT_TYPES:()=>r,SIZE_32:()=>i,SIZE_40:()=>n,SIZE_96:()=>a,SIZE_128:()=>s,REACTIONS_COUNTS_RESPONSE_FIELD:()=>l,WK_SECTION_PREFIX_REACTIONS:()=>d});var r={wall:"wall",wall_reply:"wall_reply"},i={width:32,height:32},n={width:40,height:40},a={width:96,height:96},s={width:128,height:128},l="reactions_counts",d="reactions"},665872:(e,t,o)=>{"use strict";o.d(t,{reactionsCountsUpdatePayload:()=>n,isReactionsFullUpdatePayload:()=>a,reactionsCountsOnlyUpdatePayload:()=>s});var r=o(570655),i=o(571904),n=function(e,t){return(0,r.__assign)((0,r.__assign)({kind:i.PayloadKindFull},e),{reactionIdState:{reactionId:t.id}})},a=function(e){return e.kind===i.PayloadKindFull},s=function(e){return(0,r.__assign)({kind:i.PayloadKindCountsOnly},e)}},571904:(e,t,o)=>{"use strict";o.d(t,{PayloadKindCountsOnly:()=>r,PayloadKindFull:()=>i});var r="counts_only",i="counts_with_current_reaction"},107337:(e,t,o)=>{"use strict";o.d(t,{triggerReactionsUpdate:()=>s});var r=o(465864),i=o(95146),n=o(453580),a=o(665872),s=function(e,t,o,s){var l=(0,r.parseLikeObjectId)(e);l&&l.objectType===i.SUPPORTED_OBJECT_TYPES.wall&&l.objectId?(0,n.emitEvent)(n.WallDataEvents.post_reactions_counts_update,function(e,t,o,r){var i={counts:e,isFromWkLayer:null==t?void 0:t.isFromWkLayer,isPrimaryLikeButtonClick:null==t?void 0:t.isPrimaryLikeButtonClick,isQueueUpdate:null==t?void 0:t.isQueueUpdate,isUserAction:t.isUserAction,postFullId:o.objectId,previewVisibility:t.previewVisibility,reactionIdState:r?{reactionId:r.id}:void 0};return r?(0,a.reactionsCountsUpdatePayload)(i,r):(0,a.reactionsCountsOnlyUpdatePayload)(i)}(t,s,l,o)):l&&l.objectType===i.SUPPORTED_OBJECT_TYPES.wall_reply&&l.objectId?(0,n.emitEvent)(n.WallDataEvents.reply_reactions_counts_update,{counts:t,replyFullId:l.objectId,reactionIdState:o?{reactionId:o.id}:void 0}):console.warn("Unsupported reactions object update",e)}},814200:(e,t,o)=>{"use strict";o.d(t,{default:()=>d});var r=o(40906),i=o(241926),n=o(652745),a=o(849464),s=o(47612),l=o(125696);const d=function(){function e(){var e=this;this.destroy=function(){e.gallery&&e.gallery.destroy()},this.moduleEl=document.querySelector(".narratives_module"),this.isWide=this.moduleIsWide(this.moduleEl),this.initGallery(),this.needOnBoard()&&this.showOnboardTooltipIfNeeded(),window.cur.destroy&&window.cur.destroy.push((function(){e.destroy()}))}return e.prototype.initGallery=function(){if(this.isWide&&(this.galleryEl=document.querySelector(".NarrativeBlock"),this.galleryEl)){var e=this.galleryEl.querySelectorAll(".ui_gallery_item"),t={scrollY:!1};(!e||e.length<7)&&(t.scrollX=!1),this.gallery=new s.UIGallery(this.galleryEl,t)}},e.prototype.moduleIsWide=function(e){if(e){var t=e.getAttribute("data-is-wide");return!!(0,r.intval)(t)}return!1},e.prototype.getOnboardHash=function(){var e;return null===(e=this.moduleEl)||void 0===e?void 0:e.dataset.onboardHash},e.prototype.openNarrativeBox=function(){var e=this.getOwnerId(),t=e>0?a.NarrativeAnalyticNavScreen.profile:a.NarrativeAnalyticNavScreen.club;this.showBox(),(0,a.sendNarrativeAnalytic)(a.NarrativeAnalyticEventType.openNarrativeList,{ownerId:e},t)},e.prototype.seeMore=function(){var e=this.getOwnerId(),t=e>0?a.NarrativeAnalyticNavScreen.profile:a.NarrativeAnalyticNavScreen.club;this.showBox(),(0,a.sendNarrativeAnalytic)(a.NarrativeAnalyticEventType.seeMore,{ownerId:e},t)},e.prototype.showBox=function(){var e=this.getOwnerId(),t={ownerId:e,onSave:function(){return(0,n.updateNarrativeBlock)()},onRemove:function(){return(0,n.updateNarrativeBlock)()},onReorder:function(){return(0,n.updateNarrativeBlock)()},navScreen:e>0?a.NarrativeAnalyticNavScreen.profile:a.NarrativeAnalyticNavScreen.club};(0,i.showNarrativeBox)(t)},e.prototype.showNarrativeEditorBox=function(){var e=this.getOwnerId(),t=e>0?a.NarrativeAnalyticNavScreen.profile:a.NarrativeAnalyticNavScreen.club;if((0,a.sendNarrativeAnalytic)(a.NarrativeAnalyticEventType.createNarrative,{ownerId:e},t),e<0)window.nav.go(location.pathname+"?act=narrative_create");else{var o={onSave:function(){return(0,n.updateNarrativeBlock)()},navScreen:t};(0,i.showNarrativeEditorBox)(e,o)}},e.prototype.getOwnerId=function(){return(0,r.intval)(window.cur.oid)},e.prototype.showOnboardTooltipIfNeeded=function(){var e=this.getOnboardHash();e&&(window.cur.storyLayer&&l.hideAllLayers(!0),window.boxQueue.hideAll(),(0,n.highlightNarrativeBlock)(e))},e.prototype.needOnBoard=function(){return Boolean(window.cur.needNarrativeOnboard)},e}()},115985:(e,t,o)=>{"use strict";o.d(t,{NarrativeBox:()=>k});var r=o(570655),i=o(785893),n=o(667294),a=o(41929),s=o(288420),l=o(41650),d=o(902119),c=o(709652),u=o(113165),v=o(385597),h=o(387142),_=o(439664),p=o(241926),g=o(486125),f=o(40906),m=o(664891),w=o(753449),y=o(850167),S=o(542041),C=o(109542),N=o(117173),x=o(281536),b=o(815653),E=o(849464),k=function(e){function t(t){var o=e.call(this,t)||this;return o.getBoxActionButtons=function(){var e=o.props,t=e.onClose,n=e.boxData,a=e.type,d=[(0,i.jsx)(s.default,(0,r.__assign)({appearance:"primary",onClick:function(){return t()}},{children:(0,l.getLang)("global_close")}),"close")];if(a===c.BoxType.edit&&n.userId===n.ownerId){var u=n.ownerDomain||"id"+n.userId;d.unshift((0,i.jsx)(m.default,(0,r.__assign)({href:u+"?w=stories",onClick:function(){t(),(0,y.showWiki)({w:"stories"})},className:"NarrativeBox__additionalFooterButton"},{children:(0,l.getLang)("stories_archive")}),"archive"))}return d},o.onNarrativeClick=function(e,t){if(!e.ctrlKey&&!e.metaKey){e.preventDefault(),e.stopPropagation();var r=o.props.list?o.props.list:"narrative"+t.ownerId+"_"+t.id;(0,u.showNarrative)(t.ownerId,t.id,0,r,{trackCode:o.props.trackCode,source:o.props.source})}},o.onCreateNarrativeClick=function(){var e=o.props,t=e.boxData,r=e.navScreen,i=t.ownerId;if((0,E.sendNarrativeAnalytic)(E.NarrativeAnalyticEventType.createNarrative,{ownerId:i},r),i>0)o.openNarrativeEditorBox();else{var n=t.ownerDomain?t.ownerDomain:"club"+-i;window.open("https://"+location.hostname+"/"+n+"?act=narrative_create")}},o.openNarrativeEditorBox=function(e){var t=o.props,i=t.onSave,n=t.boxData,a=t.onClose,s=t.navScreen;if(i){var l=[];(null==e?void 0:e.stories.length)&&(l=(0,r.__spreadArray)([],(0,r.__read)(e.stories),!1));var d={narrative:e,selectedStories:l,publishHash:n.publishHash,onSave:function(e){i(e),a()},navScreen:s};(0,p.showNarrativeEditorBox)(n.ownerId,d)}},o.getNarrativeItemActions=function(e){var t=[];if(o.canEdit())t.push({text:(0,l.getLang)("global_edit"),onClick:function(){return o.editNarrative(e)}}),t.push({text:(0,l.getLang)("stories_share"),onClick:function(){return o.shareNarrative(e)}}),t.push({separator:!0}),t.push({text:(0,l.getLang)("global_delete"),onClick:function(){return o.removeNarrative(e)}});else{var r=e.isBookmarked?(0,l.getLang)("global_remove_from_bookmarks"):(0,l.getLang)("global_add_to_bookmarks");t.push({text:r,onClick:function(){return o.bookmarkNarrative(e)}}),t.push({text:(0,l.getLang)("stories_share"),onClick:function(){return o.shareNarrative(e)}})}return t},o.state={isLoad:!1,draggingNarrativeRawId:""},o.scrollContainerRef=(0,n.createRef)(),o.gridRef=(0,n.createRef)(),o.sentinelRef=(0,n.createRef)(),o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.narratives,s=t.onClose,l=t.boxData,d=this.state,c=d.isLoad,u=d.draggingNarrativeRawId,h=o.length<l.count,p=this.canEdit();return(0,i.jsx)(a.BoxModal,(0,r.__assign)({className:"NarrativeBox",title:this.getTitle(),actionButtons:this.getBoxActionButtons(),onClose:s,hasScroll:!1},{children:(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeBox__scrollContainer",ref:this.scrollContainerRef},{children:(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeBox__scrollInner"},{children:[(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeBox__list",ref:this.gridRef},{children:[p&&(0,i.jsxs)(n.Fragment,{children:[(0,i.jsx)(v.NarrativeRowCreation,{onClick:this.onCreateNarrativeClick},"create"),o.map((function(t){return(0,i.jsx)(C.NarrativeRow,{className:N.BOX_ITEM_DRAGGABLE_CLASS,narrative:t,onClick:function(o){return e.onNarrativeClick(o,t)},aside:(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeBox__aside"},{children:[t.rawId===u&&(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,i.jsx)(x.default,{},void 0)}),void 0),t.rawId!==u&&(0,i.jsx)(w.default,(0,r.__assign)({position:"b",align:"center",trigger:"hover",data:e.getNarrativeItemActions(t)},{children:(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,i.jsx)(x.default,{},void 0)}),void 0)}),void 0),(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeBox__action NarrativeBox__action--burger"},{children:(0,i.jsx)(b.default,{},void 0)}),void 0)]}),void 0)},t.rawId)}))]},void 0),!p&&(0,i.jsx)(n.Fragment,{children:o.map((function(t){return(0,i.jsx)(C.NarrativeRow,{narrative:t,onClick:function(o){return e.onNarrativeClick(o,t)},aside:(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeBox__aside"},{children:(0,i.jsx)(w.default,(0,r.__assign)({position:"b",align:"right",trigger:"hover",data:e.getNarrativeItemActions(t)},{children:(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,i.jsx)(x.default,{},void 0)}),void 0)}),void 0)}),void 0)},t.rawId)}))},void 0)]}),void 0),c&&(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeBox__loader"},{children:(0,i.jsx)(_.default,{},void 0)}),"loader"),h&&(0,i.jsx)("div",{className:"NarrativeBox__sentinel",ref:this.sentinelRef},void 0)]}),void 0)}),void 0)}),void 0)},t.prototype.canEdit=function(){var e=this.props,t=e.type,o=e.onSave,r=e.onReorder,i=e.onRemove;return t===c.BoxType.edit&&Boolean(o)&&Boolean(r)&&Boolean(i)},t.prototype.componentDidMount=function(){this.initSorter(),this.observeNarrativeScrollIfNeeded()},t.prototype.componentWillUnmount=function(){this.deInitSorter(),this.unObserveNarrativeScrollIfNeeded()},t.prototype.editNarrative=function(e){var t=this.props.boxData;(0,E.sendNarrativeAnalytic)(E.NarrativeAnalyticEventType.clickToEditNarrative,e,this.props.navScreen),t.ownerId>0?this.openNarrativeEditorBox(e):window.open("https://"+location.hostname+location.pathname+"?act=narrative_edit&nid="+e.id)},t.prototype.shareNarrative=function(e){S.Likes.share("narrative"+e.rawId),(0,E.sendNarrativeAnalytic)(E.NarrativeAnalyticEventType.shareNarrative,e,this.props.navScreen)},t.prototype.bookmarkNarrative=function(e){var t=this.props.onBookmark;(0,y.bookmark)(e.ownerId,e.id,"narrative",e.bookmarkHash,e.isBookmarked),(0,E.sendNarrativeAnalytic)(E.NarrativeAnalyticEventType.addToBookmarks,e,this.props.navScreen),t(e)},t.prototype.removeNarrative=function(e){var t,o;null===(o=(t=this.props).onRemove)||void 0===o||o.call(t,e)},t.prototype.observeNarrativeScrollIfNeeded=function(){var e=this,t=this.props,o=t.narratives,r=t.boxData;if(o.length<r.count){var i=this.scrollContainerRef.current,n=this.sentinelRef.current;if(!n)return;this.observer=new IntersectionObserver((function(t){t.forEach((function(t){t.intersectionRatio>0&&e.loadViewers()}))}),{threshold:[0],root:i,rootMargin:"0px 0px 480px 0px"}),this.observer.observe(n)}},t.prototype.unObserveNarrativeScrollIfNeeded=function(){this.observer&&this.observer.disconnect()},t.prototype.loadViewers=function(){var e=this,t=this.props.loadMore;this.state.isLoad||(this.setState({isLoad:!0}),t().finally((function(){e.setState({isLoad:!1})})))},t.prototype.initSorter=function(){var e,t,o=this,r=this.props.boxData;if(this.canEdit()){var i=null===(e=this.scrollContainerRef)||void 0===e?void 0:e.current,n=null===(t=this.gridRef)||void 0===t?void 0:t.current;if(n&&i){var a={dragThreshold:0,wrapNode:i,onDragFinish:function(){o.setState({draggingNarrativeRawId:""})},onDragStart:function(e){var t=o.getNarrativeIdByEl(e);o.setState({draggingNarrativeRawId:r.ownerId+"_"+t})},onReorder:function(e){var t=o.getNarrativeIdByEl(e),r=Array.from(n.querySelectorAll("."+N.BOX_ITEM_DRAGGABLE_CLASS));if(1!==r.length){var i=0,a=0,s=r.findIndex((function(e){return o.getNarrativeIdByEl(e)===t}));r[s-1]&&(i=o.getNarrativeIdByEl(r[s-1])),r[s+1]&&(a=o.getNarrativeIdByEl(r[s+1])),o.saveReorder(t,a,i)}}};this.sorter=new h.default(n,"",a)}}},t.prototype.saveReorder=function(e,t,o){var r=this,i=this.props,n=i.boxData,a=i.onReorder;if(a){var s=n.ownerId;window.ajax.post("al_stories.php",{act:"narratives_reorder",narrative_id:e,before_narrative_id:t,after_narrative_id:o,hash:n.reorderHash,owner_id:s},{onDone:function(){var t,o=r.props.narratives,i=null===(t=r.gridRef)||void 0===t?void 0:t.current;if(i){var n=Array.from(i.querySelectorAll("."+N.BOX_ITEM_DRAGGABLE_CLASS)),l=[];n.forEach((function(e){var t=r.getNarrativeIdByEl(e),i=o.find((function(e){return e.id===t}));i&&l.push(i)})),(0,E.sendNarrativeAnalytic)(E.NarrativeAnalyticEventType.changeSort,{ownerId:s,id:e},r.props.navScreen),a(l)}},onFail:function(e){return(0,g.showDoneBox)(e||(0,l.getLang)("global_error")),!0}})}},t.prototype.getNarrativeIdByEl=function(e){return(0,f.intval)(e.getAttribute("data-id"))},t.prototype.getTitle=function(){var e=this.props,t=e.title,o=e.boxData,r=e.showNarrativeNumber;return(0,i.jsx)(d.NarrativeBoxTitle,{title:t||(0,l.getLang)("stories_narratives_title"),count:o.count,showNarrativeNumber:r},void 0)},t.prototype.deInitSorter=function(){this.sorter&&this.sorter.destroy()},t.defaultProps={type:c.BoxType.view,showNarrativeNumber:!0},t}(n.Component)},709652:(e,t,o)=>{"use strict";var r;o.d(t,{BoxType:()=>r}),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(r||(r={}))},902119:(e,t,o)=>{"use strict";o.d(t,{NarrativeBoxTitle:()=>n});var r=o(570655),i=o(785893),n=function(e){var t=e.title,o=e.count,n=void 0===o?0:o,a=e.showNarrativeNumber,s=void 0===a||a;return(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeBoxTitle"},{children:[t,s&&n>0&&(0,i.jsx)("span",(0,r.__assign)({className:"NarrativeBoxTitle__count"},{children:n}),void 0)]}),void 0)}},231454:(e,t,o)=>{"use strict";o.d(t,{NarrativeChooseBox:()=>w});var r=o(570655),i=o(785893),n=o(667294),a=o(41929),s=o(288420),l=o(41650),d=o(118690),c=o(483295),u=o(423985),v=o(385597),h=o(109542),_=o(486125),p=o(241926),g=o(113165),f=o(738046),m=o(849464),w=function(e){function t(t){var o=e.call(this,t)||this;return o.loadMore=function(){var e=o.props,t=e.loadMore,i=e.story,n=o.state.selectedNarrativeIds;return t().then((function(e){void 0===e&&(e=[]),o.setState({selectedNarrativeIds:(0,r.__assign)((0,r.__assign)({},n),o.getSelectedNarrativeIdsMap(i.id,e))})}))},o.onCheckboxClick=function(e){var t=o.state.selectedNarrativeIds,i=(0,r.__assign)({},t);i[e.id]?delete i[e.id]:i[e.id]=!0,o.setState({selectedNarrativeIds:i})},o.getBoxActionButtons=function(){var e=o.props,t=e.onClose,n=e.story,a=e.narratives,c=o.state,u=c.isLoad,v=c.selectedNarrativeIds,h=o.getSelectedNarrativeIdsMap(n.id,a),_=o.getDiffOperations(n.id,v,h);return[(0,i.jsx)(s.default,(0,r.__assign)({appearance:"tertiary",onClick:function(){return t()}},{children:(0,l.getLang)("global_close")}),"close"),(0,i.jsx)(d.default,(0,r.__assign)({appearance:"primary",disabled:!_.length,onClick:o.save,loading:u},{children:(0,l.getLang)("global_save")}),"save")]},o.save=function(){var e=o.props,t=e.story,r=e.narratives,i=e.boxData,n=e.onClose,a=e.onSave,s=e.navScreen,d=o.state.selectedNarrativeIds,c=o.getSelectedNarrativeIdsMap(t.id,r),u=o.getDiffOperations(t.id,d,c),v=Boolean(Object.keys(d).length),h=i.ownerId;o.setState({isLoad:!0}),window.ajax.post("al_stories.php",{act:"batch_edit",owner_id:h,operations:JSON.stringify(u),hash:i.editHash},{onDone:function(){a(v),n(),(0,m.sendNarrativeAnalytic)(m.NarrativeAnalyticEventType.addStoryToNarrative,{ownerId:h},s),(0,_.showDoneBox)(o.getDoneText(u))},onFail:function(e){return(0,_.showDoneBox)(e||(0,l.getLang)("global_error")),!0},hideProgress:function(){o.setState({isLoad:!1})}})},o.onCreateNarrativeClick=function(){var e=o.props,t=e.story,r=e.narratives,i=e.onSave,n=e.onClose,a=e.boxData,s=e.navScreen,l=a.ownerId;if(l>0){var d=o.getSelectedNarrativeIdsMap(t.id,r),c=Boolean(Object.keys(d).length),u={selectedStories:[t],onSave:function(){c=!0},onClose:function(){i(c),n()},navScreen:s};return(0,p.showNarrativeEditorBox)(l,u),void(0,m.sendNarrativeAnalytic)(m.NarrativeAnalyticEventType.createNarrative,{ownerId:l},s)}var v=a.ownerDomain?a.ownerDomain:"club"+-a.ownerId;window.nav.go(v+"?act=narrative_create&story_id="+t.id)},o.onNarrativeClick=function(e,t){e.ctrlKey||e.metaKey||((0,g.showNarrative)(t.ownerId,t.id,0,"narrative"+t.ownerId+"_"+t.id),e.preventDefault(),e.stopPropagation())},o.state={isLoad:!1,selectedNarrativeIds:o.getSelectedNarrativeIdsMap(t.story.id,t.narratives)},o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.onClose,n=t.narratives,s=t.boxData,d=this.state.selectedNarrativeIds,_=n.length<s.count;return(0,i.jsx)(a.BoxModal,(0,r.__assign)({className:"NarrativeChooseBox",title:(0,l.getLang)("stories_narrative_choosing"),actionButtons:this.getBoxActionButtons(),onClose:o,hasScroll:!1,appearance:"blue"},{children:(0,i.jsxs)(u.default,(0,r.__assign)({className:"NarrativeChooseBox__list",itemHeight:80,loadMore:this.loadMore,hasMore:_},{children:[(0,i.jsx)(v.NarrativeRowCreation,{onClick:this.onCreateNarrativeClick,clickable:!0,size:50},"create"),n.map((function(t){return(0,i.jsx)(h.NarrativeRow,{narrative:t,onClick:function(){return e.onCheckboxClick(t)},size:50,noBorder:!0,clickable:!0,aside:(0,i.jsx)("div",{className:(0,c.classNames)("NarrativeChooseBox__checkbox",{"NarrativeChooseBox__checkbox--checked":d[t.id]})},void 0)},t.rawId)}))]}),void 0)}),void 0)},t.prototype.getDoneText=function(e){var t=e.filter((function(e){return e.op===f.BatchOperationType.Add})).length;if(t>1)return(0,l.getLang)("stories_saved_in_narratives_text");if(1===t)return(0,l.getLang)("stories_saved_in_narrative_text");var o=e.filter((function(e){return e.op===f.BatchOperationType.Delete})).length;return o>1?(0,l.getLang)("stories_deleted_in_narratives_text"):1===o?(0,l.getLang)("stories_deleted_in_narrative_text"):(0,l.getLang)("stories_settings_saved")},t.prototype.getDiffOperations=function(e,t,o){var r=[];return Object.keys(t).forEach((function(t){o[t]||r.push({op:f.BatchOperationType.Add,story_id:e,narrative_id:Number(t)})})),Object.keys(o).forEach((function(o){t[o]||r.push({op:f.BatchOperationType.Delete,story_id:e,narrative_id:Number(o)})})),r},t.prototype.getSelectedNarrativeIdsMap=function(e,t){return t.reduce((function(t,o){return o.stories.find((function(t){return t.id===e}))&&(t[o.id]=!0),t}),{})},t}(n.Component)},833623:(e,t,o)=>{"use strict";o.d(t,{MAX_THUMB_HEIGHT:()=>_,MAX_THUMB_WIDTH:()=>p,NarrativeCoverCropper:()=>g});var r=o(570655),i=o(785893),n=o(667294),a=o(41929),s=o(288420),l=o(41650),d=o(343390),c=o(654612),u=o(66433),v=o(118690),h=o(620145),_=604,p=468,g=function(e){function t(t){var o=e.call(this,t)||this;return o.onSaveCrop=function(){var e=o.props,t=e.onSave,r=e.onClose,i=e.coverUrl,n=o.crop;n&&(o.setState({isLoading:!0}),(0,h.getCroppedImage)(i,n.left,n.top,n.width,n.height).then((function(e){return t(o.getCropForSaving(n),e.src)})).then(r).catch((function(e){o.setState({isLoading:!1}),(0,c.showFastBox)((0,l.getLang)("global_error"),e||(0,l.getLang)("global_unknown_error")),console.error(e),(0,u.logError)(new Error("error with onSaveCrop"+(e?": "+e:"")))})))},o.onCropUpdate=function(e){o.crop=e},o.state={isLoading:!1},o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,o=e.coverUrl,n=e.coverHeight,c=e.coverWidth,u=e.thumbHeight,h=e.thumbWidth,_=e.crop,p=this.state.isLoading;return(0,i.jsx)(a.BoxModal,(0,r.__assign)({className:"NarrativeCoverCropper",appearance:"white",title:(0,l.getLang)("stories_cover_cropper_title"),onClose:t,hasScroll:!1},{children:(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeCoverCropper__inner"},{children:[(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeCoverCropper__info"},{children:[(0,i.jsx)("div",{children:(0,l.getLang)("stories_cover_cropper_info_1")},void 0),(0,i.jsx)("div",{children:(0,l.getLang)("stories_cover_cropper_info_2")},void 0)]}),void 0),(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeCoverCropper__frame"},{children:(0,i.jsx)(d.PhotoAreaSelector,{className:"NarrativeCoverCropper__tagger",imgSrc:o,imgHeight:n,imgWidth:c,previewHeight:u,previewWidth:h,minHeight:75,minWidth:75,isSquare:!0,preview100:!0,cropRect:this.getCropForTagger(_),onCropUpdated:this.onCropUpdate},void 0)}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeCoverCropper__footer"},{children:[(0,i.jsx)(v.default,(0,r.__assign)({loading:p,onClick:this.onSaveCrop},{children:(0,l.getLang)("stories_cover_next")}),void 0),(0,i.jsx)(s.default,(0,r.__assign)({disabled:p,appearance:"secondary",onClick:t},{children:(0,l.getLang)("stories_cover_back")}),void 0)]}),void 0)]}),void 0)}),void 0)},t.prototype.getCropForTagger=function(e){var t,o=this.props,r=o.coverWidth,i=o.coverHeight;if(e){var n=Math.round(e.width*r),a=Math.round(e.height*i);if(Math.abs(a-n)>1)return t;a=n,t={top:Math.round(e.y*i),left:Math.round(e.x*r),width:n,height:a}}return t},t.prototype.getCropForSaving=function(e){var t=this.props,o=t.coverWidth,r=t.coverHeight;return{y:e.top/r,x:e.left/o,width:e.width/o,height:e.height/r}},t}(n.Component)},884215:(e,t,o)=>{"use strict";o.d(t,{NarrativeCreateLiteBox:()=>_});var r=o(570655),i=o(785893),n=o(667294),a=o(41650),s=o(118690),l=o(41929),d=o(695724),c=o(117173),u=o(349062),v=o(551907),h=o(386409),_=function(e){function t(t){var o=e.call(this,t)||this;return o.onNameChange=function(e){var t=e.target.value,r=(0,d.trim)(t)?t:"";o.setState({name:r})},o.getBoxActionButtons=function(){var e=o.state.isLoad;return[(0,i.jsx)(s.default,(0,r.__assign)({appearance:"primary",onClick:o.save,loading:e},{children:(0,a.getLang)("groups_edit_narrative_publish")}),"publish")]},o.save=function(){var e=o.state.isLoad,t=o.state.name,r=void 0===t?"":t;e||((r=(0,d.trim)(r))?(o.setState({isLoad:!0}),o.props.onSave(r).catch((function(){o.setState({isLoad:!1})}))):(0,h.notaBene)(o.nameInputRef.current))},o.state={isLoad:!1,name:"",coverStory:t.stories[0]},o.nameInputRef=(0,n.createRef)(),o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,o=e.ownerName,n=e.stories,s=this.state,d=s.name,h=s.coverStory,_=null==h?void 0:h.preview;return(0,i.jsx)(l.BoxModal,(0,r.__assign)({className:"NarrativeCreateLiteBox",title:(0,a.getLang)("stories_creating_narrative"),actionButtons:this.getBoxActionButtons(),onClose:t,hasScroll:!1,appearance:"blue"},{children:(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__inner"},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__title"},{children:(0,a.getLang)("groups_edit_narrative_title")}),void 0),(0,i.jsx)("input",{type:"text",className:"NarrativeCreateLiteBox__nameInput",value:d,onChange:this.onNameChange,placeholder:(0,a.getLang)("stories_enter_name"),maxLength:c.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0},void 0),(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__title"},{children:(0,a.getLang)("groups_edit_narrative_preview")}),void 0),(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__text"},{children:(0,a.getLang)("groups_edit_narrative_pin_text")}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previews"},{children:[(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previewWrapper"},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previewTitle"},{children:(0,a.getLang)("stories_narrative_preview_block_title")}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__smallPreview"},{children:[(0,i.jsx)(u.NarrativeItemPreviewCover,{cover:_},void 0),(0,i.jsx)("span",(0,r.__assign)({className:"NarrativeCreateLiteBox__smallPreviewName"},{children:d||(0,a.getLang)("stories_narrative_name_full")}),void 0)]}),void 0)]}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previewWrapper NarrativeCreateLiteBox__previewWrapper--snippet"},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previewTitle"},{children:(0,a.getLang)("stories_narrative_preview_feed_title")}),void 0),(0,i.jsx)(v.NarrativeSnippet,{className:"NarrativeCreateLiteBox__snippet",ownerName:o,coverUrl:_,title:d,storyCount:n.length},void 0)]}),void 0)]}),void 0)]}),void 0)}),void 0)},t}(n.Component)},111898:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditor:()=>S});var r=o(570655),i=o(785893),n=o(667294),a=o(41650),s=o(887157),l=o(288420),d=o(386409),c=o(486125),u=o(118690),v=o(720516),h=o(956252),_=o(695724),p=o(41929),g=o(652745),f=o(495893),m=o(405101),w=o(849464),y=o(303562),S=function(e){function t(t){var o=e.call(this,t)||this;o.onSelectedStoriesUpdate=function(e){void 0===e&&(e=[]);var t=o.props.storyMap,r=o.state.cover,i=null==r?void 0:r.coverStoryId,n={selectedStoryIds:e};if((null==r?void 0:r.customPhotoId)||i&&e.includes(i))e.length||(n.cover=null);else{var a=e[0];e[0]?n.cover={url:t[a].preview,coverStoryId:a}:n.cover=null}o.setState(n)},o.openCoverSelection=function(){var e=o.state.cover;((null==e?void 0:e.coverStoryId)||(null==e?void 0:e.customPhotoId))&&o.setState({section:s.EditorSectionType.cover})},o.confirmCover=function(e){var t=o.state.cover;o.setState({cover:e||t,section:s.EditorSectionType.main})},o.onNameChange=function(e){var t=e.target.value,r=(0,_.trim)(t)?t:"";o.setState({name:r})},o.close=function(e,t){var i=o.props,n=i.ownerId,a=i.narrativeRawId,s=i.navScreen;if(!e){var l="";a&&(l=(0,r.__read)(a.split("_"),2)[1]),(0,w.sendNarrativeAnalytic)(w.NarrativeAnalyticEventType.close,{ownerId:n,id:Number(l)},s)}o.props.close(t)},o.onSave=function(e){o.props.onSave(e)},o.getFooterButtons=function(){var e=o.props.type,t=o.state,n=t.selectedStoryIds,d=t.loading;return[(0,i.jsx)(l.default,(0,r.__assign)({appearance:"tertiary",onClick:function(){return o.close(!1)},disabled:d},{children:(0,a.getLang)("global_cancel")}),"close"),(0,i.jsx)(u.default,(0,r.__assign)({loading:d,onClick:o.save,disabled:0===n.length},{children:e===s.EditorModeType.edit?(0,a.getLang)("global_save"):(0,a.getLang)("stories_create_narrative")}),"save")]},o.save=function(){var e=o.props,t=e.publishHash,i=e.editHash,n=e.type,l=e.navScreen,u=e.ownerId,v=o.state,h=v.cover,p=v.loading,f=o.getSelectedStories(),m=o.state.name,y=void 0===m?"":m,S=o.props.narrativeRawId;if(!p)if(y=(0,_.trim)(y)){if((null==h?void 0:h.coverStoryId)||(null==h?void 0:h.customPhotoId)){var C="publish_narrative",N=t;n===s.EditorModeType.edit&&(C="edit_narrative",N=i);var x={act:C,owner_id:u,title:y,hash:N,story_ids:(0,g.prepareStoriesForPublishing)(f)};if(S){var b=(0,r.__read)(S.split("_"),2)[1];x.narrative_id=b}h.customPhotoId&&(x.custom_cover_photo_id=h.customPhotoId),h.coverStoryId&&(x.cover_story_id=h.coverStoryId),h.crop&&(x.crop_y=h.crop.y,x.crop_x=h.crop.x,x.crop_height=h.crop.height,x.crop_width=h.crop.width),window.ajax.post("al_stories.php",x,{onDone:function(e){S||(S=u+"_"+e);var t=o.getPublishDoneHtml(S,y,n);o.onSave(S),o.close(!0,(function(){return(0,c.showDoneBox)(t)})),(0,w.sendNarrativeAnalytic)(n===s.EditorModeType.edit?w.NarrativeAnalyticEventType.editNarrative:w.NarrativeAnalyticEventType.publishNarrative,{ownerId:Number(u),id:Number(e)},l)},onFail:function(e){return(0,c.showDoneBox)(e||(0,a.getLang)("global_error")),!0},hideProgress:function(){o.setState({loading:!1})}}),o.setState({loading:!0})}}else o.dataPanelRef.current&&(0,d.notaBene)(o.dataPanelRef.current.getInputEl())};var v=t.cover,h=t.selectedStoryIds[0];return!v&&h&&(v={url:t.storyMap[h].preview,coverStoryId:h}),o.state={tabKey:t.activeTabKey,name:t.name,selectedStoryIds:t.selectedStoryIds,cover:v,loading:!1,section:s.EditorSectionType.main},o.dataPanelRef=(0,n.createRef)(),o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this;return this.props.appearance===s.EditorViewType.box?(0,i.jsx)(p.BoxModal,(0,r.__assign)({className:"NarrativeEditor NarrativeEditor--box",appearance:"blue",title:this.getBoxTitle(),onClose:function(){return e.close()},hasScroll:!1},{children:this.renderInner()}),void 0):(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditor NarrativeEditor--page"},{children:this.renderInner()}),void 0)},t.prototype.renderInner=function(){var e=this.props,t=e.storyIds,o=e.storyMap,n=e.onStoryLinkUpdate,a=e.isEditingLinksAvailable,l=e.linkData,d=e.appearance,c=e.loadMore,u=e.hasMore,_=e.coverUploadConfig,p=e.ownerId,g=this.state,w=g.name,y=g.selectedStoryIds,S=g.cover,C=g.section,N=this.getSelectedStories(),x=(null==S?void 0:S.url)||"";return(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeEditor__inner"},{children:[C===s.EditorSectionType.main&&(0,i.jsxs)(m.NarrativeEditorSection,(0,r.__assign)({appearance:d,actionFooterButtons:this.getFooterButtons()},{children:[(0,i.jsx)(h.NarrativeEditorDataPanel,{className:"NarrativeEditor__dataPanel",coverUrl:x,name:w,selectedStoriesCount:y.length,onNameChange:this.onNameChange,onSubmit:this.save,onCoverClick:this.openCoverSelection,ref:this.dataPanelRef},void 0),(0,i.jsx)(v.NarrativeEditorStoriesTabPanel,{appearance:d,onSelectedStoriesUpdate:this.onSelectedStoriesUpdate,storyIds:t,loadMore:c,hasMore:u,selectedStoryIds:y,storyMap:o,linkData:l,isEditingLinksAvailable:a,onStoryLinkUpdate:n},void 0)]}),void 0),C===s.EditorSectionType.cover&&(0,i.jsx)(f.NarrativeEditorCoverSection,{ownerId:p,appearance:d,cover:S,stories:N,onSave:this.confirmCover,coverUploadConfig:_,storyMap:o},void 0)]}),void 0)},t.prototype.getBoxTitle=function(){var e=this.props.type;return this.state.section===s.EditorSectionType.cover?(0,a.getLang)("stories_choose_cover_title"):e===s.EditorModeType.create?(0,a.getLang)("stories_creating_narrative"):(0,a.getLang)("stories_editing_narrative")},t.prototype.getPublishDoneHtml=function(e,t,o){var i=this.props.getPublishDoneHTML;if(i)return i(e,t,o);var n=(0,r.__read)(e.split("_"),2),l=n[0],d=n[1],c="if (!event.metaKey && !event.ctrlKey) { showNarrative("+Number(l)+", "+Number(d)+", 0, 'narrative"+e+"'); return false; }";return'\n      <div class="top_result_header">\n        '+(o===s.EditorModeType.create?(0,a.getLang)("stories_narrative_created"):(0,a.getLang)("stories_narrative_edited")).replace("{name}",'<a href="/narrative'+e+'" onclick="'+c+'">'+(0,_.clean)(t)+"</a>")+'\n      </div>\n      <a href="#" class="link" onclick="window.Likes.share(\'narrative'+e+"'); return false;\">"+(0,a.getLang)("stories_manage_share_narrative")+"</a>\n    "},t.prototype.getSelectedStories=function(){var e=this;return this.state.selectedStoryIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.componentWillUnmount=function(){this.revokeCustomUrls()},t.prototype.revokeCustomUrls=function(){var e=this.state.cover;e&&(0,y.isCustomCover)(e)&&[e.url,e.customPhotoOriginalUrl].forEach((function(e){(null==e?void 0:e.startsWith("blob:"))&&URL.revokeObjectURL(e)}))},t.defaultProps={name:"",type:s.EditorModeType.create,activeTabKey:s.EditorTabKey.selected,isEditingLinksAvailable:!1,appearance:s.EditorViewType.page},t}(n.Component)},887157:(e,t,o)=>{"use strict";var r,i,n,a;o.d(t,{EditorModeType:()=>r,EditorTabKey:()=>i,EditorViewType:()=>n,EditorSectionType:()=>a}),function(e){e[e.create=0]="create",e[e.edit=1]="edit"}(r||(r={})),function(e){e.all="all",e.selected="selected"}(i||(i={})),function(e){e.box="box",e.page="page"}(n||(n={})),function(e){e.main="main",e.cover="cover"}(a||(a={}))},888551:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditorAllTab:()=>h});var r=o(570655),i=o(785893),n=o(667294),a=o(887157),s=o(780528),l=o(98529),d=o(117173),c=o(659397),u=o(66433),v=o(439664),h=function(e){function t(t){var o=e.call(this,t)||this;return o.tabRef=(0,n.createRef)(),o.onScroll=function(){o.props.hasMore&&o.checkLoading()},o.checkLoading=(0,c.throttle)((function(){var e=o.props,t=e.loadMore,r=e.hasMore,i=o.state.isLoading,n=o.getScrollContainer(),a=o.getTabEl();r&&a&&(!i&&o.isMount&&(n instanceof HTMLElement?a.scrollTop+a.clientHeight>=a.scrollHeight-d.SCROLL_LOADING_MORE_GAP:window.innerHeight+d.SCROLL_LOADING_MORE_GAP>=a.getBoundingClientRect().bottom)&&(o.setState({isLoading:!0}),t().catch((function(e){console.error(e),(0,u.logError)(e)})).finally((function(){o.setState({isLoading:!1})}))))}),d.SCROLL_THROTTLE_DELAY),o.state={isLoading:!1},o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e,t=this,o=this.props,n=o.stories,a=o.selectedStoriesMap,d=o.className,u=o.onToggleCheck,h=o.isEditingLinksAvailable,_=o.onStoryLinkUpdate,p=o.linkData,g=this.state.isLoading;return(0,i.jsxs)("div",(0,r.__assign)({className:(0,c.classNames)("NarrativeEditorAllTab ScrollContainer",d),ref:this.tabRef},{children:[(0,i.jsx)(s.StoryArchivePreviewGrid,(0,r.__assign)({className:"NarrativeEditorAllTab__grid"},{children:n.map((function(o){var n=!1,s=new Date(1e3*o.time).toDateString();return e&&s===e||(e=s,n=!0),(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditorAllTab__story"},{children:(0,i.jsx)(l.StoryArchivePreview,{story:o,checked:!!a[o.id],selectable:t.isSelectable(o),onToggleCheck:u,onStoryLinkUpdate:_,isEditingLinksAvailable:h,linkData:p,needShowDate:n},void 0)}),o.rawId)}))}),void 0),g&&(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditorAllTab__loader"},{children:(0,i.jsx)(v.default,{},void 0)}),void 0)]}),void 0)},t.prototype.isSelectable=function(e){var t=this.props.selectedStoriesMap,o=Object.keys(t).length;return!e.isUnavailable&&!!(o<d.MAX_NARRATIVE_STORIES||t[e.id])},t.prototype.componentDidMount=function(){this.isMount=!0,this.initScrollListener()},t.prototype.componentWillUnmount=function(){this.isMount=!1,this.deInitScrollContainer()},t.prototype.initScrollListener=function(){var e=this.getScrollContainer(),t=this.getTabEl();e&&t&&e.addEventListener("scroll",this.onScroll,!0)},t.prototype.deInitScrollContainer=function(){var e;null===(e=this.getScrollContainer())||void 0===e||e.removeEventListener("scroll",this.onScroll)},t.prototype.getScrollContainer=function(){return this.props.appearance===a.EditorViewType.box?this.getTabEl():window},t.prototype.getTabEl=function(){var e;return null===(e=this.tabRef)||void 0===e?void 0:e.current},t.defaultProps={isEditingLinksAvailable:!1,hasMore:!1},t}(n.Component)},495893:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditorCoverSection:()=>E});var r=o(570655),i=o(785893),n=o(667294),a=o(887157),s=o(659397),l=o(780528),d=o(98529),c=o(41650),u=o(288420),v=o(118690),h=o(405101),_=o(604192),p=o(49535),g=o(274123),f=o(111143),m=o(694292),w=o(673023),y=o(654612),S=o(241926),C=o(961540),N=o(66433),x=o(833623),b=o(303562),E=function(e){function t(t){var o,a=e.call(this,t)||this;a.scrollContainerRef=(0,n.createRef)(),a.isMount=!1,a.isCropSubmitted=!1,a.onFilesLoad=function(e){a.file=e[0],a.file&&a.uploadCover()},a.uploadCover=function(){if(a.file){var e=a.file,t=a.props.coverUploadConfig,o=new w.UploadPhoto(t,a.onUploadCoverProgress);o.validate(e).then((function(){if(a.isMount){var t=URL.createObjectURL(e),i={id:b.CustomCoverId,url:t,customPhotoOriginalUrl:t,percent:0,status:b.CoverUploadStatus.uploading};return a.setState({customCover:i}),o.upload(e).then((function(e){if(a.isMount){var t=JSON.stringify(e);a.setState({customCover:(0,r.__assign)((0,r.__assign)({},i),{percent:100,status:b.CoverUploadStatus.uploaded,uploadResponse:t}),checkedCoverId:b.CustomCoverId})}}))}})).catch((function(e){if(a.isMount){var t=a.state.customCover;t&&(t=(0,r.__assign)((0,r.__assign)({},t),{percent:0,status:b.CoverUploadStatus.failed})),console.error(e),e=(0,s.isObject)(e)?e.text:String(e),(0,y.showFastBox)((0,c.getLang)("global_error"),e||(0,c.getLang)("global_unknown_error")),(0,N.logError)(new Error("error with uploadCover"+(e?": "+e:""))),a.setState({customCover:t})}}))}},a.onUploadCoverProgress=function(e,t){var o=Math.min(e/t*100,90);a.setState((function(e){var t=e.customCover;return t?{customCover:(0,r.__assign)((0,r.__assign)({},t),{percent:o})}:null}))},a.selectCustomCover=function(){a.setState({checkedCoverId:b.CustomCoverId})},a.toggleCheck=function(e){a.setState({checkedCoverId:e.rawId})},a.openCropper=function(){var e=a.state.checkedCoverId,t=a.getCoverById(e);if(t){var o=a.getCoverOriginalUrl(t);o&&(0,C.loadImage)(o).then((function(e){if(a.isMount){var i=e.width,n=e.height,s=(0,r.__read)(a.getThumbSizes(i,n),2),l=s[0],d=s[1];a.setState({isModalOpen:!0}),(0,S.showNarrativeCropCoverBox)({coverUrl:o,coverHeight:n,coverWidth:i,thumbHeight:d,thumbWidth:l,crop:t.crop,onSave:a.onCropSave,onClose:a.onCropClose})}})).catch((function(e){console.error(e),e=String(e),(0,y.showFastBox)((0,c.getLang)("global_error"),e||(0,c.getLang)("global_unknown_error")),(0,N.logError)(new Error("error with cover openCropper"+(e?": "+e:"")))}))}},a.onCropSave=function(e,t){return a.saveCustomPhotoIfNeeded().then((function(o){a.isCropSubmitted=!0;var i=a.state.covers;(0,b.isSelectableCustomCover)(o)?a.setState({customCover:(0,r.__assign)((0,r.__assign)({},o),{url:t,crop:e})}):a.setState({covers:i.map((function(i){return i.id===o.id?(0,r.__assign)((0,r.__assign)({},o),{url:t,crop:e}):i}))})}))},a.onCropClose=function(){var e=a.props.onSave,t=a.state.checkedCoverId;a.setState({isModalOpen:!1});var o=a.getCoverById(t);o&&a.isCropSubmitted&&e({url:o.url,coverStoryId:o.coverStoryId,customPhotoOriginalUrl:o.customPhotoOriginalUrl,customPhotoId:o.customPhotoId,crop:o.crop})},a.getFooterButtons=function(){var e=a.props.onSave,t=a.state.customCover;return[(0,i.jsx)(u.default,(0,r.__assign)({appearance:"tertiary",onClick:function(){return e()}},{children:(0,c.getLang)("global_cancel")}),"close"),(0,i.jsx)(v.default,(0,r.__assign)({onClick:a.openCropper,disabled:(null==t?void 0:t.status)===b.CoverUploadStatus.uploading},{children:(0,c.getLang)("stories_narrative_cover_next_step")}),"save")]},a.onDragEnter=function(e){var t,o,r,i;("file"===(null===(o=null===(t=null==e?void 0:e.dataTransfer)||void 0===t?void 0:t.items[0])||void 0===o?void 0:o.kind)||(null===(i=null===(r=null==e?void 0:e.dataTransfer)||void 0===r?void 0:r.types)||void 0===i?void 0:i.includes("Files")))&&(clearTimeout(a.dragLeaveTimeout),delete a.dragLeaveTimeout,a.setState({showDropArea:!0})),(0,p.cancelEvent)(e)},a.onDragLeave=function(e){clearTimeout(a.dragLeaveTimeout),a.dragLeaveTimeout=setTimeout((function(){delete a.dragLeaveTimeout,a.setState({showDropArea:!1})}),100),(0,p.cancelEvent)(e)},a.onDragDrop=function(e){var t,o;a.onDragLeave(e),(null===(o=null===(t=null==e?void 0:e.dataTransfer)||void 0===t?void 0:t.files)||void 0===o?void 0:o.length)&&a.onFilesLoad(Array.from(e.dataTransfer.files));var r=a.getScrollContainer();r&&r.scrollTo({top:0,behavior:"smooth"}),(0,p.cancelEvent)(e)};var l=(0,r.__read)(a.buildCovers(t),2),d=l[0],h=l[1],_=null===(o=d[0])||void 0===o?void 0:o.id;if(t.cover){var g=t.cover.customPhotoId,f=t.cover.coverStoryId;_=g?b.CustomCoverId:f?t.storyMap[f].rawId:t.stories[0].rawId}return a.state={showDropArea:!1,covers:d,customCover:h,checkedCoverId:_,isModalOpen:!1},a}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.className,n=t.appearance,u=t.stories,v=this.state,p=v.customCover,w=v.checkedCoverId,y=v.showDropArea,S=v.isModalOpen;return(0,i.jsxs)(h.NarrativeEditorSection,(0,r.__assign)({className:(0,s.classNames)("NarrativeEditorCoverSection",o),appearance:n,actionFooterButtons:this.getFooterButtons()},{children:[(0,i.jsxs)("div",(0,r.__assign)({className:"ScrollContainer",ref:this.scrollContainerRef},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditorCoverSection__hint StoryGridHint"},{children:(0,c.getLang)("stories_choose_cover_hint")}),void 0),(0,i.jsxs)(l.StoryArchivePreviewGrid,(0,r.__assign)({className:"NarrativeEditorCoverSection__grid"},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditorCoverSection__create"},{children:(0,i.jsx)(_.StoryLoadFile,{text:(0,c.getLang)("stories_upload_narrative_cover"),onFilesLoad:this.onFilesLoad},void 0)}),void 0),p&&(0,i.jsx)(m.StoryCustomCoverPreview,{uploadingStatus:p.status,coverUrl:p.customPhotoOriginalUrl,checked:p.id===w,uploadingPercent:p.percent,onToggleCheck:this.selectCustomCover,retryUpload:this.uploadCover},void 0),u.map((function(t){return(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditorCoverSection__story"},{children:(0,i.jsx)(d.StoryArchivePreview,{story:t,checked:w===t.rawId,selectable:!0,onToggleCheck:e.toggleCheck},void 0)}),t.rawId)}))]}),void 0)]}),void 0),y&&!S&&n===a.EditorViewType.box&&(0,i.jsx)(g.UploadDropBoxArea,{},void 0),y&&!S&&n===a.EditorViewType.page&&(0,i.jsx)(f.UploadDropPageArea,{},void 0)]}),void 0)},t.prototype.getThumbSizes=function(e,t){var o,r,i=e/t;return e>=t?(o=Math.min(e,x.MAX_THUMB_WIDTH),(r=Math.floor(o/i))>x.MAX_THUMB_HEIGHT&&(r=x.MAX_THUMB_HEIGHT,o=Math.floor(r*i))):(r=Math.min(t,x.MAX_THUMB_HEIGHT),(o=Math.floor(r*i))>x.MAX_THUMB_WIDTH&&(o=x.MAX_THUMB_WIDTH,r=Math.floor(o/i))),[o,r]},t.prototype.saveCustomPhotoIfNeeded=function(){var e=this,t=this.props,o=t.ownerId,i=t.coverUploadConfig,n=this.state.checkedCoverId,a=this.getCoverById(n);return a?(0,b.needSavePhoto)(a)?new Promise((function(t,n){window.ajax.post("al_stories.php",{act:"save_narrative_cover",owner_id:o,upload_response:a.uploadResponse,hash:i.hash},{onDone:function(o){var i=e.state.customCover;if(e.isMount&&i){var a=(0,r.__assign)((0,r.__assign)({},i),{customPhotoId:o});t(a)}else n()},onFail:function(e){return console.error(e),n(e),!0}})})):Promise.resolve(a):Promise.reject()},t.prototype.componentDidMount=function(){this.isMount=!0;var e=this.getDragAndDropContainer();e&&(e.addEventListener("drop",this.onDragDrop),e.addEventListener("dragenter",this.onDragEnter),e.addEventListener("dragover",this.onDragEnter),e.addEventListener("dragleave",this.onDragLeave))},t.prototype.componentWillUnmount=function(){this.isMount=!1,null!=this.dragLeaveTimeout&&clearTimeout(this.dragLeaveTimeout);var e=this.getDragAndDropContainer();e&&(e.removeEventListener("drop",this.onDragDrop),e.removeEventListener("dragenter",this.onDragEnter),e.removeEventListener("dragover",this.onDragEnter),e.removeEventListener("dragleave",this.onDragLeave))},t.prototype.getDragAndDropContainer=function(){return this.props.appearance===a.EditorViewType.box?window.boxLayerWrap:document.body},t.prototype.getScrollContainer=function(){return this.props.appearance===a.EditorViewType.box?this.scrollContainerRef.current:document.documentElement},t.prototype.buildCovers=function(e){var t,o=e.cover,i=e.stories;return o&&(0,b.isCustomCover)(o)&&(t=(0,r.__assign)({id:b.CustomCoverId},o)),[i.map((function(e){return(null==o?void 0:o.coverStoryId)===e.id?(0,r.__assign)({id:e.rawId},o):{id:e.rawId,url:e.preview,coverStoryId:e.id}})),t]},t.prototype.getCoverById=function(e){return e===b.CustomCoverId?this.state.customCover:this.state.covers.find((function(t){return t.id===e}))},t.prototype.getCoverOriginalUrl=function(e){var t,o=this.props.storyMap,r="";return(0,b.isSelectableCustomCover)(e)?r=e.customPhotoOriginalUrl:e.coverStoryId&&(r=null===(t=o[e.coverStoryId])||void 0===t?void 0:t.originalPreviewUrl),r},t}(n.Component)},303562:(e,t,o)=>{"use strict";var r;function i(e){return Boolean(e.customPhotoId||e.uploadResponse)}function n(e){return Boolean(e.customPhotoId)}function a(e){return e.uploadResponse&&!e.customPhotoId}function s(e){var t={url:e.coverUrl,crop:e.coverCrop};return e.customCover?(t.customPhotoId=e.customCover.photoId,t.customPhotoOriginalUrl=e.customCover.originalPhotoUrl):t.coverStoryId=e.coverStoryId,t}o.d(t,{CoverUploadStatus:()=>r,isSelectableCustomCover:()=>i,isCustomCover:()=>n,needSavePhoto:()=>a,getPreparedCover:()=>s,CustomCoverId:()=>l}),function(e){e[e.uploaded=0]="uploaded",e[e.uploading=1]="uploading",e[e.failed=2]="failed"}(r||(r={}));var l="custom"},956252:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditorDataPanel:()=>h});var r=o(570655),i=o(785893),n=o(667294),a=o(41650),s=o(659397),l=o(349062),d=o(117173),c=o(49535),u=o(726271),v=o(662199),h=function(e){function t(t){var o=e.call(this,t)||this;return o.getInputEl=function(){return o.nameInputRef&&o.nameInputRef.current},o.onKeyDown=function(e){e.keyCode===c.KEY.ENTER&&(e.ctrlKey||e.metaKey&&u.browser.mac)&&o.props.onSubmit()},o.nameInputRef=(0,n.createRef)(),o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.name,o=e.onNameChange,n=e.selectedStoriesCount,c=e.coverUrl,u=e.onCoverClick,h=e.className,_=0===n,p="";return _||(p=(0,a.getLang)("stories_choose_cover")),(0,i.jsxs)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeEditorDataPanel",h)},{children:[(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeEditorDataPanel__preview"},{children:[(0,i.jsx)(l.NarrativeItemPreviewCover,{className:(0,s.classNames)("NarrativeEditorDataPanel__cover",{"NarrativeEditorDataPanel__cover--active":!_}),onClick:u,cover:c,title:p,extra:!_&&(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditorDataPanel__pencil"},{children:(0,i.jsx)(v.default,{},void 0)}),void 0)},void 0),(0,i.jsx)("span",(0,r.__assign)({className:(0,s.classNames)("NarrativeEditorDataPanel__name",{"NarrativeEditorDataPanel__name--empty":!t})},{children:t||(0,a.getLang)("stories_narrative_name_full")}),void 0)]}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeEditorDataPanel__form"},{children:[(0,i.jsx)("span",(0,r.__assign)({className:"NarrativeEditorDataPanel__nameLabel"},{children:(0,a.getLang)("stories_narrative_name")}),void 0),(0,i.jsx)("input",{className:"NarrativeEditorDataPanel__nameInput",value:t,onChange:o,onKeyDown:this.onKeyDown,type:"text",placeholder:(0,a.getLang)("stories_enter_name"),maxLength:d.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0},void 0),n>0&&(0,i.jsx)("span",(0,r.__assign)({className:"NarrativeEditorDataPanel__selectedStoryCount"},{children:(0,a.getLang)("stories_selected_count",n)}),void 0)]}),void 0)]}),void 0)},t}(n.Component)},743188:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditorFooter:()=>s});var r=o(570655),i=o(785893),n=o(483295),a=o(150382),s=function(e){var t=e.appearance,o=e.actionButtons;return(0,i.jsx)("div",(0,r.__assign)({className:(0,n.classNames)("NarrativeEditorFooter","NarrativeEditorFooter--"+t)},{children:(0,i.jsx)(a.ModalFooter,{actionButtons:o},void 0)}),void 0)}},405101:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditorSection:()=>l});var r=o(570655),i=o(785893),n=o(667294),a=o(743188),s=o(483295),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scrollContainerRef=(0,n.createRef)(),t}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,o=e.children,n=e.appearance,l=e.actionFooterButtons;return(0,i.jsxs)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeEditorSection",t),ref:this.scrollContainerRef},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditorSection__body"},{children:o}),void 0),Boolean(l)&&(0,i.jsx)(a.NarrativeEditorFooter,{appearance:n,actionButtons:l},void 0)]}),void 0)},t.prototype.getSectionEl=function(){var e;return null===(e=this.scrollContainerRef)||void 0===e?void 0:e.current},t}(n.Component)},417139:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditorSelectedTab:()=>h});var r=o(570655),i=o(785893),n=o(667294),a=o(887157),s=o(780528),l=o(98529),d=o(483295),c=o(117173),u=o(387142),v="NarrativeEditorSelectedTab__storyPreview",h=function(e){function t(t){var o=e.call(this,t)||this;return o.gridContainerRef=(0,n.createRef)(),o.tabRef=(0,n.createRef)(),o.state={draggingStoryRawId:""},o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.stories,n=t.selectedStoriesMap,a=t.className,c=t.isEditingLinksAvailable,u=t.onStoryLinkUpdate,h=t.linkData,_=t.onToggleCheck,p=this.state.draggingStoryRawId;return(0,i.jsx)("div",(0,r.__assign)({className:(0,d.classNames)("NarrativeEditorSelectedTab ScrollContainer",a),ref:this.tabRef},{children:(0,i.jsx)(s.StoryArchivePreviewGrid,(0,r.__assign)({ref:this.gridContainerRef},{children:o.map((function(t){return(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeEditorSelectedTab__story"},{children:(0,i.jsx)(l.StoryArchivePreview,{className:v,story:t,draggable:!0,isDragged:t.rawId===p,checked:!!n[t.id],selectable:e.isSelectable(t),onToggleCheck:_,onStoryLinkUpdate:u,isEditingLinksAvailable:c,linkData:h},void 0)}),t.rawId)}))}),void 0)}),void 0)},t.prototype.isSelectable=function(e){var t=this.props.selectedStoriesMap,o=Object.keys(t).length;return!e.isUnavailable&&!!(o<c.MAX_NARRATIVE_STORIES||t[e.rawId])},t.prototype.componentDidMount=function(){var e=this,t=this.props,o=t.onReorder,r=t.appearance,i=this.getGridContainer(),n={dragThreshold:0,onDragFinish:function(){e.setState({draggingStoryRawId:""})},onDragStart:function(t){var o=t.querySelector("."+v);if(o){var r=o.dataset.id;e.setState({draggingStoryRawId:r})}},onReorder:function(){var t=e.props.stories,r=document.querySelectorAll("."+v),i=[];r.forEach((function(e){var o=e.getAttribute("data-id"),r=t.find((function(e){return e.rawId===o}));r&&i.push(r.id)})),o(i)}};i&&(r===a.EditorViewType.box&&(n.wrapNode=this.getTabEl()),this.sorter=new u.default(i,"",n))},t.prototype.componentWillUnmount=function(){this.sorter&&this.sorter.destroy()},t.prototype.getTabEl=function(){var e;return null===(e=this.tabRef)||void 0===e?void 0:e.current},t.prototype.getGridContainer=function(){var e,t;return null===(t=null===(e=this.gridContainerRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.getGridContainer()},t}(n.Component)},720516:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditorStoriesTabPanel:()=>h});var r=o(570655),i=o(785893),n=o(667294),a=o(887157),s=o(41650),l=o(641388),d=o(417139),c=o(888551),u=o(483295),v=o(117173),h=function(e){function t(t){var o=e.call(this,t)||this;return o.onTabClick=function(e,t){o.setState({tabKey:t,selectedTabStoryIds:(0,r.__spreadArray)([],(0,r.__read)(o.props.selectedStoryIds),!1)})},o.onReorder=function(e){var t=o.props.onSelectedStoriesUpdate,r=o.getSelectedStoriesMap(),i=e.filter((function(e){return r[e]}));o.setState({selectedTabStoryIds:e}),t(i)},o.onStorySelectToggle=function(e){var t,i=o.props,n=i.selectedStoryIds,s=i.onSelectedStoriesUpdate,l=o.state,d=l.tabKey,c=l.selectedTabStoryIds,u=o.getSelectedStoriesMap();if(!(Object.keys(u).length>=v.MAX_NARRATIVE_STORIES)||u[e.id]){if(!c.length)return o.setState({selectedTabStoryIds:[e.id]}),void s([e.id]);if(u[e.id]){s(n.filter((function(t){return t!==e.id})))}else{var h=[],_=(0,r.__assign)((0,r.__assign)({},u),((t={})[e.id]=e,t));if(d===a.EditorTabKey.selected)h=c.filter((function(e){return _[e]}));else if(d===a.EditorTabKey.all){if(c.includes(e.id))h=c.filter((function(e){return _[e]}));else h=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(c),!1),[e.id],!1).filter((function(e){return _[e]})),o.setState({selectedTabStoryIds:(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(c),!1),[e.id],!1)})}s(h)}}},o.state={tabKey:t.selectedStoryIds.length?a.EditorTabKey.selected:a.EditorTabKey.all,selectedTabStoryIds:(0,r.__spreadArray)([],(0,r.__read)(t.selectedStoryIds),!1)},o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e,t=this.props,o=t.selectedStoryIds,n=t.appearance,v=t.isEditingLinksAvailable,h=t.linkData,_=t.onStoryLinkUpdate,p=t.loadMore,g=t.hasMore,f=this.state.tabKey,m=this.getSelectedStoriesMap(),w=this.getAllStories();return(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeEditorStoriesTabPanel"},{children:[(0,i.jsxs)(l.default,(0,r.__assign)({className:"NarrativeEditorStoriesTabPanel__tabs",onTabClick:this.onTabClick,active:f,disabledTabMap:(e={},e[a.EditorTabKey.selected]=!o.length,e)},{children:[(0,i.jsxs)("span",{children:[(0,s.getLang)("stories_narrative_editor_selected_tab"),o.length>0&&(0,i.jsx)("span",(0,r.__assign)({className:"Tabs__desc"},{children:o.length}),void 0)]},a.EditorTabKey.selected),(0,i.jsx)("span",{children:(0,s.getLang)("stories_narrative_editor_all_tab")},a.EditorTabKey.all)]}),void 0),f===a.EditorTabKey.selected&&(0,i.jsx)(d.NarrativeEditorSelectedTab,{className:(0,u.classNames)("NarrativeEditorSelectPanel__grid","NarrativeEditorSelectPanel__grid--"+n),appearance:n,stories:this.getSelectedTabStories(),onReorder:this.onReorder,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:m,onStoryLinkUpdate:_,isEditingLinksAvailable:v,linkData:h},void 0),f===a.EditorTabKey.all&&(0,i.jsx)(c.NarrativeEditorAllTab,{className:(0,u.classNames)("NarrativeEditorSelectPanel__grid","NarrativeEditorSelectPanel__grid--"+n),appearance:n,stories:w,loadMore:p,hasMore:g,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:m,onStoryLinkUpdate:_,isEditingLinksAvailable:v,linkData:h},void 0)]}),void 0)},t.prototype.getSelectedTabStories=function(){var e=this;return this.state.selectedTabStoryIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.getAllStories=function(){var e=this;return this.props.storyIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.getSelectedStoriesMap=function(){var e=this;return this.props.selectedStoryIds.reduce((function(t,o){return t[o]=e.props.storyMap[o],t}),{})},t.defaultProps={isEditingLinksAvailable:!1},t}(n.Component)},349062:(e,t,o)=>{"use strict";o.d(t,{NarrativeItemPreviewCover:()=>s});var r=o(570655),i=o(785893),n=o(667294),a=o(483295),s=(0,n.memo)((function(e){var t=e.title,o=e.onClick,s=e.cover,l=e.href,d=e.className,c=void 0===d?"":d,u=e.extra,v=e.noBorder,h=void 0!==v&&v,_=e.isDraft,p=void 0!==_&&_,g=e.size,f=void 0===g?58:g,m=s?{backgroundImage:"url("+s+")"}:{},w=(0,a.classNames)("NarrativeItemPreviewCover","NarrativeItemPreviewCover--size"+f,c,{"NarrativeItemPreviewCover--noBorder":h,"NarrativeItemPreviewCover--isDraft":p}),y=(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeItemPreviewCover__image",style:m,title:t||void 0},{children:u}),void 0);return(0,i.jsxs)(n.Fragment,{children:[l&&(0,i.jsx)("a",(0,r.__assign)({href:l,className:w,onClick:o},{children:y}),void 0),!l&&(0,i.jsx)("div",(0,r.__assign)({className:w,onClick:o},{children:y}),void 0)]},void 0)}))},109542:(e,t,o)=>{"use strict";o.d(t,{NarrativeRow:()=>u});var r=o(570655),i=o(785893),n=o(667294),a=o(349062),s=o(167625),l=o(659397),d=o(41650),c=o(521114),u=(0,n.memo)((function(e){var t,o,u,v,h=e.narrative,_=e.aside,p=e.onClick,g=e.className,f=e.clickable,m=e.size,w=e.noBorder,y=!h.storiesCount,S=y?"":"/narrative"+h.ownerId+"_"+h.id;return y?(t=(0,i.jsx)(a.NarrativeItemPreviewCover,{isDraft:!0,extra:(0,i.jsx)(c.default,{},void 0),size:m},void 0),o=(0,i.jsxs)(n.Fragment,{children:[(0,d.getLang)("groups_narrative_box_stories_count",h.storiesCount),(0,i.jsx)("span",{className:"dvd"},void 0),(0,i.jsx)("span",{children:(0,d.getLang)("stories_narratives_draft")},void 0)]},void 0)):(t=(0,i.jsx)(a.NarrativeItemPreviewCover,{onClick:p,size:m,cover:h.coverUrl,href:S,noBorder:w},void 0),o=(0,i.jsx)("span",{children:(0,d.getLang)("groups_narrative_box_stories_count",h.storiesCount)},void 0)),f?u=p:y||(v=p),(0,i.jsx)("div",(0,r.__assign)({className:(0,l.classNames)("NarrativeRow NarrativeListItem",g,{"NarrativeRow--clickable":f}),"data-id":h.id,onClick:u},{children:(0,i.jsx)(s.NarrativeRowBase,{className:"NarrativeRow__inner",href:S,onClick:v,preview:t,id:h.id,title:h.title,subtitle:o,size:m,aside:_},void 0)}),void 0)}))},167625:(e,t,o)=>{"use strict";o.d(t,{NarrativeRowBase:()=>l});var r=o(570655),i=o(785893),n=o(667294),a=o(449849),s=o(659397),l=(0,n.memo)((function(e){e.id;var t,o=e.title,n=e.subtitle,l=e.preview,d=e.aside,c=e.href,u=e.onClick,v=e.className,h=void 0===v?"":v,_=e.size,p=void 0===_?58:_,g=(0,r.__rest)(e,["id","title","subtitle","preview","aside","href","onClick","className","size"]),f=Boolean(u||c);return o=(0,a.decodeHTMLEntities)(o),t=c?(0,i.jsx)("a",(0,r.__assign)({href:c,className:"NarrativeRowBase__title",onClick:u},{children:o}),void 0):(0,i.jsx)("span",(0,r.__assign)({className:"NarrativeRowBase__title",onClick:u},{children:o}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeRowBase","NarrativeRowBase--previewSize"+p,h,{"NarrativeRowBase--clickable":f})},g,{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeRowBase__preview"},{children:l}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeRowBase__inner"},{children:[(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeRowBase__main"},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeRowBase__title"},{children:t}),void 0),n&&(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeRowBase__subtitle"},{children:n}),void 0)]}),void 0),d&&(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeRowBase__aside"},{children:d}),void 0)]}),void 0)]}),void 0)}))},385597:(e,t,o)=>{"use strict";o.d(t,{NarrativeRowCreation:()=>c});var r=o(570655),i=o(785893),n=o(667294),a=o(167625),s=o(41650),l=o(659397),d=o(587083),c=(0,n.memo)((function(e){var t=e.onClick,o=e.clickable,n=void 0!==o&&o,c=e.size,u=void 0===c?58:c,v=(0,s.getLang)("stories_create_new_narrative"),h=(0,i.jsx)("div",(0,r.__assign)({className:(0,l.classNames)("NarrativeRowCreation__preview","NarrativeRowCreation__preview--size"+u)},{children:(0,i.jsx)(d.default,{},void 0)}),void 0);return(0,i.jsx)("div",(0,r.__assign)({className:(0,l.classNames)("NarrativeRowCreation NarrativeListItem",{"NarrativeRowCreation--clickable":n})},{nodrag:"true"},{children:(0,i.jsx)(a.NarrativeRowBase,{className:"NarrativeRowCreation__inner",title:v,onClick:t,preview:h,size:u},void 0)}),void 0)}))},551907:(e,t,o)=>{"use strict";o.d(t,{NarrativeSnippet:()=>s});var r=o(570655),i=o(785893),n=o(41650),a=o(659397),s=function(e){var t=e.className,o=e.coverUrl,s=e.title,l=e.ownerName,d=e.storyCount;return(0,i.jsx)("div",(0,r.__assign)({className:(0,a.classNames)("NarrativeSnippet",t)},{children:(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeSnippet__inner"},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"NarrativeSnippet__cover"},{children:(0,i.jsx)("div",{className:"NarrativeSnippet__image",style:{backgroundImage:"url("+o+")"}},void 0)}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:"NarrativeSnippet__info"},{children:[(0,i.jsx)("div",(0,r.__assign)({className:(0,a.classNames)("NarrativeSnippet__title",{"NarrativeSnippet__title--empty":!s})},{children:s||(0,n.getLang)("stories_narrative_name_full")}),void 0),(0,i.jsx)("span",(0,r.__assign)({className:"NarrativeSnippet__author"},{children:l}),void 0),(0,i.jsxs)("span",(0,r.__assign)({className:"NarrativeSnippet__description"},{children:[(0,i.jsx)("span",{children:(0,n.getLang)("global_type_narrative")},void 0),(0,i.jsx)("span",{className:"dvd"},void 0),(0,i.jsx)("span",{children:(0,n.getLang)("global_narrative_stories_count",d)},void 0)]}),void 0)]}),void 0)]}),void 0)}),void 0)}},98529:(e,t,o)=>{"use strict";o.d(t,{StoryArchivePreview:()=>_});var r=o(570655),i=o(785893),n=o(667294),a=o(483295),s=o(41650),l=o(241926),d=o(66433),c=o(289988),u=o(213984),v=o(104022),h=o(439664),_=function(e){function t(t){var o=e.call(this,t)||this;return o.videoRef=(0,n.createRef)(),o.needPauseAfterLoading=!1,o.onLinkButtonClick=function(e){var t=o.props,r=t.story,i=t.onStoryLinkUpdate,n=t.linkData;t.isDragged||((0,l.showStoryLinkEditorBox)({story:r,onStoryLinkUpdate:i,linkData:n}),e.stopPropagation())},o.onMouseEnter=function(){o.setState({isHovered:!0})},o.onMouseLeave=function(){o.setState({isHovered:!1})},o.onToggleCheck=function(){var e=o.props,t=e.onToggleCheck,r=e.story;!e.isDragged&&t&&t(r)},o.state={isHovered:!1,preloadVideo:!1,canPlayVideo:!1,isLoading:!1},o}return(0,r.__extends)(t,e),t.prototype.componentDidUpdate=function(e,t){var o=this.props,r=o.story,i=o.isDragged,n=this.state.isHovered;r.videoUrl&&(i||(!t.isHovered&&n?this.playVideo():t.isHovered&&!n&&this.pauseVideo()),!e.isDragged&&i&&this.pauseVideo(),e.isDragged&&!i&&n&&this.playVideo())},t.prototype.componentWillUnmount=function(){this.cleanVideoPlayTimeout(),this.cleanVideoPauseTimeout(),this.cleanVideoLoaderTimeout()},t.prototype.playVideo=function(e){var t=this;void 0===e&&(e=!1),null!=this.videoPauseDelayTimeout&&this.cleanVideoPauseTimeout();var o=function(){delete t.videoPlayDelayTimeout,t.videoRef.current&&(t.videoRef.current.muted=!0,t.videoRef.current.play().then((function(){var e;if(t.hideLoader(),t.setState({canPlayVideo:!0}),t.needPauseAfterLoading)return null===(e=t.videoRef.current)||void 0===e||e.pause(),void(t.needPauseAfterLoading=!1)})).catch((function(e){t.hideLoader(),console.error(e),(0,d.logError)(e)})))};e?o():null==this.videoPlayDelayTimeout&&(this.videoLoaderTimeout=setTimeout((function(){t.setState({isLoading:!0})}),800),this.setState({preloadVideo:!0}),this.videoPlayDelayTimeout=setTimeout((function(){o()}),200))},t.prototype.pauseVideo=function(e){var t=this;void 0===e&&(e=!1),null!=this.videoPlayDelayTimeout&&this.cleanVideoPlayTimeout();var o=function(){var e;if(delete t.videoPauseDelayTimeout,t.hideLoader(),t.state.canPlayVideo){var o=null===(e=t.videoRef)||void 0===e?void 0:e.current;null==o||o.pause()}else t.needPauseAfterLoading=!0};e?o():null==this.videoPauseDelayTimeout&&(this.videoPauseDelayTimeout=setTimeout((function(){o()}),200))},t.prototype.cleanVideoPlayTimeout=function(){this.videoPlayDelayTimeout&&(clearTimeout(this.videoPlayDelayTimeout),delete this.videoPlayDelayTimeout)},t.prototype.cleanVideoPauseTimeout=function(){this.videoPauseDelayTimeout&&(clearTimeout(this.videoPauseDelayTimeout),delete this.videoPauseDelayTimeout)},t.prototype.cleanVideoLoaderTimeout=function(){this.videoLoaderTimeout&&(clearTimeout(this.videoLoaderTimeout),delete this.videoLoaderTimeout)},t.prototype.hideLoader=function(){this.state.isLoading&&this.setState({isLoading:!1}),this.cleanVideoLoaderTimeout()},t.prototype.render=function(){var e=this,t=this.props,o=t.story,n=t.checked,l=t.selectable,d=t.draggable,_=t.className,p=t.isEditingLinksAvailable,g=t.needShowDate,f=this.state,m=f.preloadVideo,w=f.canPlayVideo,y=f.isLoading,S=Boolean(o.videoUrl),C=new Date(1e3*o.time);return(0,i.jsx)("div",(0,r.__assign)({className:(0,a.classNames)("StoryArchivePreview","StoryPreviewContainer",_,{"StoryArchivePreview--video":S,"StoryArchivePreview--checked":n}),onClick:this.onToggleCheck,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,"data-id":o.rawId},{children:(0,i.jsxs)("div",(0,r.__assign)({className:"StoryArchivePreview__wrapper"},{children:[S&&(0,i.jsxs)(i.Fragment,{children:[m&&(0,i.jsx)("video",{className:(0,a.classNames)("StoryArchivePreview__media",{"StoryArchivePreview__media--hidden":!w}),src:o.videoUrl,ref:this.videoRef,controls:!1,preload:"metadata",loop:!0,playsInline:!0},void 0),!w&&(0,i.jsx)("img",{className:"StoryArchivePreview__media",src:o.preview,alt:""},void 0)]},void 0),!S&&(0,i.jsx)("img",{className:"StoryArchivePreview__media",src:o.preview,alt:""},void 0),g&&(0,i.jsxs)("div",(0,r.__assign)({className:"StoryArchivePreview__date"},{children:[(0,i.jsx)("div",(0,r.__assign)({className:"StoryArchivePreview__day"},{children:C.getDate()}),void 0),(0,i.jsx)("div",(0,r.__assign)({className:"StoryArchivePreview__month"},{children:(0,i.jsx)(u.default,{children:(0,s.getLang)("months_sm_of")[C.getMonth()+1]},void 0)}),void 0)]}),void 0),d&&!g&&(0,i.jsx)("div",{className:"StoryArchivePreview__draggableIcon"},void 0),l&&(0,i.jsx)("div",{className:(0,a.classNames)("StoryArchivePreview__select",{"StoryArchivePreview__select--on":n})},void 0),(p||o.videoUrl)&&(0,i.jsx)("div",(0,r.__assign)({className:"StoryArchivePreview__footer"},{children:(0,i.jsxs)("div",(0,r.__assign)({className:"StoryArchivePreview__footerInner"},{children:[o.videoUrl&&(0,i.jsxs)("div",(0,r.__assign)({className:"StoryArchivePreview__play"},{children:[(0,i.jsx)(v.default,{},void 0),(0,i.jsx)("span",(0,r.__assign)({className:"StoryArchivePreview__playTime"},{children:(0,c.formatTime)(o.duration||0)}),void 0)]}),void 0),p&&(0,i.jsx)("div",(0,r.__assign)({className:"StoryArchivePreview__linkBtn",onClick:function(t){return e.onLinkButtonClick(t)}},{children:o.linkUrl?(0,s.getLang)("stories_edit_link"):(0,s.getLang)("stories_add_link")}),void 0)]}),void 0)}),void 0),y&&(0,i.jsx)("div",(0,r.__assign)({className:"StoryArchivePreview__loader"},{children:(0,i.jsx)(h.default,{size:24,strokeWidth:3,color:"#fff"},void 0)}),void 0)]}),void 0)}),void 0)},t.defaultProps={checked:!1,selectable:!1,draggable:!1,isDragged:!1,className:"",isEditingLinksAvailable:!1,onToggleCheck:function(){},onStoryLinkUpdate:function(){},linkData:[]},t}(n.PureComponent)},780528:(e,t,o)=>{"use strict";o.d(t,{StoryArchivePreviewGrid:()=>s});var r=o(570655),i=o(785893),n=o(667294),a=o(483295),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gridContainerRef=(0,n.createRef)(),t}return(0,r.__extends)(t,e),t.prototype.getGridContainer=function(){return this.gridContainerRef.current},t.prototype.render=function(){var e=this.props,t=e.className,o=e.children,n=e.isScrolling;return(0,i.jsx)("div",(0,r.__assign)({className:(0,a.classNames)("StoryArchivePreviewGrid",t,{"StoryArchivePreviewGrid--scrolling":n})},{children:(0,i.jsx)("div",(0,r.__assign)({className:"StoryArchivePreviewGrid__inner",ref:this.gridContainerRef},{children:o}),void 0)}),void 0)},t.defaultProps={className:""},t}(n.Component)},694292:(e,t,o)=>{"use strict";o.d(t,{StoryCustomCoverPreview:()=>u});var r=o(570655),i=o(785893),n=o(667294),a=o(659397),s=o(786427),l=o(410902),d=o(41650),c=o(303562),u=function(e){function t(t){return e.call(this,t)||this}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.checked,o=e.coverUrl,n=e.onToggleCheck,u=e.uploadingStatus,v=e.uploadingPercent,h=e.retryUpload,_=u===c.CoverUploadStatus.uploaded,p=u===c.CoverUploadStatus.uploading,g=u===c.CoverUploadStatus.failed,f=_;return(0,i.jsxs)("div",(0,r.__assign)({className:(0,a.classNames)("StoryCustomCoverPreview StoryPreviewContainer",{"StoryCustomCoverPreview--empty":p||g}),onClick:function(){f&&n()}},{children:[_&&(0,i.jsx)("div",(0,r.__assign)({className:"StoryCustomCoverPreview__coverFrame"},{children:(0,i.jsx)("div",(0,r.__assign)({className:"StoryCustomCoverPreview__coverWrap"},{children:(0,i.jsx)("img",{src:o,className:"StoryCustomCoverPreview__cover",alt:""},void 0)}),void 0)}),void 0),p&&(0,i.jsx)(s.StoryProgressSpinner,{percent:v},void 0),g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.default,{},void 0),(0,i.jsx)("span",(0,r.__assign)({className:"StoryCustomCoverPreview__errorText"},{children:(0,d.getLang)("stories_upload_error_text")}),void 0),(0,i.jsx)("div",(0,r.__assign)({className:"StoryCustomCoverPreview__repeat",onClick:h},{children:(0,d.getLang)("stories_upload_repeat")}),void 0)]},void 0),f&&(0,i.jsx)("div",{className:(0,a.classNames)("StoryCustomCoverPreview__select",{"StoryCustomCoverPreview__select--on":t})},void 0)]}),void 0)},t.defaultProps={uploadingStatus:c.CoverUploadStatus.uploaded},t}(n.PureComponent)},730095:(e,t,o)=>{"use strict";o.d(t,{StoryLinkEditorBox:()=>f});var r=o(570655),i=o(785893),n=o(667294),a=o(41650),s=o(288420),l=o(41929),d=o(156589),c=o(870078),u=o(695724),v=o(654612),h=o(386409),_=o(66433),p=o(118690),g=o(486125),f=function(e){function t(t){var o=e.call(this,t)||this;return o.inputRef=(0,n.createRef)(),o.onChangeLink=function(e){var t=(0,u.trim)(e.target.value);o.setState({link:t,needShowHint:!o.isLinkValid(t)})},o.onKeyUpLink=function(){var e=o.state.link;o.setState({needShowHint:!o.isLinkValid(e)})},o.onChangeLinkType=function(e){o.setState({linkType:String(e.selected.value)})},o.onSave=function(){var e,t,r,i=o.props.linkData,n=o.state.linkType,s=o.state.link;if(s=(0,u.trim)(s),!o.isLinkValid(s))return null===(t=null===(e=o.inputRef)||void 0===e?void 0:e.current)||void 0===t||t.focus(),(0,h.notaBene)(null===(r=o.inputRef)||void 0===r?void 0:r.current),void o.setState({needShowHint:!0});i.needShowHint?(0,v.showFastBox)((0,a.getLang)("stories_saving_link"),(0,a.getLang)("stories_link_editing_warning"),(0,a.getLang)("global_save"),(function(e){o.edit(s,n,!0,e)}),(0,a.getLang)("global_cancel")):o.edit(s,n)},o.onDelete=function(){o.props.linkData.needShowHint?(0,v.showFastBox)((0,a.getLang)("stories_deleting_link"),(0,a.getLang)("stories_link_deleting_warning"),(0,a.getLang)("global_delete"),(function(e){o.delete(e)}),(0,a.getLang)("global_cancel")):o.delete()},o.state={link:t.story.linkUrl||"",linkType:t.story.linkType||t.linkData.items[0].value,needShowHint:!1,isSaving:!1,isDeleting:!1},o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,o=e.linkData,n=this.state,s=n.linkType,u=n.link,v=n.needShowHint,h=this.isEditMode()?(0,a.getLang)("stories_edit_link_title"):(0,a.getLang)("stories_add_link_title");return(0,i.jsx)(l.BoxModal,(0,r.__assign)({className:"StoryLinkEditorBox",appearance:"blue",onClose:t,title:h,actionButtons:this.getActionButtons(),hasScroll:!1},{children:(0,i.jsxs)("div",(0,r.__assign)({className:"StoryLinkEditorBox__inner"},{children:[(0,i.jsxs)("div",(0,r.__assign)({className:"StoryLinkEditorBox__row"},{children:[(0,i.jsx)("span",(0,r.__assign)({className:"StoryLinkEditorBox__label"},{children:(0,a.getLang)("stories_link_label_url")}),void 0),(0,i.jsx)("div",(0,r.__assign)({className:"StoryLinkEditorBox__control"},{children:(0,i.jsx)(c.StoryLinkHint,(0,r.__assign)({open:v,text:(0,a.getLang)("stories_upload_link_format")},{children:(0,i.jsx)("div",(0,r.__assign)({className:"StoryLinkHint__input"},{children:(0,i.jsx)("input",{className:"StoryLinkEditorBox__link",value:u,onChange:this.onChangeLink,onKeyUp:this.onKeyUpLink,autoFocus:!0,ref:this.inputRef},void 0)}),void 0)}),void 0)}),void 0)]}),void 0),(0,i.jsxs)("div",(0,r.__assign)({className:"StoryLinkEditorBox__row"},{children:[(0,i.jsx)("span",(0,r.__assign)({className:"StoryLinkEditorBox__label"},{children:(0,a.getLang)("stories_link_label_text")}),void 0),(0,i.jsx)("div",(0,r.__assign)({className:"StoryLinkEditorBox__control"},{children:(0,i.jsx)(d.default,{className:"StoryLinkEditorBox__select",appearance:"secondary",options:o.items,value:s,onChange:this.onChangeLinkType},void 0)}),void 0)]}),void 0)]}),void 0)}),void 0)},t.prototype.isEditMode=function(){return Boolean(this.props.story.linkUrl)},t.prototype.isLinkValid=function(e){if(e.length<2)return!1;if(!e.startsWith("http://")&&!e.startsWith("https://"))return!1;if(!e.match(/^[a-z0-9\/\-._:%=?&@#]+$/i))return!1;try{new URL(e)}catch(e){return!1}return!0},t.prototype.edit=function(e,t,o,r){var i=this;void 0===e&&(e=""),void 0===t&&(t=""),void 0===o&&(o=!0);var n=this.props,s=n.onStoryLinkUpdate,l=n.onClose,d=n.story,c=n.linkData;window.ajax.post("al_stories.php",{act:"edit_link",story_raw_id:d.rawId,link_url:e,link_text:t,hash:c.editHash},{onDone:function(){l(),s(d.rawId,e,t)},onFail:function(e){(0,g.showDoneBox)(e||(0,a.getLang)("global_unknown_error"));var t="Link saving error in StoryLinkEditor"+(e?": "+e:"");return(0,_.logError)(new Error(t)),!0},showProgress:function(){o?i.setState({isSaving:!0}):i.setState({isDeleting:!0}),(0,h.lockButton)(r)},hideProgress:function(){var e;r&&(null===(e=(0,g.curBox)())||void 0===e||e.hide(),(0,h.unlockButton)(r)),o?i.setState({isSaving:!1}):i.setState({isDeleting:!1})}})},t.prototype.delete=function(e){this.edit("","",!1,e)},t.prototype.getActionButtons=function(){var e=this.props.onClose,t=this.state,o=t.isSaving,n=t.isDeleting,l=[(0,i.jsx)(s.default,(0,r.__assign)({appearance:"tertiary",onClick:function(){return e()}},{children:(0,a.getLang)("global_cancel")}),"close"),(0,i.jsx)(p.default,(0,r.__assign)({loading:o,appearance:"primary",onClick:this.onSave},{children:this.isEditMode()?(0,a.getLang)("global_save"):(0,a.getLang)("stories_add_link")}),"save")];return this.isEditMode()&&l.unshift((0,i.jsx)(p.default,(0,r.__assign)({loading:n,appearance:"link",className:"StoryLinkEditorBox__extraFooterBtn",onClick:this.onDelete},{children:(0,a.getLang)("stories_delete_link")}),"delete")),l},t}(n.Component)},870078:(e,t,o)=>{"use strict";o.d(t,{StoryLinkHint:()=>a});var r=o(570655),i=o(785893),n=o(814217),a=function(e){var t=e.text,o=e.children,a=e.open,s=void 0!==a&&a,l=(0,i.jsx)("div",(0,r.__assign)({className:"StoryLinkHint"},{children:(0,i.jsx)("div",(0,r.__assign)({className:"StoryLinkHint__inner"},{children:t}),void 0)}),void 0);return(0,i.jsx)(n.Popper,(0,r.__assign)({open:s,position:"t",align:"left",content:l},{children:o}),void 0)}},604192:(e,t,o)=>{"use strict";o.d(t,{StoryLoadFile:()=>a});var r=o(570655),i=o(785893),n=o(488124),a=function(e){var t=e.text,o=e.multiple,a=void 0!==o&&o,s=e.onFilesLoad;return(0,i.jsxs)("div",(0,r.__assign)({className:"StoryLoadFile StoryPreviewContainer"},{children:[(0,i.jsx)(n.default,{},void 0),(0,i.jsx)("span",(0,r.__assign)({className:"StoryLoadFile__text"},{children:t}),void 0),(0,i.jsx)("input",{type:"file",className:"StoryLoadFile__input",multiple:a,onChange:function(e){var t=e.currentTarget.files;t&&s(Array.from(t))}},void 0)]}),void 0)}},786427:(e,t,o)=>{"use strict";o.d(t,{StoryProgressSpinner:()=>l});var r=o(570655),i=o(785893),n=o(667294),a=3,s=2*Math.PI*22,l=(0,n.memo)((function(e){var t=e.percent,o=void 0===t?60:t,n=e.width,l=void 0===n?24:n,d=e.height,c=void 0===d?24:d,u=(s-a)*o/100+a;return(0,i.jsx)("svg",(0,r.__assign)({className:"StoryProgressSpinner",width:l,height:c,viewBox:"0 0 50 50"},{children:(0,i.jsx)("circle",{cx:"25",cy:"25",r:22,stroke:"#fff",fill:"none",strokeWidth:"6",strokeMiterlimit:"10",strokeDashoffset:"0",strokeDasharray:u+","+s,strokeLinecap:"round"},void 0)}),void 0)}))},274123:(e,t,o)=>{"use strict";o.d(t,{UploadDropBoxArea:()=>a});var r=o(570655),i=o(785893),n=o(41650),a=function(){return(0,i.jsx)("div",(0,r.__assign)({className:"UploadDropBoxArea"},{children:(0,i.jsx)("div",(0,r.__assign)({className:"UploadDropBoxArea__inner"},{children:(0,i.jsx)("div",(0,r.__assign)({className:"UploadDropBoxArea__text"},{children:(0,n.getLang)("stories_narrative_cover_drop_hint")}),void 0)}),void 0)}),void 0)}},111143:(e,t,o)=>{"use strict";o.d(t,{UploadDropPageArea:()=>s});var r=o(570655),i=o(785893),n=o(41650),a=o(394021),s=function(){return(0,i.jsx)(a.WithPortal,{children:(0,i.jsx)("div",(0,r.__assign)({className:"UploadDropPageArea"},{children:(0,i.jsxs)("div",(0,r.__assign)({className:"UploadDropPageArea__inner"},{children:[(0,i.jsx)("div",{className:"UploadDropPageArea__image"},void 0),(0,i.jsx)("div",(0,r.__assign)({className:"UploadDropPageArea__text"},{children:(0,n.getLang)("stories_drop_page_area_label")}),void 0)]}),void 0)}),void 0)},void 0)}},117173:(e,t,o)=>{"use strict";o.d(t,{STORIES_MANAGE_MODULE:()=>r,LONG_PRESS_DELAY_MS:()=>i,ADMIN_STORY_VIEW_MODULE:()=>n,StickerTypes:()=>a,EMOJI_REACTIONS_ARR:()=>s,QUESTION_SELECT_MODE:()=>l,MAX_FEEDBACK_STORIES_SLICE_COUNT:()=>d,INIT_MAX_FEEDBACK_STORIES_COUNT:()=>c,MAX_NARRATIVE_STORIES:()=>u,NARRATIVE_MAX_TITLE_LENGTH:()=>v,BOX_ITEM_DRAGGABLE_CLASS:()=>h,SCROLL_THROTTLE_DELAY:()=>_,SCROLL_LOADING_MORE_GAP:()=>p});var r="stories_manage",i=200,n="admin_story_view",a={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,sticker:12,app:13,situationalTheme:14},s=[{code:"f09f9882",name:"face_with_tears_of_happiness"},{code:"f09f988d",name:"smiling_face_with_heart_eyes"},{code:"f09f918df09f8fbf",name:"thumbs_up"},{code:"f09f98ad",name:"loud_crying_face"},{code:"f09f98b1",name:"face_screaming_in_fear"},{code:"e298ba",name:"smiling_face"}],l={PUBLIC:0,AUTHOR_ONLY:1,ANONYMOUS:3},d=50,c=10,u=100,v=23,h="NarrativeBox__draggable",_=34,p=400},652745:(e,t,o)=>{"use strict";o.d(t,{prepareStoriesForPublishing:()=>h,updateNarrativeBlock:()=>_,highlightNarrativeBlock:()=>p,updateNarrativeSnippetsFromQueueByPost:()=>g});var r=o(315544),i=o(486125),n=o(560717),a=o(786067),s=o(40906),l=o(814200),d=o(856901),c=o(533228),u=o(66433),v=o(19331);function h(e){return e.map((function(e){return e.id})).join(",")}function _(e){void 0===e&&(e=!1);var t=(0,s.intval)(window.cur.oid);if(window.cur.narrativeBlock)window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t},{onDone:function(e){var t=(0,s.intval)(window.cur.oid),o=document.getElementById("narratives_module"+t+"_wrapper");if(o)if(e)(0,r.domReplaceEl)(o,e),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new l.default);else{var i=o.parentElement;(null==i?void 0:i.children.length)&&(null==i?void 0:i.children.length)>1?o.remove():null==i||i.remove(),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),delete window.cur.narrativeBlock}(0,c.removeStoryList)("narratives"+t)}});else if(t>0&&"profile"===window.cur.module){var o=document.getElementById(d.PROFILE_MEDIA_NARROW_BLOCK_ID),n=!o;window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t,need_wrap_block:(0,s.intval)(n)},{onDone:function(e){if(o)o.insertAdjacentHTML("afterbegin",e);else{var r=document.getElementById("narrow_column");if(!r)return;r.insertAdjacentHTML("beforeend",e)}window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new l.default,window.cur.narrativeBlock.showOnboardTooltipIfNeeded()),(0,c.removeStoryList)("narratives"+t)}})}else e&&function(e){window.boxQueue.hideAll();var t=document.querySelector("#box_layer_wrap"),o=document.querySelector("#box_loader");window.nav.reload({onDone:function(){e&&e()},showProgress:function(){(0,r.show)(t),(0,r.show)(o),(0,i.boxRefreshCoords)(o)},hideProgress:function(){(0,r.hide)(t),(0,r.hide)(o)}})}((function(){window.cur.needNarrativeOnboard=!0}))}function p(e){if(e){var t="narratives_module"+window.vk.id;(0,n.highlightModule)({module:t,text:(0,a.getLang)("stories_narrative_block_onboarding_text"),onClose:function(){delete window.cur.needNarrativeOnboard,window.ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"profile_narrative"})},autoCancelDelay:1e4,speed:600})}}function g(e){if(window.vk.id&&(0,v.partConfigEnabled)("update_private_snippets_by_queue")){var t=Array.from(e.querySelectorAll(".NarrativeSnippet"));if(t.length){var o=[];t.forEach((function(e){if(window.vk.id&&e.dataset.needUpdate){var t=e.dataset.narrativeRawId;t&&o.push({narrative_raw_id:t,snippet_type:e.dataset.snippetType,from:e.dataset.from})}})),o.length&&window.ajax.post("al_stories.php",{act:"get_narrative_snippets",narrative_snippets:JSON.stringify(o)},{onDone:function(e){t.forEach((function(t){t.dataset.narrativeRawId&&e[t.dataset.narrativeRawId]&&(t.outerHTML=e[t.dataset.narrativeRawId])}))},onFail:function(){return(0,u.logError)(new Error("Fail: updateNarrativeSnippetFromQueueByPost")),!0}})}}}},241926:(e,t,o)=>{"use strict";o.d(t,{showNarrativeEditorBox:()=>N,showNarrativeBox:()=>x,showRecommendedNarrativesBox:()=>b,loadRecommendedNarrativesBoxData:()=>E,showNarrativeChooseBox:()=>T,showNarrativeCreateLiteBox:()=>I,showStoryLinkEditorBox:()=>L,showNarrativeCropCoverBox:()=>B});var r=o(570655),i=o(785893),n=o(887157),a=o(449849),s=o(481117),l=o(115985),d=o(709652),c=o(486125),u=o(786067),v=o(386409),h=o(654612),_=o(231454),p=o(884215),g=o(730095),f=o(66433),m=o(111898),w=o(849464),y=o(833623),S=o(303562),C=560;function N(e,t){void 0===t&&(t={});var o={},l=t.narrative,d=t.onClose,v=t.onSave,h=t.navScreen,_=t.stories,p=t.selectedStories,g=void 0===p?[]:p,w=t.publishHash,y=t.editHash,C=t.linkData,N=t.isEditingLinksAvailable,x=t.storiesCount,b=t.coverUploadConfig,E=t.getPublishDoneHTML,k=!1;function T(){window.stManager.add(["NarrativeEditor.css"]).then((function(){o.box=(0,s.showComponentInBox)(A(),{width:638,onDestroy:function(e){(0,s.destroyComponentInBox)(e),d&&d(k)}})})).catch((function(e){console.error(e),(0,f.logError)(e)}))}function I(){return(null==_?void 0:_.length)?new Promise((function(t,o){if(!(null==_?void 0:_.length))return o("empty stories");window.ajax.post("al_stories.php",{act:"get_archive_stories",owner_id:e,offset:_.length},{onDone:function(e,i){if(_){_=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(_),!1),(0,r.__read)(e),!1);var n=(x=i)>_.length;t(n),P()}else o("empty stories after loading")},onFail:function(e){return o(e),!0}})})):Promise.reject("empty stories")}function L(e){k=!0,v&&v(e)}function B(e){o.box&&o.box.hide(),e&&e()}function P(){(null==_?void 0:_.length)&&w&&y&&(0,s.updateCurrentComponentInBox)(A())}function D(e,t,o){if(null==_?void 0:_.length){var i=function(i){return null==i?void 0:i.map((function(i){return i.rawId===e?(0,r.__assign)((0,r.__assign)({},i),{linkUrl:t,linkType:o}):i}))};_=i(_),g=i(g)||[],P()}}function A(){if((null==_?void 0:_.length)&&w&&y&&x&&b){var t=_.reduce((function(e,t){return e[t.id]=t,e}),{});t=g.reduce((function(e,t){return e[t.id]=t,e}),t);var o=_.map((function(e){return e.id})),r=g.map((function(e){return e.id})),s=l?n.EditorModeType.edit:n.EditorModeType.create,d=(null==l?void 0:l.title)?(0,a.decodeHTMLEntities)(l.title):"",c=x>_.length,u=l?(0,S.getPreparedCover)(l):void 0;return(0,i.jsx)(m.NarrativeEditor,{ownerId:e,type:s,name:d,narrativeRawId:null==l?void 0:l.rawId,cover:u,selectedStoryIds:r,storyIds:o,hasMore:c,storyMap:t,close:B,loadMore:I,onSave:L,publishHash:w,editHash:y,linkData:C,isEditingLinksAvailable:N,onStoryLinkUpdate:D,appearance:n.EditorViewType.box,navScreen:h,coverUploadConfig:b,getPublishDoneHTML:E},void 0)}}_&&w&&y&&x&&b?T():new Promise((function(t,o){window.ajax.post("al_stories.php",{act:"get_narrative_editor_data",owner_id:e},{loader:!0,onDone:function(e){_=e.stories,x=e.storiesCount,w=e.publishHash,y=e.editHash,C=e.linkData,N=e.isEditingLinksAvailable,b=e.coverUploadConfig,t([_,x,w,y,C,N,b])},onFail:function(e){return o(e),!0}})})).then((function(){T()})).catch((function(e){(0,c.showDoneBox)(e||(0,u.getLang)("global_error")),(0,f.logError)(e)}))}function x(e){var t=e.ownerId,o=e.onClose,n=e.onSave,a=e.onRemove,_=e.onReorder,p=e.navScreen,g={narratives:[],ownerId:t,boxAct:"get_narrative_box_data"},f=!1;function m(){return D(g).then((function(){y()})).catch((function(e){(0,c.showDoneBox)(e||(0,u.getLang)("global_error"))}))}function y(){if(g.boxData){var e=g.boxData.canEdit?d.BoxType.edit:d.BoxType.view;(0,s.updateCurrentComponentInBox)((0,i.jsx)(l.NarrativeBox,{type:e,boxData:g.boxData,narratives:g.narratives,onClose:b,onSave:S,onRemove:N,onBookmark:k,onReorder:E,loadMore:m,navScreen:p},void 0))}}function S(e){n&&n(e),f=!0}function N(e){var t,o,r;t=e,o={title:(0,u.getLang)("global_warning")},r=function(e){var o=g.boxData;o&&window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:t.rawId,hash:o.removeHash},{onDone:function(){o.count-=1,(0,w.sendNarrativeAnalytic)(w.NarrativeAnalyticEventType.deleteNarrative,t,p),g.narratives=g.narratives.filter((function(e){return e.rawId!==t.rawId})),y(),(0,c.showDoneBox)((0,u.getLang)("stories_deleted_narrative")),a&&a()},onFail:function(e){return(0,c.showDoneBox)(e||(0,u.getLang)("global_error")),!0},showProgress:function(){return(0,v.lockButton)(e)},hideProgress:function(){(0,c.curBox)().hide(),(0,v.unlockButton)(e)}})},(0,h.showFastBox)(o,(0,u.getLang)("stories_narrative_remove_warning"),(0,u.getLang)("stories_remove_confirm"),r,(0,u.getLang)("global_cancel"))}function x(){f&&b()}function b(){g.box&&g.box.hide()}function E(e){g.narratives=e,y(),_&&_()}function k(e){e.isBookmarked=!e.isBookmarked,y()}P(g).then((function(e){var t=(0,r.__read)(e,3),n=t[0],a=t[1],c=t[2];g.narratives=n,g.boxData=a,g.startFrom=c,g.box=function(e,t){var r=t.canEdit?d.BoxType.edit:d.BoxType.view;return(0,s.showComponentInBox)((0,i.jsx)(l.NarrativeBox,{type:r,boxData:t,narratives:e,loadMore:m,onClose:b,onSave:S,onReorder:E,onBookmark:k,onRemove:N,navScreen:p},void 0),{width:C,onShow:x,onDestroy:function(e){(0,s.destroyComponentInBox)(e),o&&o()}})}(n,a)})).catch((function(e){(0,c.showDoneBox)(e||(0,u.getLang)("global_error")),o&&o()}))}function b(e){var t;void 0===e&&(e={});var o=k(e);function n(){return D(o).then((function(){d()})).catch((function(e){(0,c.showDoneBox)(e||(0,u.getLang)("global_error"))}))}function a(){return(0,s.showComponentInBox)(v(),{width:C,onDestroy:function(e){(0,s.destroyComponentInBox)(e)}})}function d(){o.boxData&&(0,s.updateCurrentComponentInBox)(v())}function v(){if(o.boxData)return(0,i.jsx)(l.NarrativeBox,{title:(0,u.getLang)("news_fb_block_recommend_narratives"),showNarrativeNumber:!1,boxData:o.boxData,narratives:o.narratives,loadMore:n,onClose:h,onBookmark:_,trackCode:o.trackCode,list:o.list,source:o.source},void 0)}function h(){o.box&&o.box.hide()}function _(e){e.isBookmarked=!e.isBookmarked,d()}(null===(t=o.narratives)||void 0===t?void 0:t.length)&&o.boxData?o.box=a():P(o).then((function(e){var t=(0,r.__read)(e,2),i=t[0],n=t[1];o.narratives=i,o.boxData=n,o.box=a()})).catch((function(e){(0,c.showDoneBox)(e||(0,u.getLang)("global_error"))}))}function E(e){return void 0===e&&(e={}),P(k(e),!0)}function k(e){return void 0===e&&(e={}),{narratives:e.narratives?e.narratives:[],boxData:e.boxData,boxAct:"get_recommended_narratives",trackCode:e.trackCode,list:e.list,source:e.source}}function T(e){var t=e.ownerId,o=e.story,n=e.onClose,a=e.onSave,l=e.navScreen,d={narratives:[],ownerId:t,boxAct:"get_narrative_choose_box_data"},v=!1;function h(){return D(d).then((function(e){return function(){if(!d.boxData)return;(0,s.updateCurrentComponentInBox)((0,i.jsx)(_.NarrativeChooseBox,{story:o,narratives:d.narratives,onClose:f,onSave:p,boxData:d.boxData,loadMore:h,navScreen:l},void 0))}(),e})).catch((function(e){return(0,c.showDoneBox)(e||(0,u.getLang)("global_error")),[]}))}function p(e){v=!0,a&&a(e)}function g(){v&&f()}function f(){d.box&&d.box.hide()}P(d).then((function(e){var t=(0,r.__read)(e,3),a=t[0],c=t[1],u=t[2];d.narratives=a,d.boxData=c,d.startFrom=u,d.box=function(e,t){return(0,s.showComponentInBox)((0,i.jsx)(_.NarrativeChooseBox,{story:o,narratives:e,boxData:t,loadMore:h,onClose:f,onSave:p,navScreen:l},void 0),{width:C,onShow:g,onDestroy:function(e){(0,s.destroyComponentInBox)(e),n&&n(v)}})}(a,c)})).catch((function(e){(0,c.showDoneBox)(e||(0,u.getLang)("global_error")),n&&n()}))}function I(e){var t=e.onSave,o=e.onClose,r=e.ownerId,n=e.ownerName,a=e.stories,l=e.publishNarrativeHash,d=(0,s.showComponentInBox)((0,i.jsx)(p.NarrativeCreateLiteBox,{stories:a,ownerId:r,ownerName:n,publishNarrativeHash:l,onSave:t,onClose:function(){d&&d.hide()}},void 0),{width:C,onDestroy:function(e){(0,s.destroyComponentInBox)(e),o&&o()}})}function L(e){var t=e.story,o=e.onClose,n=e.onStoryLinkUpdate,a=e.linkData;t.linkType&&t.linkText&&(a.items.find((function(e){return e.value===t.linkType}))||(a=(0,r.__assign)((0,r.__assign)({},a),{items:(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(a.items),!1),[{value:t.linkType,label:t.linkText}],!1)})));var l=(0,s.showComponentInBox)((0,i.jsx)(g.StoryLinkEditorBox,{story:t,onClose:function(){l&&l.hide()},onStoryLinkUpdate:n,linkData:a},void 0),{width:450,onDestroy:function(e){(0,s.destroyComponentInBox)(e),o&&o()}})}function B(e){var t=e.coverUrl,o=e.coverHeight,r=e.coverWidth,n=e.thumbHeight,a=e.thumbWidth,l=e.onClose,d=e.onSave,c=e.crop,u=(0,s.showComponentInBox)((0,i.jsx)(y.NarrativeCoverCropper,{coverUrl:t,coverHeight:o,coverWidth:r,thumbHeight:n,thumbWidth:a,onClose:function(){u&&u.hide()},onSave:d,crop:c},void 0),{width:638,onDestroy:function(e){(0,s.destroyComponentInBox)(e),l&&l()}})}function P(e,t){return void 0===t&&(t=!1),new Promise((function(o,r){window.ajax.post("al_stories.php",{act:e.boxAct,owner_id:e.ownerId,start_from:e.startFrom,track_code:e.trackCode},{loader:!e.narratives.length&&!t,onDone:function(e,t,r){o([e,t,r])},onFail:function(e){return r(e),!0}})}))}function D(e){return P(e).then((function(t){var o,i=(0,r.__read)(t,3),n=i[0],a=i[2];return e.narratives=(null===(o=e.narratives)||void 0===o?void 0:o.concat(n))||n,e.startFrom=a,n}))}},125696:(e,t,o)=>{"use strict";o.d(t,{addLayer:()=>h,removeLayer:()=>_,layerShown:()=>p,layerHide:()=>g,hideAllLayers:()=>f,getFirstLayer:()=>m,getPrevLayer:()=>w,slicePrevLayers:()=>y,onReplyDeleted:()=>S,checkAndPrepareBoxQueue:()=>N,isOpeningLocked:()=>x});var r=o(475632),i=o(49535),n=o(315544),a=o(486125),s=[],l=!1,d=function(){window.cur.storyLayer&&window.cur.storyLayer.onVisibilityChange()},c=function(){window.cur.storyLayer&&window.cur.storyLayer.onResize()},u=function(e){window.cur.storyLayer&&window.cur.storyLayer.onKeyDown(e)},v=function(e){window.cur.storyLayer&&window.cur.storyLayer.onKeyUp(e)};function h(e,t){window.cur.storyLayer&&window.cur.storyLayer.pauseLayer(),(0,n.ge)("stories_layers_background")||(document.body.appendChild((0,n.ce)("div",{id:"stories_layers_background",className:"stories_layers_background"})),window.layerQueue.hide(),window.layerQueue.push(),window.layers.fullhide=f,(0,i.addEvent)(window,"visibilitychange",d,void 0,void 0,!0),(0,i.addEvent)(window,"resize",c),(0,i.addEvent)(document,"keydown",u),(0,i.addEvent)(document,"keyup",v)),window.cur.storyLayer=e,l=!0,e.animateStory("expand",t.fromEl).catch((function(){})).finally((function(){l=!1})),s.push(e),(0,n.addClass)(document.body,"stories_layer_shown"),(0,r.cancelStackPush)("stories_layer_close"+s.length,(function(t){void 0===t&&(t={}),t.byTimer?e.sendNavigationStatEvents("close_auto_by_time"):e.sendNavigationStatEvents("close_tap"),s.length>1&&!t.isCloseBtnClick?e.back():(e.hideAllLayers=t.isCloseBtnClick,e.hide(!1))}))}function _(){var e;s.pop(),window.cur.storyLayer=s[s.length-1],window.cur.storyLayer?window.cur.storyLayer.resumeLayer():(f(!0),window.layerQueue.pop(),window.cur.storiesCashedBoxQueueData&&((0,a.restoreBoxQueue)(window.cur.storiesCashedBoxQueueData),(e=C())&&(e.forceHide=!1,e._show(!0,!1,!0)),delete window.cur.storiesCashedBoxQueueData))}function p(){s.length>1&&(s[s.length-2].setLayerVisibility(!1),s[s.length-1].showBackButton())}function g(){s.length>1?s[s.length-2].setLayerVisibility(!0):(0,n.setStyle)("stories_layers_background","opacity",0)}function f(e){void 0===e&&(e=!1);for(var t=0;t<s.length;t++)s[t].hide(!0);if(window.layers.fullhide=!1,(0,n.removeClass)(document.body,"stories_layer_shown"),(0,n.re)("stories_layers_background"),(0,i.removeEvent)(window,"visibilitychange",d),(0,i.removeEvent)(window,"resize",c),(0,i.removeEvent)(document,"keydown",u),(0,i.removeEvent)(document,"keyup",v),e){var o=window.nav.objLoc;delete o.w,window.nav.setLoc(o)}window.cur.needUpdateFeedStories&&window.Stories.updateFeedStories(),s=[]}function m(){return s[0]}function w(){return s[s.length-2]}function y(){for(var e=s.length-2;e>=0;e--)s[e].doHide(!0);s.splice(0,s.length-1)}function S(e){for(var t=0;t<s.length;t++)s[t].onReplyDeleted(e)}function C(){var e;if(!(null===(e=window._message_boxes)||void 0===e?void 0:e.length))return null;var t=window._message_boxes.filter(Boolean);return t.length?t[t.length-1]:null}function N(e){(0,a.curBox)()&&(e.fromEl=null,function(){var e=C();e&&(e._hide(!1,!0,!0),e.forceHide=!0)}(),window.cur.storiesCashedBoxQueueData=(0,a.getAndCleanBoxQueueData)())}function x(){return l}window.LayersX=s},533228:(e,t,o)=>{"use strict";o.d(t,{getVolume:()=>s,setVolume:()=>l,getStoryList:()=>d,removeStoryList:()=>c,preloadDiscoverList:()=>u,fetchDiscover:()=>v,isDiscoverLoading:()=>h,getStoryBlockKey:()=>_,createUserStackMaskIfNeeded:()=>p,isNewDesignEnabled:()=>g});var r=o(570655),i=o(341319),n=o(315544),a=o(19331);function s(){var e=window.ls.get("video_volume");return"number"==typeof e?Math.min(1,Math.max(0,e)):1}function l(e){window.ls.set("video_volume",e)}function d(e){return window.cur["stories_list_"+e]}function c(e){delete window.cur["stories_list_"+e]}function u(e){if(void 0===e&&(e=!1),window.cur.storiesDiscoverFetchingPromise)return window.cur.storiesDiscoverFetchingPromise;var t,o,n=d(i.StoryListName.feed);return n&&(o=n.find((function(e){return e.type===i.StoryBlockType.discover})))&&(t=o.track_code),window.cur.storiesDiscoverFetchingPromise=v("",t,e).then((function(e){var t=(0,r.__read)(e,2),i=t[0],n=t[1];return o&&(o.grouped=i,o.next_from=n),i})).finally((function(){delete window.cur.storiesDiscoverFetchingPromise})),window.cur.storiesDiscoverFetchingPromise}function v(e,t,o,r){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===o&&(o=!1),void 0===r&&(r=15),new Promise((function(i,n){window.ajax.post("al_stories.php",{act:"get_discover",start_from:e,count:r,track_code:t},{loader:o,onDone:function(e,t){i([e,t])},onFail:function(e){return n(e),!0}})}))}function h(){return Boolean(window.cur.storiesDiscoverFetchingPromise)}function _(e){var t,o,r;return(null===(t=null==e?void 0:e.author)||void 0===t?void 0:t.id)&&(null===(o=null==e?void 0:e.narrative)||void 0===o?void 0:o.id)?e.author.id+"narrative"+(null===(r=e.narrative)||void 0===r?void 0:r.id):""+e.id}function p(){var e,t="users_stack_stories_mask",o=document.getElementById(t);o||(o=(0,n.se)('\n        <svg width="0" height="0">\n          <defs>\n            <clipPath id="'+t+'">\n              <path transform="translate(1.5 0)" d="M1.20772 8C1.20772 6.32671 0.768742 4.75626 0 3.39821C1.44342 1.34278 3.8277 0 6.52463 0C10.9293 0 14.5 3.58172 14.5 8C14.5 12.4183 10.9293 16 6.52463 16C3.8277 16 1.44342 14.6572 0 12.6018C0.768742 11.2437 1.20772 9.6733 1.20772 8Z"></path>\n            </clipPath>\n          </defs>  \n        </svg>  \n      '))&&(document.body.appendChild(o),null===(e=window.cur.destroy)||void 0===e||e.push((function(){null==o||o.remove()})))}function g(){return(0,a.partConfigEnabled)("story_reactions_sending_feature_web")}},453580:(e,t,o)=>{"use strict";o.d(t,{WallDataEvents:()=>a,registerUniqueListener:()=>d,registerNonGlobalNonUniqueListener:()=>c,emitEvent:()=>u});var r=o(570655),i=o(761508),n=o(469687),a={post_reactions_counts_update:"wall/post_reactions_counts_update",reply_reactions_counts_update:"wall/reply_reactions_counts_update"},s=(0,n.makeSharedState)("wall-data",(function(){return{emitter:new i.default,keyedListeners:Object.create(null)}})),l=function(e,t,o){var i,n,a=s(),l=null===(n=null===(i=a.keyedListeners)||void 0===i?void 0:i[e])||void 0===n?void 0:n[t];return l&&a.emitter.removeListener(e,l),function(e,t,o){var i,n=s();return n.emitter.addListener(e,o),n.keyedListeners[e]=(0,r.__assign)((0,r.__assign)({},n.keyedListeners[e]),((i={})[t]=o,i)),function(){var r,i;n.emitter.removeListener(e,o),(null===(r=n.keyedListeners[e])||void 0===r?void 0:r[t])===o&&(null===(i=n.keyedListeners[e])||void 0===i||delete i[t])}}(e,t,o)},d=function(e,t,o){return l(t,e,o)},c=function(e,t){return function(e,t){var o=s();return o.emitter.addListener(e,t),function(){o.emitter.removeListener(e,t)}}(e,t)},u=function(e,t){s().emitter.emit(e,t)}},210277:(e,t,o)=>{"use strict";o.d(t,{updateAriaLabelCounter:()=>n});var r=o(786067),i=o(325698),n=function(e,t,o){if("number"==typeof t&&e instanceof HTMLElement&&e.classList.contains("PostBottomAction")){var n=function(e){var t=void 0;switch(e){case i.LikeButtonTypes.comment:t=(0,r.getLang)("likes_comments_N_aria_short","raw");break;case i.LikeButtonTypes.like:t=(0,r.getLang)("likes_likes_N_aria_short","raw");break;case i.LikeButtonTypes.share:t=(0,r.getLang)("likes_shares_N_aria_short","raw")}return t}(o);if(n){var a=(0,r.langNumeric)(t,n,!1);e.setAttribute("aria-label",a)}}}}}]);try{stManager.done("dist/5da5a425c72a70255198a89623a242ff.557f5d58762c1b8f4bce.js")}catch(e){}